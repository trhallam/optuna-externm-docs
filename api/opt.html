
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
        <meta name="author" content="Tony Hallam">
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.3.0, mkdocs-material-8.2.8">
    
    
      
        <title>Optimisation Samplers - Optuna-ExternM Documentation</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.644de097.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.e6a45f82.min.css">
        
          
          
          <meta name="theme-color" content="#4cae4f">
        
      
    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="green" data-md-color-accent="">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#optuna_externmopt" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Optuna-ExternM Documentation" class="md-header__button md-logo" aria-label="Optuna-ExternM Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Optuna-ExternM Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Optimisation Samplers
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/trhallam/optuna-externm" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    trhallam/optuna-externm
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../index.html" class="md-tabs__link">
        Home
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../sa/intro.html" class="md-tabs__link">
        Sensitivity Analysis
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../opt/intro.html" class="md-tabs__link">
        Optimisation
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../ug/framework.html" class="md-tabs__link">
        User Guide
      </a>
    </li>
  

      
        
  
  
    
  


  
  
  
    <li class="md-tabs__item">
      <a href="core.html" class="md-tabs__link md-tabs__link--active">
        API
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../ophm/about.html" class="md-tabs__link">
        Optuna-HM
      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Optuna-ExternM Documentation" class="md-nav__button md-logo" aria-label="Optuna-ExternM Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    Optuna-ExternM Documentation
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/trhallam/optuna-externm" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    trhallam/optuna-externm
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_1" data-md-state="indeterminate" type="checkbox" id="__nav_1" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_1">
          Home
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Home" data-md-level="1">
        <label class="md-nav__title" for="__nav_1">
          <span class="md-nav__icon md-icon"></span>
          Home
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../index.html" class="md-nav__link">
        About
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../contrib.html" class="md-nav__link">
        Contributing
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../contact.html" class="md-nav__link">
        Contact
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="https://github.com/trhallam/optuna-externm/issues" class="md-nav__link">
        Issue Tracker
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" data-md-state="indeterminate" type="checkbox" id="__nav_2" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_2">
          Sensitivity Analysis
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Sensitivity Analysis" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Sensitivity Analysis
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../sa/intro.html" class="md-nav__link">
        Introduction
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../sa/ovat.html" class="md-nav__link">
        OVAT
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../sa/sobol.html" class="md-nav__link">
        Sobol
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" data-md-state="indeterminate" type="checkbox" id="__nav_3" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_3">
          Optimisation
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Optimisation" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Optimisation
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../opt/intro.html" class="md-nav__link">
        Introduction
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../opt/cmaes.html" class="md-nav__link">
        Cma-Es
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../opt/lexde.html" class="md-nav__link">
        Lex-De
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" data-md-state="indeterminate" type="checkbox" id="__nav_4" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_4">
          User Guide
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="User Guide" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          User Guide
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../ug/framework.html" class="md-nav__link">
        Optuna-ExternM Framework
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../cli/cli.html" class="md-nav__link">
        CLI
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5" type="checkbox" id="__nav_5" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_5">
          API
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="API" data-md-level="1">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          API
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="core.html" class="md-nav__link">
        Core
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="sa.html" class="md-nav__link">
        Sensitivity Samplers
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Optimisation Samplers
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="opt.html" class="md-nav__link md-nav__link--active">
        Optimisation Samplers
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#optuna_externmopt" class="md-nav__link">
    optuna_externm.opt
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#nsgaii" class="md-nav__link">
    NSGAII
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#optuna.samplers._nsga2.NSGAIISampler" class="md-nav__link">
    optuna.samplers._nsga2.NSGAIISampler
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#optuna.samplers._nsga2.NSGAIISampler.after_trial" class="md-nav__link">
    after_trial()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#optuna.samplers._nsga2.NSGAIISampler.infer_relative_search_space" class="md-nav__link">
    infer_relative_search_space()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#optuna.samplers._nsga2.NSGAIISampler.reseed_rng" class="md-nav__link">
    reseed_rng()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#optuna.samplers._nsga2.NSGAIISampler.sample_independent" class="md-nav__link">
    sample_independent()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#optuna.samplers._nsga2.NSGAIISampler.sample_relative" class="md-nav__link">
    sample_relative()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cmaes" class="md-nav__link">
    CMAES
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#optuna.samplers._cmaes.CmaEsSampler" class="md-nav__link">
    optuna.samplers._cmaes.CmaEsSampler
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#optuna.samplers._cmaes.CmaEsSampler.after_trial" class="md-nav__link">
    after_trial()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#optuna.samplers._cmaes.CmaEsSampler.infer_relative_search_space" class="md-nav__link">
    infer_relative_search_space()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#optuna.samplers._cmaes.CmaEsSampler.reseed_rng" class="md-nav__link">
    reseed_rng()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#optuna.samplers._cmaes.CmaEsSampler.sample_independent" class="md-nav__link">
    sample_independent()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#optuna.samplers._cmaes.CmaEsSampler.sample_relative" class="md-nav__link">
    sample_relative()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lexde" class="md-nav__link">
    LEXDE
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#optuna_externm.opt._lexde.LEXDESampler" class="md-nav__link">
    optuna_externm.opt._lexde.LEXDESampler
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#optuna_externm.opt._lexde.LEXDESampler.after_trial" class="md-nav__link">
    after_trial()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#optuna_externm.opt._lexde.LEXDESampler.infer_relative_search_space" class="md-nav__link">
    infer_relative_search_space()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#optuna_externm.opt._lexde.LEXDESampler.reseed_rng" class="md-nav__link">
    reseed_rng()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#optuna_externm.opt._lexde.LEXDESampler.sample_independent" class="md-nav__link">
    sample_independent()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#optuna_externm.opt._lexde.LEXDESampler.sample_relative" class="md-nav__link">
    sample_relative()
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6" data-md-state="indeterminate" type="checkbox" id="__nav_6" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_6">
          Optuna-HM
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Optuna-HM" data-md-level="1">
        <label class="md-nav__title" for="__nav_6">
          <span class="md-nav__icon md-icon"></span>
          Optuna-HM
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../ophm/about.html" class="md-nav__link">
        About
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../ophm/tutorial.html" class="md-nav__link">
        Tutorial
      </a>
    </li>
  

            
          
            
              
  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6_3" data-md-state="indeterminate" type="checkbox" id="__nav_6_3" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_6_3">
          API
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="API" data-md-level="2">
        <label class="md-nav__title" for="__nav_6_3">
          <span class="md-nav__icon md-icon"></span>
          API
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../ophm/api_handlers.html" class="md-nav__link">
        Handlers
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../ophm/api_metrics.html" class="md-nav__link">
        Metrics
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#optuna_externmopt" class="md-nav__link">
    optuna_externm.opt
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#nsgaii" class="md-nav__link">
    NSGAII
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#optuna.samplers._nsga2.NSGAIISampler" class="md-nav__link">
    optuna.samplers._nsga2.NSGAIISampler
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#optuna.samplers._nsga2.NSGAIISampler.after_trial" class="md-nav__link">
    after_trial()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#optuna.samplers._nsga2.NSGAIISampler.infer_relative_search_space" class="md-nav__link">
    infer_relative_search_space()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#optuna.samplers._nsga2.NSGAIISampler.reseed_rng" class="md-nav__link">
    reseed_rng()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#optuna.samplers._nsga2.NSGAIISampler.sample_independent" class="md-nav__link">
    sample_independent()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#optuna.samplers._nsga2.NSGAIISampler.sample_relative" class="md-nav__link">
    sample_relative()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cmaes" class="md-nav__link">
    CMAES
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#optuna.samplers._cmaes.CmaEsSampler" class="md-nav__link">
    optuna.samplers._cmaes.CmaEsSampler
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#optuna.samplers._cmaes.CmaEsSampler.after_trial" class="md-nav__link">
    after_trial()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#optuna.samplers._cmaes.CmaEsSampler.infer_relative_search_space" class="md-nav__link">
    infer_relative_search_space()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#optuna.samplers._cmaes.CmaEsSampler.reseed_rng" class="md-nav__link">
    reseed_rng()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#optuna.samplers._cmaes.CmaEsSampler.sample_independent" class="md-nav__link">
    sample_independent()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#optuna.samplers._cmaes.CmaEsSampler.sample_relative" class="md-nav__link">
    sample_relative()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lexde" class="md-nav__link">
    LEXDE
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#optuna_externm.opt._lexde.LEXDESampler" class="md-nav__link">
    optuna_externm.opt._lexde.LEXDESampler
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#optuna_externm.opt._lexde.LEXDESampler.after_trial" class="md-nav__link">
    after_trial()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#optuna_externm.opt._lexde.LEXDESampler.infer_relative_search_space" class="md-nav__link">
    infer_relative_search_space()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#optuna_externm.opt._lexde.LEXDESampler.reseed_rng" class="md-nav__link">
    reseed_rng()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#optuna_externm.opt._lexde.LEXDESampler.sample_independent" class="md-nav__link">
    sample_independent()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#optuna_externm.opt._lexde.LEXDESampler.sample_relative" class="md-nav__link">
    sample_relative()
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              



                
<a href="https://github.com/trhallam/optuna-externm/edit/main/docs/api/opt.md" title="Edit this page" class="md-content__button md-icon">
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
</a>



  <h1>Optimisation Samplers</h1>

<h2 id="optuna_externmopt"><code>optuna_externm.opt</code></h2>
<h2 id="nsgaii"><code>NSGAII</code></h2>
<p>This sampler is from and maintained by <code>optuna</code> but included here for convienience.</p>


  <div class="doc doc-object doc-class">

<a id="optuna.samplers._nsga2.NSGAIISampler"></a>
    <div class="doc doc-contents first">

      <p>Multi-objective sampler using the NSGA-II algorithm.</p>
<p>NSGA-II stands for "Nondominated Sorting Genetic Algorithm II",
which is a well known, fast and elitist multi-objective genetic algorithm.</p>
<p>For further information about NSGA-II, please refer to the following paper:</p>
<ul>
<li><code>A fast and elitist multiobjective genetic algorithm: NSGA-II
  &lt;https://ieeexplore.ieee.org/document/996017&gt;</code>_</li>
</ul>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>population_size</code></td>
        <td><code>int</code></td>
        <td><p>Number of individuals (trials) in a generation.</p></td>
        <td><code>50</code></td>
      </tr>
      <tr>
        <td><code>mutation_prob</code></td>
        <td><code>Optional[float]</code></td>
        <td><p>Probability of mutating each parameter when creating a new individual.
If :obj:<code>None</code> is specified, the value <code>1.0 / len(parent_trial.params)</code> is used
where <code>parent_trial</code> is the parent trial of the target individual.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>crossover_prob</code></td>
        <td><code>float</code></td>
        <td><p>Probability that a crossover (parameters swapping between parents) will occur
when creating a new individual.</p></td>
        <td><code>0.9</code></td>
      </tr>
      <tr>
        <td><code>swapping_prob</code></td>
        <td><code>float</code></td>
        <td><p>Probability of swapping each parameter of the parents during crossover.</p></td>
        <td><code>0.5</code></td>
      </tr>
      <tr>
        <td><code>seed</code></td>
        <td><code>Optional[int]</code></td>
        <td><p>Seed for random number generator.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>constraints_func</code></td>
        <td><code>Optional[Callable[[optuna.trial._frozen.FrozenTrial], Sequence[float]]]</code></td>
        <td><p>An optional function that computes the objective constraints. It must take a
:class:<code>~optuna.trial.FrozenTrial</code> and return the constraints. The return value must
be a sequence of :obj:<code>float</code> s. A value strictly larger than 0 means that a
constraints is violated. A value equal to or smaller than 0 is considered feasible.
If <code>constraints_func</code> returns more than one value for a trial, that trial is
considered feasible if and only if all values are equal to 0 or smaller.</p>
<p>The <code>constraints_func</code> will be evaluated after each successful trial.
The function won't be called when trials fail or they are pruned, but this behavior is
subject to change in the future releases.</p>
<p>The constraints are handled by the constrained domination. A trial x is said to
constrained-dominate a trial y, if any of the following conditions is true:</p>
<ol>
<li>Trial x is feasible and trial y is not.</li>
<li>Trial x and y are both infeasible, but trial x has a smaller overall violation.</li>
<li>Trial x and y are feasible and trial x dominates trial y.</li>
</ol>
<p>.. note::
    Added in v2.5.0 as an experimental feature. The interface may change in newer
    versions without prior notice. See
    https://github.com/optuna/optuna/releases/tag/v2.5.0.</p></td>
        <td><code>None</code></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>optuna/samplers/_nsga2.py</code></summary>
          <div class="highlight"><span class="filename">Python</span><pre><span></span><code><span class="k">class</span> <span class="nc">NSGAIISampler</span><span class="p">(</span><span class="n">BaseSampler</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Multi-objective sampler using the NSGA-II algorithm.</span>

<span class="sd">    NSGA-II stands for &quot;Nondominated Sorting Genetic Algorithm II&quot;,</span>
<span class="sd">    which is a well known, fast and elitist multi-objective genetic algorithm.</span>

<span class="sd">    For further information about NSGA-II, please refer to the following paper:</span>

<span class="sd">    - `A fast and elitist multiobjective genetic algorithm: NSGA-II</span>
<span class="sd">      &lt;https://ieeexplore.ieee.org/document/996017&gt;`_</span>

<span class="sd">    Args:</span>
<span class="sd">        population_size:</span>
<span class="sd">            Number of individuals (trials) in a generation.</span>

<span class="sd">        mutation_prob:</span>
<span class="sd">            Probability of mutating each parameter when creating a new individual.</span>
<span class="sd">            If :obj:`None` is specified, the value ``1.0 / len(parent_trial.params)`` is used</span>
<span class="sd">            where ``parent_trial`` is the parent trial of the target individual.</span>

<span class="sd">        crossover_prob:</span>
<span class="sd">            Probability that a crossover (parameters swapping between parents) will occur</span>
<span class="sd">            when creating a new individual.</span>

<span class="sd">        swapping_prob:</span>
<span class="sd">            Probability of swapping each parameter of the parents during crossover.</span>

<span class="sd">        seed:</span>
<span class="sd">            Seed for random number generator.</span>

<span class="sd">        constraints_func:</span>
<span class="sd">            An optional function that computes the objective constraints. It must take a</span>
<span class="sd">            :class:`~optuna.trial.FrozenTrial` and return the constraints. The return value must</span>
<span class="sd">            be a sequence of :obj:`float` s. A value strictly larger than 0 means that a</span>
<span class="sd">            constraints is violated. A value equal to or smaller than 0 is considered feasible.</span>
<span class="sd">            If ``constraints_func`` returns more than one value for a trial, that trial is</span>
<span class="sd">            considered feasible if and only if all values are equal to 0 or smaller.</span>

<span class="sd">            The ``constraints_func`` will be evaluated after each successful trial.</span>
<span class="sd">            The function won&#39;t be called when trials fail or they are pruned, but this behavior is</span>
<span class="sd">            subject to change in the future releases.</span>

<span class="sd">            The constraints are handled by the constrained domination. A trial x is said to</span>
<span class="sd">            constrained-dominate a trial y, if any of the following conditions is true:</span>

<span class="sd">            1. Trial x is feasible and trial y is not.</span>
<span class="sd">            2. Trial x and y are both infeasible, but trial x has a smaller overall violation.</span>
<span class="sd">            3. Trial x and y are feasible and trial x dominates trial y.</span>

<span class="sd">            .. note::</span>
<span class="sd">                Added in v2.5.0 as an experimental feature. The interface may change in newer</span>
<span class="sd">                versions without prior notice. See</span>
<span class="sd">                https://github.com/optuna/optuna/releases/tag/v2.5.0.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">population_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span>
        <span class="n">mutation_prob</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">crossover_prob</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.9</span><span class="p">,</span>
        <span class="n">swapping_prob</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span>
        <span class="n">seed</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">constraints_func</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">[[</span><span class="n">FrozenTrial</span><span class="p">],</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">float</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># TODO(ohta): Reconsider the default value of each parameter.</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">population_size</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;`population_size` must be an integer value.&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">population_size</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;`population_size` must be greater than or equal to 2.&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">mutation_prob</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="mf">0.0</span> <span class="o">&lt;=</span> <span class="n">mutation_prob</span> <span class="o">&lt;=</span> <span class="mf">1.0</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;`mutation_prob` must be None or a float value within the range [0.0, 1.0].&quot;</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="mf">0.0</span> <span class="o">&lt;=</span> <span class="n">crossover_prob</span> <span class="o">&lt;=</span> <span class="mf">1.0</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;`crossover_prob` must be a float value within the range [0.0, 1.0].&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="mf">0.0</span> <span class="o">&lt;=</span> <span class="n">swapping_prob</span> <span class="o">&lt;=</span> <span class="mf">1.0</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;`swapping_prob` must be a float value within the range [0.0, 1.0].&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">constraints_func</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                <span class="s2">&quot;The constraints_func option is an experimental feature.&quot;</span>
                <span class="s2">&quot; The interface can change in the future.&quot;</span><span class="p">,</span>
                <span class="n">ExperimentalWarning</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_population_size</span> <span class="o">=</span> <span class="n">population_size</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_mutation_prob</span> <span class="o">=</span> <span class="n">mutation_prob</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_crossover_prob</span> <span class="o">=</span> <span class="n">crossover_prob</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_swapping_prob</span> <span class="o">=</span> <span class="n">swapping_prob</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_random_sampler</span> <span class="o">=</span> <span class="n">RandomSampler</span><span class="p">(</span><span class="n">seed</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_rng</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">RandomState</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_constraints_func</span> <span class="o">=</span> <span class="n">constraints_func</span>

    <span class="k">def</span> <span class="nf">reseed_rng</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_random_sampler</span><span class="o">.</span><span class="n">reseed_rng</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_rng</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">RandomState</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">infer_relative_search_space</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">study</span><span class="p">:</span> <span class="n">Study</span><span class="p">,</span> <span class="n">trial</span><span class="p">:</span> <span class="n">FrozenTrial</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">BaseDistribution</span><span class="p">]:</span>
        <span class="k">return</span> <span class="p">{}</span>

    <span class="k">def</span> <span class="nf">sample_relative</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">study</span><span class="p">:</span> <span class="n">Study</span><span class="p">,</span>
        <span class="n">trial</span><span class="p">:</span> <span class="n">FrozenTrial</span><span class="p">,</span>
        <span class="n">search_space</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">BaseDistribution</span><span class="p">],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
        <span class="n">parent_generation</span><span class="p">,</span> <span class="n">parent_population</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_collect_parent_population</span><span class="p">(</span><span class="n">study</span><span class="p">)</span>
        <span class="n">trial_id</span> <span class="o">=</span> <span class="n">trial</span><span class="o">.</span><span class="n">_trial_id</span>

        <span class="n">generation</span> <span class="o">=</span> <span class="n">parent_generation</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="n">study</span><span class="o">.</span><span class="n">_storage</span><span class="o">.</span><span class="n">set_trial_system_attr</span><span class="p">(</span><span class="n">trial_id</span><span class="p">,</span> <span class="n">_GENERATION_KEY</span><span class="p">,</span> <span class="n">generation</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">parent_generation</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">p0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_select_parent</span><span class="p">(</span><span class="n">study</span><span class="p">,</span> <span class="n">parent_population</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rng</span><span class="o">.</span><span class="n">rand</span><span class="p">()</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_crossover_prob</span><span class="p">:</span>
                <span class="n">p1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_select_parent</span><span class="p">(</span>
                    <span class="n">study</span><span class="p">,</span> <span class="p">[</span><span class="n">t</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">parent_population</span> <span class="k">if</span> <span class="n">t</span><span class="o">.</span><span class="n">_trial_id</span> <span class="o">!=</span> <span class="n">p0</span><span class="o">.</span><span class="n">_trial_id</span><span class="p">]</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">p1</span> <span class="o">=</span> <span class="n">p0</span>

            <span class="n">study</span><span class="o">.</span><span class="n">_storage</span><span class="o">.</span><span class="n">set_trial_system_attr</span><span class="p">(</span>
                <span class="n">trial_id</span><span class="p">,</span> <span class="n">_PARENTS_KEY</span><span class="p">,</span> <span class="p">[</span><span class="n">p0</span><span class="o">.</span><span class="n">_trial_id</span><span class="p">,</span> <span class="n">p1</span><span class="o">.</span><span class="n">_trial_id</span><span class="p">]</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="p">{}</span>

    <span class="k">def</span> <span class="nf">sample_independent</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">study</span><span class="p">:</span> <span class="n">Study</span><span class="p">,</span>
        <span class="n">trial</span><span class="p">:</span> <span class="n">FrozenTrial</span><span class="p">,</span>
        <span class="n">param_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">param_distribution</span><span class="p">:</span> <span class="n">BaseDistribution</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">_PARENTS_KEY</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">trial</span><span class="o">.</span><span class="n">system_attrs</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_random_sampler</span><span class="o">.</span><span class="n">sample_independent</span><span class="p">(</span>
                <span class="n">study</span><span class="p">,</span> <span class="n">trial</span><span class="p">,</span> <span class="n">param_name</span><span class="p">,</span> <span class="n">param_distribution</span>
            <span class="p">)</span>

        <span class="n">p0_id</span><span class="p">,</span> <span class="n">p1_id</span> <span class="o">=</span> <span class="n">trial</span><span class="o">.</span><span class="n">system_attrs</span><span class="p">[</span><span class="n">_PARENTS_KEY</span><span class="p">]</span>
        <span class="n">p0</span> <span class="o">=</span> <span class="n">study</span><span class="o">.</span><span class="n">_storage</span><span class="o">.</span><span class="n">get_trial</span><span class="p">(</span><span class="n">p0_id</span><span class="p">)</span>
        <span class="n">p1</span> <span class="o">=</span> <span class="n">study</span><span class="o">.</span><span class="n">_storage</span><span class="o">.</span><span class="n">get_trial</span><span class="p">(</span><span class="n">p1_id</span><span class="p">)</span>

        <span class="n">param</span> <span class="o">=</span> <span class="n">p0</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">param_name</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">parent_params_len</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">p0</span><span class="o">.</span><span class="n">params</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">param</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rng</span><span class="o">.</span><span class="n">rand</span><span class="p">()</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_swapping_prob</span><span class="p">:</span>
            <span class="n">param</span> <span class="o">=</span> <span class="n">p1</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">param_name</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="n">parent_params_len</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">p1</span><span class="o">.</span><span class="n">params</span><span class="p">)</span>

        <span class="n">mutation_prob</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mutation_prob</span>
        <span class="k">if</span> <span class="n">mutation_prob</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">mutation_prob</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="nb">max</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">parent_params_len</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">param</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rng</span><span class="o">.</span><span class="n">rand</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">mutation_prob</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_random_sampler</span><span class="o">.</span><span class="n">sample_independent</span><span class="p">(</span>
                <span class="n">study</span><span class="p">,</span> <span class="n">trial</span><span class="p">,</span> <span class="n">param_name</span><span class="p">,</span> <span class="n">param_distribution</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">param</span>

    <span class="k">def</span> <span class="nf">_collect_parent_population</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">study</span><span class="p">:</span> <span class="n">Study</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">FrozenTrial</span><span class="p">]]:</span>
        <span class="n">trials</span> <span class="o">=</span> <span class="n">study</span><span class="o">.</span><span class="n">get_trials</span><span class="p">(</span><span class="n">deepcopy</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="n">generation_to_runnings</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
        <span class="n">generation_to_population</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">trial</span> <span class="ow">in</span> <span class="n">trials</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">_GENERATION_KEY</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">trial</span><span class="o">.</span><span class="n">system_attrs</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="n">generation</span> <span class="o">=</span> <span class="n">trial</span><span class="o">.</span><span class="n">system_attrs</span><span class="p">[</span><span class="n">_GENERATION_KEY</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">trial</span><span class="o">.</span><span class="n">state</span> <span class="o">!=</span> <span class="n">optuna</span><span class="o">.</span><span class="n">trial</span><span class="o">.</span><span class="n">TrialState</span><span class="o">.</span><span class="n">COMPLETE</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">trial</span><span class="o">.</span><span class="n">state</span> <span class="o">==</span> <span class="n">optuna</span><span class="o">.</span><span class="n">trial</span><span class="o">.</span><span class="n">TrialState</span><span class="o">.</span><span class="n">RUNNING</span><span class="p">:</span>
                    <span class="n">generation_to_runnings</span><span class="p">[</span><span class="n">generation</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">trial</span><span class="p">)</span>
                <span class="k">continue</span>

            <span class="c1"># Do not use trials whose states are not COMPLETE, or `constraint` will be unavailable.</span>
            <span class="n">generation_to_population</span><span class="p">[</span><span class="n">generation</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">trial</span><span class="p">)</span>

        <span class="n">hasher</span> <span class="o">=</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">sha256</span><span class="p">()</span>
        <span class="n">parent_population</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">FrozenTrial</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">parent_generation</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">generation</span> <span class="o">=</span> <span class="n">parent_generation</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="n">population</span> <span class="o">=</span> <span class="n">generation_to_population</span><span class="p">[</span><span class="n">generation</span><span class="p">]</span>

            <span class="c1"># Under multi-worker settings, the population size might become larger than</span>
            <span class="c1"># `self._population_size`.</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">population</span><span class="p">)</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_population_size</span><span class="p">:</span>
                <span class="k">break</span>

            <span class="c1"># [NOTE]</span>
            <span class="c1"># It&#39;s generally safe to assume that once the above condition is satisfied,</span>
            <span class="c1"># there are no additional individuals added to the generation (i.e., the members of</span>
            <span class="c1"># the generation have been fixed).</span>
            <span class="c1"># If the number of parallel workers is huge, this assumption can be broken, but</span>
            <span class="c1"># this is a very rare case and doesn&#39;t significantly impact optimization performance.</span>
            <span class="c1"># So we can ignore the case.</span>

            <span class="c1"># The cache key is calculated based on the key of the previous generation and</span>
            <span class="c1"># the remaining running trials in the current population.</span>
            <span class="c1"># If there are no running trials, the new cache key becomes exactly the same as</span>
            <span class="c1"># the previous one, and the cached content will be overwritten. This allows us to</span>
            <span class="c1"># skip redundant cache key calculations when this method is called for the subsequent</span>
            <span class="c1"># trials.</span>
            <span class="k">for</span> <span class="n">trial</span> <span class="ow">in</span> <span class="n">generation_to_runnings</span><span class="p">[</span><span class="n">generation</span><span class="p">]:</span>
                <span class="n">hasher</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="nb">bytes</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">trial</span><span class="o">.</span><span class="n">number</span><span class="p">),</span> <span class="s2">&quot;utf-8&quot;</span><span class="p">))</span>

            <span class="n">cache_key</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">:</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">_POPULATION_CACHE_KEY_PREFIX</span><span class="p">,</span> <span class="n">hasher</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">())</span>
            <span class="n">cached_generation</span><span class="p">,</span> <span class="n">cached_population_numbers</span> <span class="o">=</span> <span class="n">study</span><span class="o">.</span><span class="n">system_attrs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                <span class="n">cache_key</span><span class="p">,</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">[])</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">cached_generation</span> <span class="o">&gt;=</span> <span class="n">generation</span><span class="p">:</span>
                <span class="n">generation</span> <span class="o">=</span> <span class="n">cached_generation</span>
                <span class="n">population</span> <span class="o">=</span> <span class="p">[</span><span class="n">trials</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">cached_population_numbers</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">population</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">parent_population</span><span class="p">)</span>
                <span class="n">population</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_select_elite_population</span><span class="p">(</span><span class="n">study</span><span class="p">,</span> <span class="n">population</span><span class="p">)</span>

                <span class="c1"># To reduce the number of system attribute entries,</span>
                <span class="c1"># we cache the population information only if there are no running trials</span>
                <span class="c1"># (i.e., the information of the population has been fixed).</span>
                <span class="c1"># Usually, if there are no too delayed running trials, the single entry</span>
                <span class="c1"># will be used.</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">generation_to_runnings</span><span class="p">[</span><span class="n">generation</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">population_numbers</span> <span class="o">=</span> <span class="p">[</span><span class="n">t</span><span class="o">.</span><span class="n">number</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">population</span><span class="p">]</span>
                    <span class="n">study</span><span class="o">.</span><span class="n">set_system_attr</span><span class="p">(</span><span class="n">cache_key</span><span class="p">,</span> <span class="p">(</span><span class="n">generation</span><span class="p">,</span> <span class="n">population_numbers</span><span class="p">))</span>

            <span class="n">parent_generation</span> <span class="o">=</span> <span class="n">generation</span>
            <span class="n">parent_population</span> <span class="o">=</span> <span class="n">population</span>

        <span class="k">return</span> <span class="n">parent_generation</span><span class="p">,</span> <span class="n">parent_population</span>

    <span class="k">def</span> <span class="nf">_select_elite_population</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">study</span><span class="p">:</span> <span class="n">Study</span><span class="p">,</span> <span class="n">population</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">FrozenTrial</span><span class="p">]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">FrozenTrial</span><span class="p">]:</span>
        <span class="n">elite_population</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">FrozenTrial</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">population_per_rank</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fast_non_dominated_sort</span><span class="p">(</span><span class="n">population</span><span class="p">,</span> <span class="n">study</span><span class="o">.</span><span class="n">directions</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">population</span> <span class="ow">in</span> <span class="n">population_per_rank</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">elite_population</span><span class="p">)</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">population</span><span class="p">)</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_population_size</span><span class="p">:</span>
                <span class="n">elite_population</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">population</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">n</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_population_size</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">elite_population</span><span class="p">)</span>
                <span class="n">_crowding_distance_sort</span><span class="p">(</span><span class="n">population</span><span class="p">)</span>
                <span class="n">elite_population</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">population</span><span class="p">[:</span><span class="n">n</span><span class="p">])</span>
                <span class="k">break</span>

        <span class="k">return</span> <span class="n">elite_population</span>

    <span class="k">def</span> <span class="nf">_select_parent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">study</span><span class="p">:</span> <span class="n">Study</span><span class="p">,</span> <span class="n">population</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">FrozenTrial</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">FrozenTrial</span><span class="p">:</span>
        <span class="c1"># TODO(ohta): Consider to allow users to specify the number of parent candidates.</span>
        <span class="n">population_size</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">population</span><span class="p">)</span>
        <span class="n">candidate0</span> <span class="o">=</span> <span class="n">population</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_rng</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">population_size</span><span class="p">)]</span>
        <span class="n">candidate1</span> <span class="o">=</span> <span class="n">population</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_rng</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">population_size</span><span class="p">)]</span>

        <span class="n">dominates</span> <span class="o">=</span> <span class="n">_dominates</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_constraints_func</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">_constrained_dominates</span>

        <span class="c1"># TODO(ohta): Consider crowding distance.</span>
        <span class="k">if</span> <span class="n">dominates</span><span class="p">(</span><span class="n">candidate0</span><span class="p">,</span> <span class="n">candidate1</span><span class="p">,</span> <span class="n">study</span><span class="o">.</span><span class="n">directions</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">candidate0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">candidate1</span>

    <span class="k">def</span> <span class="nf">_fast_non_dominated_sort</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">population</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">FrozenTrial</span><span class="p">],</span>
        <span class="n">directions</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">optuna</span><span class="o">.</span><span class="n">study</span><span class="o">.</span><span class="n">StudyDirection</span><span class="p">],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">FrozenTrial</span><span class="p">]]:</span>
        <span class="n">dominated_count</span><span class="p">:</span> <span class="n">DefaultDict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
        <span class="n">dominates_list</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>

        <span class="n">dominates</span> <span class="o">=</span> <span class="n">_dominates</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_constraints_func</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">_constrained_dominates</span>

        <span class="k">for</span> <span class="n">p</span><span class="p">,</span> <span class="n">q</span> <span class="ow">in</span> <span class="n">itertools</span><span class="o">.</span><span class="n">combinations</span><span class="p">(</span><span class="n">population</span><span class="p">,</span> <span class="mi">2</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">dominates</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">directions</span><span class="p">):</span>
                <span class="n">dominates_list</span><span class="p">[</span><span class="n">p</span><span class="o">.</span><span class="n">number</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">q</span><span class="o">.</span><span class="n">number</span><span class="p">)</span>
                <span class="n">dominated_count</span><span class="p">[</span><span class="n">q</span><span class="o">.</span><span class="n">number</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">elif</span> <span class="n">dominates</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">directions</span><span class="p">):</span>
                <span class="n">dominates_list</span><span class="p">[</span><span class="n">q</span><span class="o">.</span><span class="n">number</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">number</span><span class="p">)</span>
                <span class="n">dominated_count</span><span class="p">[</span><span class="n">p</span><span class="o">.</span><span class="n">number</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="n">population_per_rank</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">while</span> <span class="n">population</span><span class="p">:</span>
            <span class="n">non_dominated_population</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">while</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">population</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">dominated_count</span><span class="p">[</span><span class="n">population</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">number</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">individual</span> <span class="o">=</span> <span class="n">population</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">population</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">population</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">population</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">population</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
                    <span class="n">non_dominated_population</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">individual</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">non_dominated_population</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">dominates_list</span><span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">number</span><span class="p">]:</span>
                    <span class="n">dominated_count</span><span class="p">[</span><span class="n">y</span><span class="p">]</span> <span class="o">-=</span> <span class="mi">1</span>

            <span class="k">assert</span> <span class="n">non_dominated_population</span>
            <span class="n">population_per_rank</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">non_dominated_population</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">population_per_rank</span>

    <span class="k">def</span> <span class="nf">after_trial</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">study</span><span class="p">:</span> <span class="n">Study</span><span class="p">,</span>
        <span class="n">trial</span><span class="p">:</span> <span class="n">FrozenTrial</span><span class="p">,</span>
        <span class="n">state</span><span class="p">:</span> <span class="n">TrialState</span><span class="p">,</span>
        <span class="n">values</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="nb">float</span><span class="p">]],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">assert</span> <span class="n">state</span> <span class="ow">in</span> <span class="p">[</span><span class="n">TrialState</span><span class="o">.</span><span class="n">COMPLETE</span><span class="p">,</span> <span class="n">TrialState</span><span class="o">.</span><span class="n">FAIL</span><span class="p">,</span> <span class="n">TrialState</span><span class="o">.</span><span class="n">PRUNED</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">state</span> <span class="o">==</span> <span class="n">TrialState</span><span class="o">.</span><span class="n">COMPLETE</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_constraints_func</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">constraints</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">con</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_constraints_func</span><span class="p">(</span><span class="n">trial</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">con</span><span class="p">,</span> <span class="p">(</span><span class="nb">tuple</span><span class="p">,</span> <span class="nb">list</span><span class="p">)):</span>
                    <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;Constraints should be a sequence of floats but got </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">con</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">.&quot;</span>
                    <span class="p">)</span>
                <span class="n">constraints</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">con</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="k">raise</span>
            <span class="k">finally</span><span class="p">:</span>
                <span class="k">assert</span> <span class="n">constraints</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">constraints</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)</span>

                <span class="n">study</span><span class="o">.</span><span class="n">_storage</span><span class="o">.</span><span class="n">set_trial_system_attr</span><span class="p">(</span>
                    <span class="n">trial</span><span class="o">.</span><span class="n">_trial_id</span><span class="p">,</span>
                    <span class="n">_CONSTRAINTS_KEY</span><span class="p">,</span>
                    <span class="n">constraints</span><span class="p">,</span>
                <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_random_sampler</span><span class="o">.</span><span class="n">after_trial</span><span class="p">(</span><span class="n">study</span><span class="p">,</span> <span class="n">trial</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">










  <div class="doc doc-object doc-method">



<h2 id="optuna.samplers._nsga2.NSGAIISampler.after_trial" class="doc doc-heading">
<code class="highlight language-python"><span class="n">after_trial</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">study</span><span class="p">,</span> <span class="n">trial</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span></code>


</h2>

    <div class="doc doc-contents ">

      <p>Trial post-processing.</p>
<p>This method is called after the objective function returns and right before the trials is
finished and its state is stored.</p>
<p>.. note::
    Added in v2.4.0 as an experimental feature. The interface may change in newer versions
    without prior notice. See https://github.com/optuna/optuna/releases/tag/v2.4.0.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>study</code></td>
        <td><code>Study</code></td>
        <td><p>Target study object.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>trial</code></td>
        <td><code>FrozenTrial</code></td>
        <td><p>Target trial object.
Take a copy before modifying this object.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>state</code></td>
        <td><code>TrialState</code></td>
        <td><p>Resulting trial state.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>values</code></td>
        <td><code>Optional[Sequence[float]]</code></td>
        <td><p>Resulting trial values. Guaranteed to not be :obj:<code>None</code> if trial succeeded.</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>optuna/samplers/_nsga2.py</code></summary>
          <div class="highlight"><span class="filename">Python</span><pre><span></span><code><span class="k">def</span> <span class="nf">after_trial</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">study</span><span class="p">:</span> <span class="n">Study</span><span class="p">,</span>
    <span class="n">trial</span><span class="p">:</span> <span class="n">FrozenTrial</span><span class="p">,</span>
    <span class="n">state</span><span class="p">:</span> <span class="n">TrialState</span><span class="p">,</span>
    <span class="n">values</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="nb">float</span><span class="p">]],</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="k">assert</span> <span class="n">state</span> <span class="ow">in</span> <span class="p">[</span><span class="n">TrialState</span><span class="o">.</span><span class="n">COMPLETE</span><span class="p">,</span> <span class="n">TrialState</span><span class="o">.</span><span class="n">FAIL</span><span class="p">,</span> <span class="n">TrialState</span><span class="o">.</span><span class="n">PRUNED</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">state</span> <span class="o">==</span> <span class="n">TrialState</span><span class="o">.</span><span class="n">COMPLETE</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_constraints_func</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">constraints</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">con</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_constraints_func</span><span class="p">(</span><span class="n">trial</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">con</span><span class="p">,</span> <span class="p">(</span><span class="nb">tuple</span><span class="p">,</span> <span class="nb">list</span><span class="p">)):</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Constraints should be a sequence of floats but got </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">con</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">.&quot;</span>
                <span class="p">)</span>
            <span class="n">constraints</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">con</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">raise</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">constraints</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">constraints</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)</span>

            <span class="n">study</span><span class="o">.</span><span class="n">_storage</span><span class="o">.</span><span class="n">set_trial_system_attr</span><span class="p">(</span>
                <span class="n">trial</span><span class="o">.</span><span class="n">_trial_id</span><span class="p">,</span>
                <span class="n">_CONSTRAINTS_KEY</span><span class="p">,</span>
                <span class="n">constraints</span><span class="p">,</span>
            <span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_random_sampler</span><span class="o">.</span><span class="n">after_trial</span><span class="p">(</span><span class="n">study</span><span class="p">,</span> <span class="n">trial</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h2 id="optuna.samplers._nsga2.NSGAIISampler.infer_relative_search_space" class="doc doc-heading">
<code class="highlight language-python"><span class="n">infer_relative_search_space</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">study</span><span class="p">,</span> <span class="n">trial</span><span class="p">)</span></code>


</h2>

    <div class="doc doc-contents ">

      <p>Infer the search space that will be used by relative sampling in the target trial.</p>
<p>This method is called right before :func:<code>~optuna.samplers.BaseSampler.sample_relative</code>
method, and the search space returned by this method is passed to it. The parameters not
contained in the search space will be sampled by using
:func:<code>~optuna.samplers.BaseSampler.sample_independent</code> method.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>study</code></td>
        <td><code>Study</code></td>
        <td><p>Target study object.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>trial</code></td>
        <td><code>FrozenTrial</code></td>
        <td><p>Target trial object.
Take a copy before modifying this object.</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>Dict[str, optuna.distributions.BaseDistribution]</code></td>
      <td><p>A dictionary containing the parameter names and parameter's distributions.</p></td>
    </tr>
  </tbody>
</table>      <p>.. seealso::
    Please refer to :func:<code>~optuna.samplers.intersection_search_space</code> as an
    implementation of :func:<code>~optuna.samplers.BaseSampler.infer_relative_search_space</code>.</p>

        <details class="quote">
          <summary>Source code in <code>optuna/samplers/_nsga2.py</code></summary>
          <div class="highlight"><span class="filename">Python</span><pre><span></span><code><span class="k">def</span> <span class="nf">infer_relative_search_space</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">study</span><span class="p">:</span> <span class="n">Study</span><span class="p">,</span> <span class="n">trial</span><span class="p">:</span> <span class="n">FrozenTrial</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">BaseDistribution</span><span class="p">]:</span>
    <span class="k">return</span> <span class="p">{}</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h2 id="optuna.samplers._nsga2.NSGAIISampler.reseed_rng" class="doc doc-heading">
<code class="highlight language-python"><span class="n">reseed_rng</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>


</h2>

    <div class="doc doc-contents ">

      <p>Reseed sampler's random number generator.</p>
<p>This method is called by the :class:<code>~optuna.study.Study</code> instance if trials are executed
in parallel with the option <code>n_jobs&gt;1</code>. In that case, the sampler instance will be
replicated including the state of the random number generator, and they may suggest the
same values. To prevent this issue, this method assigns a different seed to each random
number generator.</p>

        <details class="quote">
          <summary>Source code in <code>optuna/samplers/_nsga2.py</code></summary>
          <div class="highlight"><span class="filename">Python</span><pre><span></span><code><span class="k">def</span> <span class="nf">reseed_rng</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_random_sampler</span><span class="o">.</span><span class="n">reseed_rng</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_rng</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">RandomState</span><span class="p">()</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h2 id="optuna.samplers._nsga2.NSGAIISampler.sample_independent" class="doc doc-heading">
<code class="highlight language-python"><span class="n">sample_independent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">study</span><span class="p">,</span> <span class="n">trial</span><span class="p">,</span> <span class="n">param_name</span><span class="p">,</span> <span class="n">param_distribution</span><span class="p">)</span></code>


</h2>

    <div class="doc doc-contents ">

      <p>Sample a parameter for a given distribution.</p>
<p>This method is called only for the parameters not contained in the search space returned
by :func:<code>~optuna.samplers.BaseSampler.sample_relative</code> method. This method is suitable
for sampling algorithms that do not use relationship between parameters such as random
sampling and TPE.</p>
<p>.. note::
        The failed trials are ignored by any build-in samplers when they sample new
        parameters. Thus, failed trials are regarded as deleted in the samplers'
        perspective.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>study</code></td>
        <td><code>Study</code></td>
        <td><p>Target study object.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>trial</code></td>
        <td><code>FrozenTrial</code></td>
        <td><p>Target trial object.
Take a copy before modifying this object.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>param_name</code></td>
        <td><code>str</code></td>
        <td><p>Name of the sampled parameter.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>param_distribution</code></td>
        <td><code>BaseDistribution</code></td>
        <td><p>Distribution object that specifies a prior and/or scale of the sampling algorithm.</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>Any</code></td>
      <td><p>A parameter value.</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>optuna/samplers/_nsga2.py</code></summary>
          <div class="highlight"><span class="filename">Python</span><pre><span></span><code><span class="k">def</span> <span class="nf">sample_independent</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">study</span><span class="p">:</span> <span class="n">Study</span><span class="p">,</span>
    <span class="n">trial</span><span class="p">:</span> <span class="n">FrozenTrial</span><span class="p">,</span>
    <span class="n">param_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">param_distribution</span><span class="p">:</span> <span class="n">BaseDistribution</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">_PARENTS_KEY</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">trial</span><span class="o">.</span><span class="n">system_attrs</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_random_sampler</span><span class="o">.</span><span class="n">sample_independent</span><span class="p">(</span>
            <span class="n">study</span><span class="p">,</span> <span class="n">trial</span><span class="p">,</span> <span class="n">param_name</span><span class="p">,</span> <span class="n">param_distribution</span>
        <span class="p">)</span>

    <span class="n">p0_id</span><span class="p">,</span> <span class="n">p1_id</span> <span class="o">=</span> <span class="n">trial</span><span class="o">.</span><span class="n">system_attrs</span><span class="p">[</span><span class="n">_PARENTS_KEY</span><span class="p">]</span>
    <span class="n">p0</span> <span class="o">=</span> <span class="n">study</span><span class="o">.</span><span class="n">_storage</span><span class="o">.</span><span class="n">get_trial</span><span class="p">(</span><span class="n">p0_id</span><span class="p">)</span>
    <span class="n">p1</span> <span class="o">=</span> <span class="n">study</span><span class="o">.</span><span class="n">_storage</span><span class="o">.</span><span class="n">get_trial</span><span class="p">(</span><span class="n">p1_id</span><span class="p">)</span>

    <span class="n">param</span> <span class="o">=</span> <span class="n">p0</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">param_name</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">parent_params_len</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">p0</span><span class="o">.</span><span class="n">params</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">param</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rng</span><span class="o">.</span><span class="n">rand</span><span class="p">()</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_swapping_prob</span><span class="p">:</span>
        <span class="n">param</span> <span class="o">=</span> <span class="n">p1</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">param_name</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">parent_params_len</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">p1</span><span class="o">.</span><span class="n">params</span><span class="p">)</span>

    <span class="n">mutation_prob</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mutation_prob</span>
    <span class="k">if</span> <span class="n">mutation_prob</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">mutation_prob</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="nb">max</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">parent_params_len</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">param</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rng</span><span class="o">.</span><span class="n">rand</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">mutation_prob</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_random_sampler</span><span class="o">.</span><span class="n">sample_independent</span><span class="p">(</span>
            <span class="n">study</span><span class="p">,</span> <span class="n">trial</span><span class="p">,</span> <span class="n">param_name</span><span class="p">,</span> <span class="n">param_distribution</span>
        <span class="p">)</span>

    <span class="k">return</span> <span class="n">param</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h2 id="optuna.samplers._nsga2.NSGAIISampler.sample_relative" class="doc doc-heading">
<code class="highlight language-python"><span class="n">sample_relative</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">study</span><span class="p">,</span> <span class="n">trial</span><span class="p">,</span> <span class="n">search_space</span><span class="p">)</span></code>


</h2>

    <div class="doc doc-contents ">

      <p>Sample parameters in a given search space.</p>
<p>This method is called once at the beginning of each trial, i.e., right before the
evaluation of the objective function. This method is suitable for sampling algorithms
that use relationship between parameters such as Gaussian Process and CMA-ES.</p>
<p>.. note::
        The failed trials are ignored by any build-in samplers when they sample new
        parameters. Thus, failed trials are regarded as deleted in the samplers'
        perspective.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>study</code></td>
        <td><code>Study</code></td>
        <td><p>Target study object.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>trial</code></td>
        <td><code>FrozenTrial</code></td>
        <td><p>Target trial object.
Take a copy before modifying this object.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>search_space</code></td>
        <td><code>Dict[str, optuna.distributions.BaseDistribution]</code></td>
        <td><p>The search space returned by
:func:<code>~optuna.samplers.BaseSampler.infer_relative_search_space</code>.</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>Dict[str, Any]</code></td>
      <td><p>A dictionary containing the parameter names and the values.</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>optuna/samplers/_nsga2.py</code></summary>
          <div class="highlight"><span class="filename">Python</span><pre><span></span><code><span class="k">def</span> <span class="nf">sample_relative</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">study</span><span class="p">:</span> <span class="n">Study</span><span class="p">,</span>
    <span class="n">trial</span><span class="p">:</span> <span class="n">FrozenTrial</span><span class="p">,</span>
    <span class="n">search_space</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">BaseDistribution</span><span class="p">],</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
    <span class="n">parent_generation</span><span class="p">,</span> <span class="n">parent_population</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_collect_parent_population</span><span class="p">(</span><span class="n">study</span><span class="p">)</span>
    <span class="n">trial_id</span> <span class="o">=</span> <span class="n">trial</span><span class="o">.</span><span class="n">_trial_id</span>

    <span class="n">generation</span> <span class="o">=</span> <span class="n">parent_generation</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="n">study</span><span class="o">.</span><span class="n">_storage</span><span class="o">.</span><span class="n">set_trial_system_attr</span><span class="p">(</span><span class="n">trial_id</span><span class="p">,</span> <span class="n">_GENERATION_KEY</span><span class="p">,</span> <span class="n">generation</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">parent_generation</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">p0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_select_parent</span><span class="p">(</span><span class="n">study</span><span class="p">,</span> <span class="n">parent_population</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rng</span><span class="o">.</span><span class="n">rand</span><span class="p">()</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_crossover_prob</span><span class="p">:</span>
            <span class="n">p1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_select_parent</span><span class="p">(</span>
                <span class="n">study</span><span class="p">,</span> <span class="p">[</span><span class="n">t</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">parent_population</span> <span class="k">if</span> <span class="n">t</span><span class="o">.</span><span class="n">_trial_id</span> <span class="o">!=</span> <span class="n">p0</span><span class="o">.</span><span class="n">_trial_id</span><span class="p">]</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">p1</span> <span class="o">=</span> <span class="n">p0</span>

        <span class="n">study</span><span class="o">.</span><span class="n">_storage</span><span class="o">.</span><span class="n">set_trial_system_attr</span><span class="p">(</span>
            <span class="n">trial_id</span><span class="p">,</span> <span class="n">_PARENTS_KEY</span><span class="p">,</span> <span class="p">[</span><span class="n">p0</span><span class="o">.</span><span class="n">_trial_id</span><span class="p">,</span> <span class="n">p1</span><span class="o">.</span><span class="n">_trial_id</span><span class="p">]</span>
        <span class="p">)</span>

    <span class="k">return</span> <span class="p">{}</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>

<h2 id="cmaes"><code>CMAES</code></h2>
<p>This sampler is from and maintained by <code>optuna</code> but included here for convienience.</p>


  <div class="doc doc-object doc-class">

<a id="optuna.samplers._cmaes.CmaEsSampler"></a>
    <div class="doc doc-contents first">

      <p>A sampler using <code>cmaes &lt;https://github.com/CyberAgentAILab/cmaes&gt;</code>_ as the backend.</p>

<p><strong>Examples:</strong></p>
    <p>Optimize a simple quadratic function by using :class:<code>~optuna.samplers.CmaEsSampler</code>.</p>
<p>.. testcode::</p>
<div class="codehilite"><pre><span></span><code>import optuna


def objective(trial):
    x = trial.suggest_float(&quot;x&quot;, -1, 1)
    y = trial.suggest_int(&quot;y&quot;, -1, 1)
    return x ** 2 + y


sampler = optuna.samplers.CmaEsSampler()
study = optuna.create_study(sampler=sampler)
study.optimize(objective, n_trials=20)
</code></pre></div>
      <p>Please note that this sampler does not support CategoricalDistribution.
However, :class:<code>~optuna.distributions.DiscreteUniformDistribution</code>
(:func:<code>~optuna.trial.Trial.suggest_discrete_uniform</code>) and
Int(Log)Distribution (:func:<code>~optuna.trial.Trial.suggest_int</code>) are supported.</p>
<p>If your search space contains categorical parameters, I recommend you
to use :class:<code>~optuna.samplers.TPESampler</code> instead.
Furthermore, there is room for performance improvements in parallel
optimization settings. This sampler cannot use some trials for updating
the parameters of multivariate normal distribution.</p>
<p>For further information about CMA-ES algorithm, please refer to the following papers:</p>
<ul>
<li><code>N. Hansen, The CMA Evolution Strategy: A Tutorial. arXiv:1604.00772, 2016.
  &lt;https://arxiv.org/abs/1604.00772&gt;</code>_</li>
<li><code>A. Auger and N. Hansen. A restart CMA evolution strategy with increasing population
  size. In Proceedings of the IEEE Congress on Evolutionary Computation (CEC 2005),
  pages 17691776. IEEE Press, 2005.
  &lt;http://www.cmap.polytechnique.fr/~nikolaus.hansen/cec2005ipopcmaes.pdf&gt;</code>_</li>
<li><code>Raymond Ros, Nikolaus Hansen. A Simple Modification in CMA-ES Achieving Linear Time and
  Space Complexity. 10th International Conference on Parallel Problem Solving From Nature,
  Sep 2008, Dortmund, Germany. inria-00287367.
  &lt;https://hal.inria.fr/inria-00287367/document&gt;</code>_</li>
<li><code>Masahiro Nomura, Shuhei Watanabe, Youhei Akimoto, Yoshihiko Ozaki, Masaki Onishi.
  Warm Starting CMA-ES for Hyperparameter Optimization, AAAI. 2021.
  &lt;https://arxiv.org/abs/2012.06932&gt;</code>_</li>
</ul>
<p>.. seealso::
    You can also use :class:<code>optuna.integration.PyCmaSampler</code> which is a sampler using cma
    library as the backend.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>x0</code></td>
        <td><code>Optional[Dict[str, Any]]</code></td>
        <td><p>A dictionary of an initial parameter values for CMA-ES. By default, the mean of <code>low</code>
and <code>high</code> for each distribution is used. Note that <code>x0</code> is sampled uniformly
within the search space domain for each restart if you specify <code>restart_strategy</code>
argument.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>sigma0</code></td>
        <td><code>Optional[float]</code></td>
        <td><p>Initial standard deviation of CMA-ES. By default, <code>sigma0</code> is set to
<code>min_range / 6</code>, where <code>min_range</code> denotes the minimum range of the distributions
in the search space.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>seed</code></td>
        <td><code>Optional[int]</code></td>
        <td><p>A random seed for CMA-ES.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>n_startup_trials</code></td>
        <td><code>int</code></td>
        <td><p>The independent sampling is used instead of the CMA-ES algorithm until the given number
of trials finish in the same study.</p></td>
        <td><code>1</code></td>
      </tr>
      <tr>
        <td><code>independent_sampler</code></td>
        <td><code>Optional[optuna.samplers._base.BaseSampler]</code></td>
        <td><p>A :class:<code>~optuna.samplers.BaseSampler</code> instance that is used for independent
sampling. The parameters not contained in the relative search space are sampled
by this sampler.
The search space for :class:<code>~optuna.samplers.CmaEsSampler</code> is determined by
:func:<code>~optuna.samplers.intersection_search_space()</code>.</p>
<p>If :obj:<code>None</code> is specified, :class:<code>~optuna.samplers.RandomSampler</code> is used
as the default.</p>
<p>.. seealso::
    :class:<code>optuna.samplers</code> module provides built-in independent samplers
    such as :class:<code>~optuna.samplers.RandomSampler</code> and
    :class:<code>~optuna.samplers.TPESampler</code>.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>warn_independent_sampling</code></td>
        <td><code>bool</code></td>
        <td><p>If this is :obj:<code>True</code>, a warning message is emitted when
the value of a parameter is sampled by using an independent sampler.</p>
<p>Note that the parameters of the first trial in a study are always sampled
via an independent sampler, so no warning messages are emitted in this case.</p></td>
        <td><code>True</code></td>
      </tr>
      <tr>
        <td><code>restart_strategy</code></td>
        <td><code>Optional[str]</code></td>
        <td><p>Strategy for restarting CMA-ES optimization when converges to a local minimum.
If given :obj:<code>None</code>, CMA-ES will not restart (default).
If given 'ipop', CMA-ES will restart with increasing population size.
Please see also <code>inc_popsize</code> parameter.</p>
<p>.. note::
    Added in v2.1.0 as an experimental feature. The interface may change in newer
    versions without prior notice. See
    https://github.com/optuna/optuna/releases/tag/v2.1.0.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>inc_popsize</code></td>
        <td><code>int</code></td>
        <td><p>Multiplier for increasing population size before each restart.
This argument will be used when setting <code>restart_strategy = 'ipop'</code>.</p></td>
        <td><code>2</code></td>
      </tr>
      <tr>
        <td><code>consider_pruned_trials</code></td>
        <td><code>bool</code></td>
        <td><p>If this is :obj:<code>True</code>, the PRUNED trials are considered for sampling.</p>
<p>.. note::
    Added in v2.0.0 as an experimental feature. The interface may change in newer
    versions without prior notice. See
    https://github.com/optuna/optuna/releases/tag/v2.0.0.</p>
<p>.. note::
    It is suggested to set this flag :obj:<code>False</code> when the
    :class:<code>~optuna.pruners.MedianPruner</code> is used. On the other hand, it is suggested
    to set this flag :obj:<code>True</code> when the :class:<code>~optuna.pruners.HyperbandPruner</code> is
    used. Please see <code>the benchmark result
    &lt;https://github.com/optuna/optuna/pull/1229&gt;</code>_ for the details.</p></td>
        <td><code>False</code></td>
      </tr>
      <tr>
        <td><code>use_separable_cma</code></td>
        <td><code>bool</code></td>
        <td><p>If this is :obj:<code>True</code>, the covariance matrix is constrained to be diagonal.
Due to reduce the model complexity, the learning rate for the covariance matrix
is increased. Consequently, this algorithm outperforms CMA-ES on separable functions.</p>
<p>.. note::
    Added in v2.6.0 as an experimental feature. The interface may change in newer
    versions without prior notice. See
    https://github.com/optuna/optuna/releases/tag/v2.6.0.</p></td>
        <td><code>False</code></td>
      </tr>
      <tr>
        <td><code>source_trials</code></td>
        <td><code>Optional[List[optuna.trial._frozen.FrozenTrial]]</code></td>
        <td><p>This option is for Warm Starting CMA-ES, a method to transfer prior knowledge on
similar HPO tasks through the initialization of CMA-ES. This method estimates a
promising distribution from <code>source_trials</code> and generates the parameter of
multivariate gaussian distribution. Please note that it is prohibited to use
<code>x0</code>, <code>sigma0</code>, or <code>use_separable_cma</code> argument together.</p>
<p>.. note::
    Added in v2.6.0 as an experimental feature. The interface may change in newer
    versions without prior notice. See
    https://github.com/optuna/optuna/releases/tag/v2.6.0.</p></td>
        <td><code>None</code></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>optuna/samplers/_cmaes.py</code></summary>
          <div class="highlight"><span class="filename">Python</span><pre><span></span><code><span class="k">class</span> <span class="nc">CmaEsSampler</span><span class="p">(</span><span class="n">BaseSampler</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A sampler using `cmaes &lt;https://github.com/CyberAgentAILab/cmaes&gt;`_ as the backend.</span>

<span class="sd">    Example:</span>

<span class="sd">        Optimize a simple quadratic function by using :class:`~optuna.samplers.CmaEsSampler`.</span>

<span class="sd">        .. testcode::</span>

<span class="sd">            import optuna</span>


<span class="sd">            def objective(trial):</span>
<span class="sd">                x = trial.suggest_float(&quot;x&quot;, -1, 1)</span>
<span class="sd">                y = trial.suggest_int(&quot;y&quot;, -1, 1)</span>
<span class="sd">                return x ** 2 + y</span>


<span class="sd">            sampler = optuna.samplers.CmaEsSampler()</span>
<span class="sd">            study = optuna.create_study(sampler=sampler)</span>
<span class="sd">            study.optimize(objective, n_trials=20)</span>

<span class="sd">    Please note that this sampler does not support CategoricalDistribution.</span>
<span class="sd">    However, :class:`~optuna.distributions.DiscreteUniformDistribution`</span>
<span class="sd">    (:func:`~optuna.trial.Trial.suggest_discrete_uniform`) and</span>
<span class="sd">    Int(Log)Distribution (:func:`~optuna.trial.Trial.suggest_int`) are supported.</span>

<span class="sd">    If your search space contains categorical parameters, I recommend you</span>
<span class="sd">    to use :class:`~optuna.samplers.TPESampler` instead.</span>
<span class="sd">    Furthermore, there is room for performance improvements in parallel</span>
<span class="sd">    optimization settings. This sampler cannot use some trials for updating</span>
<span class="sd">    the parameters of multivariate normal distribution.</span>

<span class="sd">    For further information about CMA-ES algorithm, please refer to the following papers:</span>

<span class="sd">    - `N. Hansen, The CMA Evolution Strategy: A Tutorial. arXiv:1604.00772, 2016.</span>
<span class="sd">      &lt;https://arxiv.org/abs/1604.00772&gt;`_</span>
<span class="sd">    - `A. Auger and N. Hansen. A restart CMA evolution strategy with increasing population</span>
<span class="sd">      size. In Proceedings of the IEEE Congress on Evolutionary Computation (CEC 2005),</span>
<span class="sd">      pages 17691776. IEEE Press, 2005.</span>
<span class="sd">      &lt;http://www.cmap.polytechnique.fr/~nikolaus.hansen/cec2005ipopcmaes.pdf&gt;`_</span>
<span class="sd">    - `Raymond Ros, Nikolaus Hansen. A Simple Modification in CMA-ES Achieving Linear Time and</span>
<span class="sd">      Space Complexity. 10th International Conference on Parallel Problem Solving From Nature,</span>
<span class="sd">      Sep 2008, Dortmund, Germany. inria-00287367.</span>
<span class="sd">      &lt;https://hal.inria.fr/inria-00287367/document&gt;`_</span>
<span class="sd">    - `Masahiro Nomura, Shuhei Watanabe, Youhei Akimoto, Yoshihiko Ozaki, Masaki Onishi.</span>
<span class="sd">      Warm Starting CMA-ES for Hyperparameter Optimization, AAAI. 2021.</span>
<span class="sd">      &lt;https://arxiv.org/abs/2012.06932&gt;`_</span>

<span class="sd">    .. seealso::</span>
<span class="sd">        You can also use :class:`optuna.integration.PyCmaSampler` which is a sampler using cma</span>
<span class="sd">        library as the backend.</span>

<span class="sd">    Args:</span>

<span class="sd">        x0:</span>
<span class="sd">            A dictionary of an initial parameter values for CMA-ES. By default, the mean of ``low``</span>
<span class="sd">            and ``high`` for each distribution is used. Note that ``x0`` is sampled uniformly</span>
<span class="sd">            within the search space domain for each restart if you specify ``restart_strategy``</span>
<span class="sd">            argument.</span>

<span class="sd">        sigma0:</span>
<span class="sd">            Initial standard deviation of CMA-ES. By default, ``sigma0`` is set to</span>
<span class="sd">            ``min_range / 6``, where ``min_range`` denotes the minimum range of the distributions</span>
<span class="sd">            in the search space.</span>

<span class="sd">        seed:</span>
<span class="sd">            A random seed for CMA-ES.</span>

<span class="sd">        n_startup_trials:</span>
<span class="sd">            The independent sampling is used instead of the CMA-ES algorithm until the given number</span>
<span class="sd">            of trials finish in the same study.</span>

<span class="sd">        independent_sampler:</span>
<span class="sd">            A :class:`~optuna.samplers.BaseSampler` instance that is used for independent</span>
<span class="sd">            sampling. The parameters not contained in the relative search space are sampled</span>
<span class="sd">            by this sampler.</span>
<span class="sd">            The search space for :class:`~optuna.samplers.CmaEsSampler` is determined by</span>
<span class="sd">            :func:`~optuna.samplers.intersection_search_space()`.</span>

<span class="sd">            If :obj:`None` is specified, :class:`~optuna.samplers.RandomSampler` is used</span>
<span class="sd">            as the default.</span>

<span class="sd">            .. seealso::</span>
<span class="sd">                :class:`optuna.samplers` module provides built-in independent samplers</span>
<span class="sd">                such as :class:`~optuna.samplers.RandomSampler` and</span>
<span class="sd">                :class:`~optuna.samplers.TPESampler`.</span>

<span class="sd">        warn_independent_sampling:</span>
<span class="sd">            If this is :obj:`True`, a warning message is emitted when</span>
<span class="sd">            the value of a parameter is sampled by using an independent sampler.</span>

<span class="sd">            Note that the parameters of the first trial in a study are always sampled</span>
<span class="sd">            via an independent sampler, so no warning messages are emitted in this case.</span>

<span class="sd">        restart_strategy:</span>
<span class="sd">            Strategy for restarting CMA-ES optimization when converges to a local minimum.</span>
<span class="sd">            If given :obj:`None`, CMA-ES will not restart (default).</span>
<span class="sd">            If given &#39;ipop&#39;, CMA-ES will restart with increasing population size.</span>
<span class="sd">            Please see also ``inc_popsize`` parameter.</span>

<span class="sd">            .. note::</span>
<span class="sd">                Added in v2.1.0 as an experimental feature. The interface may change in newer</span>
<span class="sd">                versions without prior notice. See</span>
<span class="sd">                https://github.com/optuna/optuna/releases/tag/v2.1.0.</span>

<span class="sd">        inc_popsize:</span>
<span class="sd">            Multiplier for increasing population size before each restart.</span>
<span class="sd">            This argument will be used when setting ``restart_strategy = &#39;ipop&#39;``.</span>

<span class="sd">        consider_pruned_trials:</span>
<span class="sd">            If this is :obj:`True`, the PRUNED trials are considered for sampling.</span>

<span class="sd">            .. note::</span>
<span class="sd">                Added in v2.0.0 as an experimental feature. The interface may change in newer</span>
<span class="sd">                versions without prior notice. See</span>
<span class="sd">                https://github.com/optuna/optuna/releases/tag/v2.0.0.</span>

<span class="sd">            .. note::</span>
<span class="sd">                It is suggested to set this flag :obj:`False` when the</span>
<span class="sd">                :class:`~optuna.pruners.MedianPruner` is used. On the other hand, it is suggested</span>
<span class="sd">                to set this flag :obj:`True` when the :class:`~optuna.pruners.HyperbandPruner` is</span>
<span class="sd">                used. Please see `the benchmark result</span>
<span class="sd">                &lt;https://github.com/optuna/optuna/pull/1229&gt;`_ for the details.</span>

<span class="sd">        use_separable_cma:</span>
<span class="sd">            If this is :obj:`True`, the covariance matrix is constrained to be diagonal.</span>
<span class="sd">            Due to reduce the model complexity, the learning rate for the covariance matrix</span>
<span class="sd">            is increased. Consequently, this algorithm outperforms CMA-ES on separable functions.</span>

<span class="sd">            .. note::</span>
<span class="sd">                Added in v2.6.0 as an experimental feature. The interface may change in newer</span>
<span class="sd">                versions without prior notice. See</span>
<span class="sd">                https://github.com/optuna/optuna/releases/tag/v2.6.0.</span>

<span class="sd">        source_trials:</span>
<span class="sd">            This option is for Warm Starting CMA-ES, a method to transfer prior knowledge on</span>
<span class="sd">            similar HPO tasks through the initialization of CMA-ES. This method estimates a</span>
<span class="sd">            promising distribution from ``source_trials`` and generates the parameter of</span>
<span class="sd">            multivariate gaussian distribution. Please note that it is prohibited to use</span>
<span class="sd">            ``x0``, ``sigma0``, or ``use_separable_cma`` argument together.</span>

<span class="sd">            .. note::</span>
<span class="sd">                Added in v2.6.0 as an experimental feature. The interface may change in newer</span>
<span class="sd">                versions without prior notice. See</span>
<span class="sd">                https://github.com/optuna/optuna/releases/tag/v2.6.0.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError:</span>
<span class="sd">            If ``restart_strategy`` is not &#39;ipop&#39; or :obj:`None`.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">x0</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">sigma0</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">n_startup_trials</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
        <span class="n">independent_sampler</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">BaseSampler</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">warn_independent_sampling</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">seed</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">consider_pruned_trials</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">restart_strategy</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">inc_popsize</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
        <span class="n">use_separable_cma</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">source_trials</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">FrozenTrial</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_x0</span> <span class="o">=</span> <span class="n">x0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sigma0</span> <span class="o">=</span> <span class="n">sigma0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_independent_sampler</span> <span class="o">=</span> <span class="n">independent_sampler</span> <span class="ow">or</span> <span class="n">optuna</span><span class="o">.</span><span class="n">samplers</span><span class="o">.</span><span class="n">RandomSampler</span><span class="p">(</span><span class="n">seed</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_n_startup_trials</span> <span class="o">=</span> <span class="n">n_startup_trials</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_warn_independent_sampling</span> <span class="o">=</span> <span class="n">warn_independent_sampling</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cma_rng</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">RandomState</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_search_space</span> <span class="o">=</span> <span class="n">optuna</span><span class="o">.</span><span class="n">samplers</span><span class="o">.</span><span class="n">IntersectionSearchSpace</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_consider_pruned_trials</span> <span class="o">=</span> <span class="n">consider_pruned_trials</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_restart_strategy</span> <span class="o">=</span> <span class="n">restart_strategy</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_inc_popsize</span> <span class="o">=</span> <span class="n">inc_popsize</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_use_separable_cma</span> <span class="o">=</span> <span class="n">use_separable_cma</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_source_trials</span> <span class="o">=</span> <span class="n">source_trials</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_restart_strategy</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                <span class="s2">&quot;`restart_strategy` option is an experimental feature.&quot;</span>
                <span class="s2">&quot; The interface can change in the future.&quot;</span><span class="p">,</span>
                <span class="n">ExperimentalWarning</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_consider_pruned_trials</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                <span class="s2">&quot;`consider_pruned_trials` option is an experimental feature.&quot;</span>
                <span class="s2">&quot; The interface can change in the future.&quot;</span><span class="p">,</span>
                <span class="n">ExperimentalWarning</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_use_separable_cma</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                <span class="s2">&quot;`use_separable_cma` option is an experimental feature.&quot;</span>
                <span class="s2">&quot; The interface can change in the future.&quot;</span><span class="p">,</span>
                <span class="n">ExperimentalWarning</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_source_trials</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                <span class="s2">&quot;`source_trials` option is an experimental feature.&quot;</span>
                <span class="s2">&quot; The interface can change in the future.&quot;</span><span class="p">,</span>
                <span class="n">ExperimentalWarning</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">source_trials</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="p">(</span><span class="n">x0</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">sigma0</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;It is prohibited to pass `source_trials` argument when &quot;</span>
                <span class="s2">&quot;x0 or sigma0 is specified.&quot;</span>
            <span class="p">)</span>

        <span class="c1"># TODO(c-bata): Support WS-sep-CMA-ES.</span>
        <span class="k">if</span> <span class="n">source_trials</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">use_separable_cma</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;It is prohibited to pass `source_trials` argument when &quot;</span> <span class="s2">&quot;using separable CMA-ES.&quot;</span>
            <span class="p">)</span>

        <span class="c1"># TODO(c-bata): Support BIPOP-CMA-ES.</span>
        <span class="k">if</span> <span class="n">restart_strategy</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span>
            <span class="s2">&quot;ipop&quot;</span><span class="p">,</span>
            <span class="kc">None</span><span class="p">,</span>
        <span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;restart_strategy=</span><span class="si">{}</span><span class="s2"> is unsupported. Please specify: &#39;ipop&#39; or None.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">restart_strategy</span>
                <span class="p">)</span>
            <span class="p">)</span>

    <span class="k">def</span> <span class="nf">reseed_rng</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># _cma_rng doesn&#39;t require reseeding because the relative sampling reseeds in each trial.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_independent_sampler</span><span class="o">.</span><span class="n">reseed_rng</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">infer_relative_search_space</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">study</span><span class="p">:</span> <span class="s2">&quot;optuna.Study&quot;</span><span class="p">,</span> <span class="n">trial</span><span class="p">:</span> <span class="s2">&quot;optuna.trial.FrozenTrial&quot;</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">BaseDistribution</span><span class="p">]:</span>
        <span class="n">search_space</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">BaseDistribution</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">distribution</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_search_space</span><span class="o">.</span><span class="n">calculate</span><span class="p">(</span><span class="n">study</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">distribution</span><span class="o">.</span><span class="n">single</span><span class="p">():</span>
                <span class="c1"># `cma` cannot handle distributions that contain just a single value, so we skip</span>
                <span class="c1"># them. Note that the parameter values for such distributions are sampled in</span>
                <span class="c1"># `Trial`.</span>
                <span class="k">continue</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span>
                <span class="n">distribution</span><span class="p">,</span>
                <span class="p">(</span>
                    <span class="n">optuna</span><span class="o">.</span><span class="n">distributions</span><span class="o">.</span><span class="n">UniformDistribution</span><span class="p">,</span>
                    <span class="n">optuna</span><span class="o">.</span><span class="n">distributions</span><span class="o">.</span><span class="n">LogUniformDistribution</span><span class="p">,</span>
                    <span class="n">optuna</span><span class="o">.</span><span class="n">distributions</span><span class="o">.</span><span class="n">DiscreteUniformDistribution</span><span class="p">,</span>
                    <span class="n">optuna</span><span class="o">.</span><span class="n">distributions</span><span class="o">.</span><span class="n">IntUniformDistribution</span><span class="p">,</span>
                    <span class="n">optuna</span><span class="o">.</span><span class="n">distributions</span><span class="o">.</span><span class="n">IntLogUniformDistribution</span><span class="p">,</span>
                <span class="p">),</span>
            <span class="p">):</span>
                <span class="c1"># Categorical distribution is unsupported.</span>
                <span class="k">continue</span>
            <span class="n">search_space</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">distribution</span>

        <span class="k">return</span> <span class="n">search_space</span>

    <span class="k">def</span> <span class="nf">sample_relative</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">study</span><span class="p">:</span> <span class="s2">&quot;optuna.Study&quot;</span><span class="p">,</span>
        <span class="n">trial</span><span class="p">:</span> <span class="s2">&quot;optuna.trial.FrozenTrial&quot;</span><span class="p">,</span>
        <span class="n">search_space</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">BaseDistribution</span><span class="p">],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_raise_error_if_multi_objective</span><span class="p">(</span><span class="n">study</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">search_space</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{}</span>

        <span class="n">completed_trials</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_trials</span><span class="p">(</span><span class="n">study</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">completed_trials</span><span class="p">)</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_n_startup_trials</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{}</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">search_space</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                <span class="s2">&quot;`CmaEsSampler` only supports two or more dimensional continuous &quot;</span>
                <span class="s2">&quot;search space. `</span><span class="si">{}</span><span class="s2">` is used instead of `CmaEsSampler`.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_independent_sampler</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span>
                <span class="p">)</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_warn_independent_sampling</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">return</span> <span class="p">{}</span>

        <span class="n">trans</span> <span class="o">=</span> <span class="n">_SearchSpaceTransform</span><span class="p">(</span><span class="n">search_space</span><span class="p">)</span>

        <span class="n">optimizer</span><span class="p">,</span> <span class="n">n_restarts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_restore_optimizer</span><span class="p">(</span><span class="n">completed_trials</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">optimizer</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">n_restarts</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">optimizer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_init_optimizer</span><span class="p">(</span><span class="n">trans</span><span class="p">,</span> <span class="n">study</span><span class="o">.</span><span class="n">direction</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_restart_strategy</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">generation_attr_key</span> <span class="o">=</span> <span class="s2">&quot;cma:generation&quot;</span>  <span class="c1"># for backward compatibility</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">generation_attr_key</span> <span class="o">=</span> <span class="s2">&quot;cma:restart_</span><span class="si">{}</span><span class="s2">:generation&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">n_restarts</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">optimizer</span><span class="o">.</span><span class="n">dim</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">trans</span><span class="o">.</span><span class="n">bounds</span><span class="p">):</span>
            <span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                <span class="s2">&quot;`CmaEsSampler` does not support dynamic search space. &quot;</span>
                <span class="s2">&quot;`</span><span class="si">{}</span><span class="s2">` is used instead of `CmaEsSampler`.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_independent_sampler</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span>
                <span class="p">)</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_warn_independent_sampling</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">return</span> <span class="p">{}</span>

        <span class="c1"># TODO(c-bata): Reduce the number of wasted trials during parallel optimization.</span>
        <span class="c1"># See https://github.com/optuna/optuna/pull/920#discussion_r385114002 for details.</span>
        <span class="n">solution_trials</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">t</span>
            <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">completed_trials</span>
            <span class="k">if</span> <span class="n">optimizer</span><span class="o">.</span><span class="n">generation</span> <span class="o">==</span> <span class="n">t</span><span class="o">.</span><span class="n">system_attrs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">generation_attr_key</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">solution_trials</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">optimizer</span><span class="o">.</span><span class="n">population_size</span><span class="p">:</span>
            <span class="n">solutions</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">solution_trials</span><span class="p">[:</span> <span class="n">optimizer</span><span class="o">.</span><span class="n">population_size</span><span class="p">]:</span>
                <span class="k">assert</span> <span class="n">t</span><span class="o">.</span><span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;completed trials must have a value&quot;</span>
                <span class="n">x</span> <span class="o">=</span> <span class="n">trans</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">params</span><span class="p">)</span>
                <span class="n">y</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">value</span> <span class="k">if</span> <span class="n">study</span><span class="o">.</span><span class="n">direction</span> <span class="o">==</span> <span class="n">StudyDirection</span><span class="o">.</span><span class="n">MINIMIZE</span> <span class="k">else</span> <span class="o">-</span><span class="n">t</span><span class="o">.</span><span class="n">value</span>
                <span class="n">solutions</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">))</span>

            <span class="n">optimizer</span><span class="o">.</span><span class="n">tell</span><span class="p">(</span><span class="n">solutions</span><span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_restart_strategy</span> <span class="o">==</span> <span class="s2">&quot;ipop&quot;</span> <span class="ow">and</span> <span class="n">optimizer</span><span class="o">.</span><span class="n">should_stop</span><span class="p">():</span>
                <span class="n">n_restarts</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">generation_attr_key</span> <span class="o">=</span> <span class="s2">&quot;cma:restart_</span><span class="si">{}</span><span class="s2">:generation&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">n_restarts</span><span class="p">)</span>
                <span class="n">popsize</span> <span class="o">=</span> <span class="n">optimizer</span><span class="o">.</span><span class="n">population_size</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_inc_popsize</span>
                <span class="n">optimizer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_init_optimizer</span><span class="p">(</span>
                    <span class="n">trans</span><span class="p">,</span> <span class="n">study</span><span class="o">.</span><span class="n">direction</span><span class="p">,</span> <span class="n">population_size</span><span class="o">=</span><span class="n">popsize</span><span class="p">,</span> <span class="n">randomize_start_point</span><span class="o">=</span><span class="kc">True</span>
                <span class="p">)</span>

            <span class="c1"># Store optimizer</span>
            <span class="n">optimizer_str</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">optimizer</span><span class="p">)</span><span class="o">.</span><span class="n">hex</span><span class="p">()</span>
            <span class="n">optimizer_attrs</span> <span class="o">=</span> <span class="n">_split_optimizer_str</span><span class="p">(</span><span class="n">optimizer_str</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">optimizer_attrs</span><span class="p">:</span>
                <span class="n">study</span><span class="o">.</span><span class="n">_storage</span><span class="o">.</span><span class="n">set_trial_system_attr</span><span class="p">(</span><span class="n">trial</span><span class="o">.</span><span class="n">_trial_id</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">optimizer_attrs</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>

        <span class="c1"># Caution: optimizer should update its seed value</span>
        <span class="n">seed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cma_rng</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span> <span class="o">**</span> <span class="mi">16</span><span class="p">)</span> <span class="o">+</span> <span class="n">trial</span><span class="o">.</span><span class="n">number</span>
        <span class="n">optimizer</span><span class="o">.</span><span class="n">_rng</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">RandomState</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>
        <span class="n">params</span> <span class="o">=</span> <span class="n">optimizer</span><span class="o">.</span><span class="n">ask</span><span class="p">()</span>

        <span class="n">study</span><span class="o">.</span><span class="n">_storage</span><span class="o">.</span><span class="n">set_trial_system_attr</span><span class="p">(</span>
            <span class="n">trial</span><span class="o">.</span><span class="n">_trial_id</span><span class="p">,</span> <span class="n">generation_attr_key</span><span class="p">,</span> <span class="n">optimizer</span><span class="o">.</span><span class="n">generation</span>
        <span class="p">)</span>
        <span class="n">study</span><span class="o">.</span><span class="n">_storage</span><span class="o">.</span><span class="n">set_trial_system_attr</span><span class="p">(</span><span class="n">trial</span><span class="o">.</span><span class="n">_trial_id</span><span class="p">,</span> <span class="s2">&quot;cma:n_restarts&quot;</span><span class="p">,</span> <span class="n">n_restarts</span><span class="p">)</span>

        <span class="n">external_values</span> <span class="o">=</span> <span class="n">trans</span><span class="o">.</span><span class="n">untransform</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">external_values</span>

    <span class="k">def</span> <span class="nf">_restore_optimizer</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">completed_trials</span><span class="p">:</span> <span class="s2">&quot;List[optuna.trial.FrozenTrial]&quot;</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="n">CmaClass</span><span class="p">],</span> <span class="nb">int</span><span class="p">]:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_use_separable_cma</span><span class="p">:</span>
            <span class="n">attr_key_optimizer</span> <span class="o">=</span> <span class="s2">&quot;cma:optimizer&quot;</span>
            <span class="n">attr_key_n_restarts</span> <span class="o">=</span> <span class="s2">&quot;cma:n_restarts&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">attr_key_optimizer</span> <span class="o">=</span> <span class="s2">&quot;sepcma:optimizer&quot;</span>
            <span class="n">attr_key_n_restarts</span> <span class="o">=</span> <span class="s2">&quot;sepcma:n_restarts&quot;</span>

        <span class="c1"># Restore a previous CMA object.</span>
        <span class="k">for</span> <span class="n">trial</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="n">completed_trials</span><span class="p">):</span>
            <span class="n">optimizer_attrs</span> <span class="o">=</span> <span class="p">{</span>
                <span class="n">key</span><span class="p">:</span> <span class="n">value</span>
                <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">trial</span><span class="o">.</span><span class="n">system_attrs</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">key</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">attr_key_optimizer</span><span class="p">)</span>
            <span class="p">}</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">optimizer_attrs</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_use_separable_cma</span> <span class="ow">and</span> <span class="s2">&quot;cma:optimizer&quot;</span> <span class="ow">in</span> <span class="n">optimizer_attrs</span><span class="p">:</span>
                <span class="c1"># Check &quot;cma:optimizer&quot; key for backward compatibility.</span>
                <span class="n">optimizer_str</span> <span class="o">=</span> <span class="n">optimizer_attrs</span><span class="p">[</span><span class="s2">&quot;cma:optimizer&quot;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">optimizer_str</span> <span class="o">=</span> <span class="n">_concat_optimizer_attrs</span><span class="p">(</span><span class="n">optimizer_attrs</span><span class="p">)</span>

            <span class="n">n_restarts</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">trial</span><span class="o">.</span><span class="n">system_attrs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">attr_key_n_restarts</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">pickle</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="nb">bytes</span><span class="o">.</span><span class="n">fromhex</span><span class="p">(</span><span class="n">optimizer_str</span><span class="p">)),</span> <span class="n">n_restarts</span>
        <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">_init_optimizer</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">trans</span><span class="p">:</span> <span class="n">_SearchSpaceTransform</span><span class="p">,</span>
        <span class="n">direction</span><span class="p">:</span> <span class="n">StudyDirection</span><span class="p">,</span>
        <span class="n">population_size</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">randomize_start_point</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CmaClass</span><span class="p">:</span>
        <span class="n">lower_bounds</span> <span class="o">=</span> <span class="n">trans</span><span class="o">.</span><span class="n">bounds</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="n">upper_bounds</span> <span class="o">=</span> <span class="n">trans</span><span class="o">.</span><span class="n">bounds</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>
        <span class="n">n_dimension</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">trans</span><span class="o">.</span><span class="n">bounds</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_source_trials</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">randomize_start_point</span><span class="p">:</span>
                <span class="n">mean</span> <span class="o">=</span> <span class="n">lower_bounds</span> <span class="o">+</span> <span class="p">(</span><span class="n">upper_bounds</span> <span class="o">-</span> <span class="n">lower_bounds</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cma_rng</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span>
                    <span class="n">n_dimension</span>
                <span class="p">)</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_x0</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">mean</span> <span class="o">=</span> <span class="n">lower_bounds</span> <span class="o">+</span> <span class="p">(</span><span class="n">upper_bounds</span> <span class="o">-</span> <span class="n">lower_bounds</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># `self._x0` is external representations.</span>
                <span class="n">mean</span> <span class="o">=</span> <span class="n">trans</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_x0</span><span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sigma0</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">sigma0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">((</span><span class="n">upper_bounds</span> <span class="o">-</span> <span class="n">lower_bounds</span><span class="p">)</span> <span class="o">/</span> <span class="mi">6</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">sigma0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sigma0</span>

            <span class="n">cov</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">expected_states</span> <span class="o">=</span> <span class="p">[</span><span class="n">TrialState</span><span class="o">.</span><span class="n">COMPLETE</span><span class="p">]</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_consider_pruned_trials</span><span class="p">:</span>
                <span class="n">expected_states</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">TrialState</span><span class="o">.</span><span class="n">PRUNED</span><span class="p">)</span>

            <span class="c1"># TODO(c-bata): Filter parameters by their values instead of checking search space.</span>
            <span class="n">sign</span> <span class="o">=</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">direction</span> <span class="o">==</span> <span class="n">StudyDirection</span><span class="o">.</span><span class="n">MINIMIZE</span> <span class="k">else</span> <span class="o">-</span><span class="mi">1</span>
            <span class="n">source_solutions</span> <span class="o">=</span> <span class="p">[</span>
                <span class="p">(</span><span class="n">trans</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">params</span><span class="p">),</span> <span class="n">sign</span> <span class="o">*</span> <span class="n">cast</span><span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="n">t</span><span class="o">.</span><span class="n">value</span><span class="p">))</span>
                <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_source_trials</span>
                <span class="k">if</span> <span class="n">t</span><span class="o">.</span><span class="n">state</span> <span class="ow">in</span> <span class="n">expected_states</span>
                <span class="ow">and</span> <span class="n">_is_compatible_search_space</span><span class="p">(</span><span class="n">trans</span><span class="p">,</span> <span class="n">t</span><span class="o">.</span><span class="n">distributions</span><span class="p">)</span>
            <span class="p">]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">source_solutions</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No compatible source_trials&quot;</span><span class="p">)</span>

            <span class="c1"># TODO(c-bata): Add options to change prior parameters (alpha and gamma).</span>
            <span class="n">mean</span><span class="p">,</span> <span class="n">sigma0</span><span class="p">,</span> <span class="n">cov</span> <span class="o">=</span> <span class="n">get_warm_start_mgd</span><span class="p">(</span><span class="n">source_solutions</span><span class="p">)</span>

        <span class="c1"># Avoid ZeroDivisionError in cmaes.</span>
        <span class="n">sigma0</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">sigma0</span><span class="p">,</span> <span class="n">_EPS</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_use_separable_cma</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">SepCMA</span><span class="p">(</span>
                <span class="n">mean</span><span class="o">=</span><span class="n">mean</span><span class="p">,</span>
                <span class="n">sigma</span><span class="o">=</span><span class="n">sigma0</span><span class="p">,</span>
                <span class="n">bounds</span><span class="o">=</span><span class="n">trans</span><span class="o">.</span><span class="n">bounds</span><span class="p">,</span>
                <span class="n">seed</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_cma_rng</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span> <span class="o">**</span> <span class="mi">31</span> <span class="o">-</span> <span class="mi">2</span><span class="p">),</span>
                <span class="n">n_max_resampling</span><span class="o">=</span><span class="mi">10</span> <span class="o">*</span> <span class="n">n_dimension</span><span class="p">,</span>
                <span class="n">population_size</span><span class="o">=</span><span class="n">population_size</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">CMA</span><span class="p">(</span>
            <span class="n">mean</span><span class="o">=</span><span class="n">mean</span><span class="p">,</span>
            <span class="n">sigma</span><span class="o">=</span><span class="n">sigma0</span><span class="p">,</span>
            <span class="n">cov</span><span class="o">=</span><span class="n">cov</span><span class="p">,</span>
            <span class="n">bounds</span><span class="o">=</span><span class="n">trans</span><span class="o">.</span><span class="n">bounds</span><span class="p">,</span>
            <span class="n">seed</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_cma_rng</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span> <span class="o">**</span> <span class="mi">31</span> <span class="o">-</span> <span class="mi">2</span><span class="p">),</span>
            <span class="n">n_max_resampling</span><span class="o">=</span><span class="mi">10</span> <span class="o">*</span> <span class="n">n_dimension</span><span class="p">,</span>
            <span class="n">population_size</span><span class="o">=</span><span class="n">population_size</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">sample_independent</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">study</span><span class="p">:</span> <span class="s2">&quot;optuna.Study&quot;</span><span class="p">,</span>
        <span class="n">trial</span><span class="p">:</span> <span class="s2">&quot;optuna.trial.FrozenTrial&quot;</span><span class="p">,</span>
        <span class="n">param_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">param_distribution</span><span class="p">:</span> <span class="n">BaseDistribution</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_raise_error_if_multi_objective</span><span class="p">(</span><span class="n">study</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_warn_independent_sampling</span><span class="p">:</span>
            <span class="n">complete_trials</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_trials</span><span class="p">(</span><span class="n">study</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">complete_trials</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_n_startup_trials</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_log_independent_sampling</span><span class="p">(</span><span class="n">trial</span><span class="p">,</span> <span class="n">param_name</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_independent_sampler</span><span class="o">.</span><span class="n">sample_independent</span><span class="p">(</span>
            <span class="n">study</span><span class="p">,</span> <span class="n">trial</span><span class="p">,</span> <span class="n">param_name</span><span class="p">,</span> <span class="n">param_distribution</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_log_independent_sampling</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">trial</span><span class="p">:</span> <span class="n">FrozenTrial</span><span class="p">,</span> <span class="n">param_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">_logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
            <span class="s2">&quot;The parameter &#39;</span><span class="si">{}</span><span class="s2">&#39; in trial#</span><span class="si">{}</span><span class="s2"> is sampled independently &quot;</span>
            <span class="s2">&quot;by using `</span><span class="si">{}</span><span class="s2">` instead of `CmaEsSampler` &quot;</span>
            <span class="s2">&quot;(optimization performance may be degraded). &quot;</span>
            <span class="s2">&quot;`CmaEsSampler` does not support dynamic search space or `CategoricalDistribution`. &quot;</span>
            <span class="s2">&quot;You can suppress this warning by setting `warn_independent_sampling` &quot;</span>
            <span class="s2">&quot;to `False` in the constructor of `CmaEsSampler`, &quot;</span>
            <span class="s2">&quot;if this independent sampling is intended behavior.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">param_name</span><span class="p">,</span> <span class="n">trial</span><span class="o">.</span><span class="n">number</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_independent_sampler</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span>
            <span class="p">)</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_get_trials</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">study</span><span class="p">:</span> <span class="s2">&quot;optuna.Study&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">FrozenTrial</span><span class="p">]:</span>
        <span class="n">complete_trials</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">study</span><span class="o">.</span><span class="n">get_trials</span><span class="p">(</span><span class="n">deepcopy</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">t</span><span class="o">.</span><span class="n">state</span> <span class="o">==</span> <span class="n">TrialState</span><span class="o">.</span><span class="n">COMPLETE</span><span class="p">:</span>
                <span class="n">complete_trials</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
            <span class="k">elif</span> <span class="p">(</span>
                <span class="n">t</span><span class="o">.</span><span class="n">state</span> <span class="o">==</span> <span class="n">TrialState</span><span class="o">.</span><span class="n">PRUNED</span>
                <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">intermediate_values</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span>
                <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_consider_pruned_trials</span>
            <span class="p">):</span>
                <span class="n">_</span><span class="p">,</span> <span class="n">value</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">intermediate_values</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
                <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="c1"># We rewrite the value of the trial `t` for sampling, so we need a deepcopy.</span>
                <span class="n">copied_t</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
                <span class="n">copied_t</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">value</span>
                <span class="n">complete_trials</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">copied_t</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">complete_trials</span>

    <span class="k">def</span> <span class="nf">after_trial</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">study</span><span class="p">:</span> <span class="s2">&quot;optuna.Study&quot;</span><span class="p">,</span>
        <span class="n">trial</span><span class="p">:</span> <span class="s2">&quot;optuna.trial.FrozenTrial&quot;</span><span class="p">,</span>
        <span class="n">state</span><span class="p">:</span> <span class="n">TrialState</span><span class="p">,</span>
        <span class="n">values</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="nb">float</span><span class="p">]],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_independent_sampler</span><span class="o">.</span><span class="n">after_trial</span><span class="p">(</span><span class="n">study</span><span class="p">,</span> <span class="n">trial</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">










  <div class="doc doc-object doc-method">



<h2 id="optuna.samplers._cmaes.CmaEsSampler.after_trial" class="doc doc-heading">
<code class="highlight language-python"><span class="n">after_trial</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">study</span><span class="p">,</span> <span class="n">trial</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span></code>


</h2>

    <div class="doc doc-contents ">

      <p>Trial post-processing.</p>
<p>This method is called after the objective function returns and right before the trials is
finished and its state is stored.</p>
<p>.. note::
    Added in v2.4.0 as an experimental feature. The interface may change in newer versions
    without prior notice. See https://github.com/optuna/optuna/releases/tag/v2.4.0.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>study</code></td>
        <td><code>optuna.Study</code></td>
        <td><p>Target study object.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>trial</code></td>
        <td><code>optuna.trial.FrozenTrial</code></td>
        <td><p>Target trial object.
Take a copy before modifying this object.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>state</code></td>
        <td><code>TrialState</code></td>
        <td><p>Resulting trial state.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>values</code></td>
        <td><code>Optional[Sequence[float]]</code></td>
        <td><p>Resulting trial values. Guaranteed to not be :obj:<code>None</code> if trial succeeded.</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>optuna/samplers/_cmaes.py</code></summary>
          <div class="highlight"><span class="filename">Python</span><pre><span></span><code><span class="k">def</span> <span class="nf">after_trial</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">study</span><span class="p">:</span> <span class="s2">&quot;optuna.Study&quot;</span><span class="p">,</span>
    <span class="n">trial</span><span class="p">:</span> <span class="s2">&quot;optuna.trial.FrozenTrial&quot;</span><span class="p">,</span>
    <span class="n">state</span><span class="p">:</span> <span class="n">TrialState</span><span class="p">,</span>
    <span class="n">values</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="nb">float</span><span class="p">]],</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_independent_sampler</span><span class="o">.</span><span class="n">after_trial</span><span class="p">(</span><span class="n">study</span><span class="p">,</span> <span class="n">trial</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h2 id="optuna.samplers._cmaes.CmaEsSampler.infer_relative_search_space" class="doc doc-heading">
<code class="highlight language-python"><span class="n">infer_relative_search_space</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">study</span><span class="p">,</span> <span class="n">trial</span><span class="p">)</span></code>


</h2>

    <div class="doc doc-contents ">

      <p>Infer the search space that will be used by relative sampling in the target trial.</p>
<p>This method is called right before :func:<code>~optuna.samplers.BaseSampler.sample_relative</code>
method, and the search space returned by this method is passed to it. The parameters not
contained in the search space will be sampled by using
:func:<code>~optuna.samplers.BaseSampler.sample_independent</code> method.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>study</code></td>
        <td><code>optuna.Study</code></td>
        <td><p>Target study object.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>trial</code></td>
        <td><code>optuna.trial.FrozenTrial</code></td>
        <td><p>Target trial object.
Take a copy before modifying this object.</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>Dict[str, optuna.distributions.BaseDistribution]</code></td>
      <td><p>A dictionary containing the parameter names and parameter's distributions.</p></td>
    </tr>
  </tbody>
</table>      <p>.. seealso::
    Please refer to :func:<code>~optuna.samplers.intersection_search_space</code> as an
    implementation of :func:<code>~optuna.samplers.BaseSampler.infer_relative_search_space</code>.</p>

        <details class="quote">
          <summary>Source code in <code>optuna/samplers/_cmaes.py</code></summary>
          <div class="highlight"><span class="filename">Python</span><pre><span></span><code><span class="k">def</span> <span class="nf">infer_relative_search_space</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">study</span><span class="p">:</span> <span class="s2">&quot;optuna.Study&quot;</span><span class="p">,</span> <span class="n">trial</span><span class="p">:</span> <span class="s2">&quot;optuna.trial.FrozenTrial&quot;</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">BaseDistribution</span><span class="p">]:</span>
    <span class="n">search_space</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">BaseDistribution</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">distribution</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_search_space</span><span class="o">.</span><span class="n">calculate</span><span class="p">(</span><span class="n">study</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">distribution</span><span class="o">.</span><span class="n">single</span><span class="p">():</span>
            <span class="c1"># `cma` cannot handle distributions that contain just a single value, so we skip</span>
            <span class="c1"># them. Note that the parameter values for such distributions are sampled in</span>
            <span class="c1"># `Trial`.</span>
            <span class="k">continue</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span>
            <span class="n">distribution</span><span class="p">,</span>
            <span class="p">(</span>
                <span class="n">optuna</span><span class="o">.</span><span class="n">distributions</span><span class="o">.</span><span class="n">UniformDistribution</span><span class="p">,</span>
                <span class="n">optuna</span><span class="o">.</span><span class="n">distributions</span><span class="o">.</span><span class="n">LogUniformDistribution</span><span class="p">,</span>
                <span class="n">optuna</span><span class="o">.</span><span class="n">distributions</span><span class="o">.</span><span class="n">DiscreteUniformDistribution</span><span class="p">,</span>
                <span class="n">optuna</span><span class="o">.</span><span class="n">distributions</span><span class="o">.</span><span class="n">IntUniformDistribution</span><span class="p">,</span>
                <span class="n">optuna</span><span class="o">.</span><span class="n">distributions</span><span class="o">.</span><span class="n">IntLogUniformDistribution</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">):</span>
            <span class="c1"># Categorical distribution is unsupported.</span>
            <span class="k">continue</span>
        <span class="n">search_space</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">distribution</span>

    <span class="k">return</span> <span class="n">search_space</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h2 id="optuna.samplers._cmaes.CmaEsSampler.reseed_rng" class="doc doc-heading">
<code class="highlight language-python"><span class="n">reseed_rng</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>


</h2>

    <div class="doc doc-contents ">

      <p>Reseed sampler's random number generator.</p>
<p>This method is called by the :class:<code>~optuna.study.Study</code> instance if trials are executed
in parallel with the option <code>n_jobs&gt;1</code>. In that case, the sampler instance will be
replicated including the state of the random number generator, and they may suggest the
same values. To prevent this issue, this method assigns a different seed to each random
number generator.</p>

        <details class="quote">
          <summary>Source code in <code>optuna/samplers/_cmaes.py</code></summary>
          <div class="highlight"><span class="filename">Python</span><pre><span></span><code><span class="k">def</span> <span class="nf">reseed_rng</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="c1"># _cma_rng doesn&#39;t require reseeding because the relative sampling reseeds in each trial.</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_independent_sampler</span><span class="o">.</span><span class="n">reseed_rng</span><span class="p">()</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h2 id="optuna.samplers._cmaes.CmaEsSampler.sample_independent" class="doc doc-heading">
<code class="highlight language-python"><span class="n">sample_independent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">study</span><span class="p">,</span> <span class="n">trial</span><span class="p">,</span> <span class="n">param_name</span><span class="p">,</span> <span class="n">param_distribution</span><span class="p">)</span></code>


</h2>

    <div class="doc doc-contents ">

      <p>Sample a parameter for a given distribution.</p>
<p>This method is called only for the parameters not contained in the search space returned
by :func:<code>~optuna.samplers.BaseSampler.sample_relative</code> method. This method is suitable
for sampling algorithms that do not use relationship between parameters such as random
sampling and TPE.</p>
<p>.. note::
        The failed trials are ignored by any build-in samplers when they sample new
        parameters. Thus, failed trials are regarded as deleted in the samplers'
        perspective.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>study</code></td>
        <td><code>optuna.Study</code></td>
        <td><p>Target study object.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>trial</code></td>
        <td><code>optuna.trial.FrozenTrial</code></td>
        <td><p>Target trial object.
Take a copy before modifying this object.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>param_name</code></td>
        <td><code>str</code></td>
        <td><p>Name of the sampled parameter.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>param_distribution</code></td>
        <td><code>BaseDistribution</code></td>
        <td><p>Distribution object that specifies a prior and/or scale of the sampling algorithm.</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>Any</code></td>
      <td><p>A parameter value.</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>optuna/samplers/_cmaes.py</code></summary>
          <div class="highlight"><span class="filename">Python</span><pre><span></span><code><span class="k">def</span> <span class="nf">sample_independent</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">study</span><span class="p">:</span> <span class="s2">&quot;optuna.Study&quot;</span><span class="p">,</span>
    <span class="n">trial</span><span class="p">:</span> <span class="s2">&quot;optuna.trial.FrozenTrial&quot;</span><span class="p">,</span>
    <span class="n">param_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">param_distribution</span><span class="p">:</span> <span class="n">BaseDistribution</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_raise_error_if_multi_objective</span><span class="p">(</span><span class="n">study</span><span class="p">)</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_warn_independent_sampling</span><span class="p">:</span>
        <span class="n">complete_trials</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_trials</span><span class="p">(</span><span class="n">study</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">complete_trials</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_n_startup_trials</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_log_independent_sampling</span><span class="p">(</span><span class="n">trial</span><span class="p">,</span> <span class="n">param_name</span><span class="p">)</span>

    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_independent_sampler</span><span class="o">.</span><span class="n">sample_independent</span><span class="p">(</span>
        <span class="n">study</span><span class="p">,</span> <span class="n">trial</span><span class="p">,</span> <span class="n">param_name</span><span class="p">,</span> <span class="n">param_distribution</span>
    <span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h2 id="optuna.samplers._cmaes.CmaEsSampler.sample_relative" class="doc doc-heading">
<code class="highlight language-python"><span class="n">sample_relative</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">study</span><span class="p">,</span> <span class="n">trial</span><span class="p">,</span> <span class="n">search_space</span><span class="p">)</span></code>


</h2>

    <div class="doc doc-contents ">

      <p>Sample parameters in a given search space.</p>
<p>This method is called once at the beginning of each trial, i.e., right before the
evaluation of the objective function. This method is suitable for sampling algorithms
that use relationship between parameters such as Gaussian Process and CMA-ES.</p>
<p>.. note::
        The failed trials are ignored by any build-in samplers when they sample new
        parameters. Thus, failed trials are regarded as deleted in the samplers'
        perspective.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>study</code></td>
        <td><code>optuna.Study</code></td>
        <td><p>Target study object.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>trial</code></td>
        <td><code>optuna.trial.FrozenTrial</code></td>
        <td><p>Target trial object.
Take a copy before modifying this object.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>search_space</code></td>
        <td><code>Dict[str, optuna.distributions.BaseDistribution]</code></td>
        <td><p>The search space returned by
:func:<code>~optuna.samplers.BaseSampler.infer_relative_search_space</code>.</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>Dict[str, Any]</code></td>
      <td><p>A dictionary containing the parameter names and the values.</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>optuna/samplers/_cmaes.py</code></summary>
          <div class="highlight"><span class="filename">Python</span><pre><span></span><code><span class="k">def</span> <span class="nf">sample_relative</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">study</span><span class="p">:</span> <span class="s2">&quot;optuna.Study&quot;</span><span class="p">,</span>
    <span class="n">trial</span><span class="p">:</span> <span class="s2">&quot;optuna.trial.FrozenTrial&quot;</span><span class="p">,</span>
    <span class="n">search_space</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">BaseDistribution</span><span class="p">],</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_raise_error_if_multi_objective</span><span class="p">(</span><span class="n">study</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">search_space</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">{}</span>

    <span class="n">completed_trials</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_trials</span><span class="p">(</span><span class="n">study</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">completed_trials</span><span class="p">)</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_n_startup_trials</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">{}</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">search_space</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="s2">&quot;`CmaEsSampler` only supports two or more dimensional continuous &quot;</span>
            <span class="s2">&quot;search space. `</span><span class="si">{}</span><span class="s2">` is used instead of `CmaEsSampler`.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_independent_sampler</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_warn_independent_sampling</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="p">{}</span>

    <span class="n">trans</span> <span class="o">=</span> <span class="n">_SearchSpaceTransform</span><span class="p">(</span><span class="n">search_space</span><span class="p">)</span>

    <span class="n">optimizer</span><span class="p">,</span> <span class="n">n_restarts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_restore_optimizer</span><span class="p">(</span><span class="n">completed_trials</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">optimizer</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">n_restarts</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">optimizer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_init_optimizer</span><span class="p">(</span><span class="n">trans</span><span class="p">,</span> <span class="n">study</span><span class="o">.</span><span class="n">direction</span><span class="p">)</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_restart_strategy</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">generation_attr_key</span> <span class="o">=</span> <span class="s2">&quot;cma:generation&quot;</span>  <span class="c1"># for backward compatibility</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">generation_attr_key</span> <span class="o">=</span> <span class="s2">&quot;cma:restart_</span><span class="si">{}</span><span class="s2">:generation&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">n_restarts</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">optimizer</span><span class="o">.</span><span class="n">dim</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">trans</span><span class="o">.</span><span class="n">bounds</span><span class="p">):</span>
        <span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="s2">&quot;`CmaEsSampler` does not support dynamic search space. &quot;</span>
            <span class="s2">&quot;`</span><span class="si">{}</span><span class="s2">` is used instead of `CmaEsSampler`.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_independent_sampler</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_warn_independent_sampling</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="p">{}</span>

    <span class="c1"># TODO(c-bata): Reduce the number of wasted trials during parallel optimization.</span>
    <span class="c1"># See https://github.com/optuna/optuna/pull/920#discussion_r385114002 for details.</span>
    <span class="n">solution_trials</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">t</span>
        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">completed_trials</span>
        <span class="k">if</span> <span class="n">optimizer</span><span class="o">.</span><span class="n">generation</span> <span class="o">==</span> <span class="n">t</span><span class="o">.</span><span class="n">system_attrs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">generation_attr_key</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="p">]</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">solution_trials</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">optimizer</span><span class="o">.</span><span class="n">population_size</span><span class="p">:</span>
        <span class="n">solutions</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">solution_trials</span><span class="p">[:</span> <span class="n">optimizer</span><span class="o">.</span><span class="n">population_size</span><span class="p">]:</span>
            <span class="k">assert</span> <span class="n">t</span><span class="o">.</span><span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;completed trials must have a value&quot;</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">trans</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">params</span><span class="p">)</span>
            <span class="n">y</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">value</span> <span class="k">if</span> <span class="n">study</span><span class="o">.</span><span class="n">direction</span> <span class="o">==</span> <span class="n">StudyDirection</span><span class="o">.</span><span class="n">MINIMIZE</span> <span class="k">else</span> <span class="o">-</span><span class="n">t</span><span class="o">.</span><span class="n">value</span>
            <span class="n">solutions</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">))</span>

        <span class="n">optimizer</span><span class="o">.</span><span class="n">tell</span><span class="p">(</span><span class="n">solutions</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_restart_strategy</span> <span class="o">==</span> <span class="s2">&quot;ipop&quot;</span> <span class="ow">and</span> <span class="n">optimizer</span><span class="o">.</span><span class="n">should_stop</span><span class="p">():</span>
            <span class="n">n_restarts</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">generation_attr_key</span> <span class="o">=</span> <span class="s2">&quot;cma:restart_</span><span class="si">{}</span><span class="s2">:generation&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">n_restarts</span><span class="p">)</span>
            <span class="n">popsize</span> <span class="o">=</span> <span class="n">optimizer</span><span class="o">.</span><span class="n">population_size</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_inc_popsize</span>
            <span class="n">optimizer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_init_optimizer</span><span class="p">(</span>
                <span class="n">trans</span><span class="p">,</span> <span class="n">study</span><span class="o">.</span><span class="n">direction</span><span class="p">,</span> <span class="n">population_size</span><span class="o">=</span><span class="n">popsize</span><span class="p">,</span> <span class="n">randomize_start_point</span><span class="o">=</span><span class="kc">True</span>
            <span class="p">)</span>

        <span class="c1"># Store optimizer</span>
        <span class="n">optimizer_str</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">optimizer</span><span class="p">)</span><span class="o">.</span><span class="n">hex</span><span class="p">()</span>
        <span class="n">optimizer_attrs</span> <span class="o">=</span> <span class="n">_split_optimizer_str</span><span class="p">(</span><span class="n">optimizer_str</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">optimizer_attrs</span><span class="p">:</span>
            <span class="n">study</span><span class="o">.</span><span class="n">_storage</span><span class="o">.</span><span class="n">set_trial_system_attr</span><span class="p">(</span><span class="n">trial</span><span class="o">.</span><span class="n">_trial_id</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">optimizer_attrs</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>

    <span class="c1"># Caution: optimizer should update its seed value</span>
    <span class="n">seed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cma_rng</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span> <span class="o">**</span> <span class="mi">16</span><span class="p">)</span> <span class="o">+</span> <span class="n">trial</span><span class="o">.</span><span class="n">number</span>
    <span class="n">optimizer</span><span class="o">.</span><span class="n">_rng</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">RandomState</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>
    <span class="n">params</span> <span class="o">=</span> <span class="n">optimizer</span><span class="o">.</span><span class="n">ask</span><span class="p">()</span>

    <span class="n">study</span><span class="o">.</span><span class="n">_storage</span><span class="o">.</span><span class="n">set_trial_system_attr</span><span class="p">(</span>
        <span class="n">trial</span><span class="o">.</span><span class="n">_trial_id</span><span class="p">,</span> <span class="n">generation_attr_key</span><span class="p">,</span> <span class="n">optimizer</span><span class="o">.</span><span class="n">generation</span>
    <span class="p">)</span>
    <span class="n">study</span><span class="o">.</span><span class="n">_storage</span><span class="o">.</span><span class="n">set_trial_system_attr</span><span class="p">(</span><span class="n">trial</span><span class="o">.</span><span class="n">_trial_id</span><span class="p">,</span> <span class="s2">&quot;cma:n_restarts&quot;</span><span class="p">,</span> <span class="n">n_restarts</span><span class="p">)</span>

    <span class="n">external_values</span> <span class="o">=</span> <span class="n">trans</span><span class="o">.</span><span class="n">untransform</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">external_values</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>

<h2 id="lexde"><code>LEXDE</code></h2>


  <div class="doc doc-object doc-class">

<a id="optuna_externm.opt._lexde.LEXDESampler"></a>
    <div class="doc doc-contents first">

      <p>Multi-objective sampler using the Lex-DE algorithm.</p>
<p>Lex-DE stands for "Differential Evolution with Lexicase selection".</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>population_size</code></td>
        <td><code>int</code></td>
        <td><p>Number of individuals (trials) in a generation.</p></td>
        <td><code>100</code></td>
      </tr>
      <tr>
        <td><code>F</code></td>
        <td><code>float</code></td>
        <td><p>Scaling factor of differential mutation. This parameter is applied to
the differential vector between parent individuals.</p></td>
        <td><code>0.5</code></td>
      </tr>
      <tr>
        <td><code>CR</code></td>
        <td><code>float</code></td>
        <td><p>Crossover rate of binary crossover. This parameter shows the probability
to crossover the child individual with a parent individual.</p></td>
        <td><code>0.5</code></td>
      </tr>
      <tr>
        <td><code>mutation_eta</code></td>
        <td><code>float</code></td>
        <td><p>Index parameter of polynomial mutation.</p></td>
        <td><code>20</code></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>optuna_externm/opt/_lexde.py</code></summary>
          <div class="highlight"><span class="filename">Python</span><pre><span></span><code><span class="k">class</span> <span class="nc">LEXDESampler</span><span class="p">(</span><span class="n">BaseSampler</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Multi-objective sampler using the Lex-DE algorithm.</span>

<span class="sd">    Lex-DE stands for &quot;Differential Evolution with Lexicase selection&quot;.</span>

<span class="sd">    Args:</span>
<span class="sd">        population_size:</span>
<span class="sd">            Number of individuals (trials) in a generation.</span>
<span class="sd">        F:</span>
<span class="sd">            Scaling factor of differential mutation. This parameter is applied to</span>
<span class="sd">            the differential vector between parent individuals.</span>
<span class="sd">        CR:</span>
<span class="sd">            Crossover rate of binary crossover. This parameter shows the probability</span>
<span class="sd">            to crossover the child individual with a parent individual.</span>
<span class="sd">        mutation_eta:</span>
<span class="sd">            Index parameter of polynomial mutation.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">population_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span>
        <span class="n">F</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span>
        <span class="n">CR</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span>
        <span class="n">seed</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">constraints_func</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">[[</span><span class="n">FrozenTrial</span><span class="p">],</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">float</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">mutation_eta</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">20</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_population_size</span> <span class="o">=</span> <span class="n">population_size</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_F</span> <span class="o">=</span> <span class="n">F</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_CR</span> <span class="o">=</span> <span class="n">CR</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_random_sampler</span> <span class="o">=</span> <span class="n">RandomSampler</span><span class="p">(</span><span class="n">seed</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_rng</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">RandomState</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_constraints_func</span> <span class="o">=</span> <span class="n">constraints_func</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_mutation_eta</span> <span class="o">=</span> <span class="n">mutation_eta</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_search_space</span> <span class="o">=</span> <span class="n">IntersectionSearchSpace</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">reseed_rng</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_random_sampler</span><span class="o">.</span><span class="n">reseed_rng</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_rng</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">RandomState</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">infer_relative_search_space</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">study</span><span class="p">:</span> <span class="n">Study</span><span class="p">,</span> <span class="n">trial</span><span class="p">:</span> <span class="n">FrozenTrial</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">BaseDistribution</span><span class="p">]:</span>
        <span class="n">search_space</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">BaseDistribution</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">distribution</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_search_space</span><span class="o">.</span><span class="n">calculate</span><span class="p">(</span><span class="n">study</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">distribution</span><span class="o">.</span><span class="n">single</span><span class="p">():</span>
                <span class="c1"># The `untransform` method of `optuna._transform._SearchSpaceTransform`</span>
                <span class="c1"># does not assume a single value,</span>
                <span class="c1"># so single value objects are not sampled with the `sample_relative` method,</span>
                <span class="c1"># but with the `sample_independent` method.</span>
                <span class="k">continue</span>
            <span class="n">search_space</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">distribution</span>
        <span class="k">return</span> <span class="n">search_space</span>

    <span class="k">def</span> <span class="nf">sample_relative</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">study</span><span class="p">:</span> <span class="n">Study</span><span class="p">,</span>
        <span class="n">trial</span><span class="p">:</span> <span class="n">FrozenTrial</span><span class="p">,</span>
        <span class="n">search_space</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">BaseDistribution</span><span class="p">],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
        <span class="n">parent_generation</span><span class="p">,</span> <span class="n">parent_population</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_collect_parent_population</span><span class="p">(</span><span class="n">study</span><span class="p">)</span>
        <span class="n">trial_id</span> <span class="o">=</span> <span class="n">trial</span><span class="o">.</span><span class="n">_trial_id</span>

        <span class="n">generation</span> <span class="o">=</span> <span class="n">parent_generation</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="n">study</span><span class="o">.</span><span class="n">_storage</span><span class="o">.</span><span class="n">set_trial_system_attr</span><span class="p">(</span><span class="n">trial_id</span><span class="p">,</span> <span class="n">_GENERATION_KEY</span><span class="p">,</span> <span class="n">generation</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">parent_generation</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>

            <span class="c1"># Select the first parent by automatic epsilon lexicase selection</span>
            <span class="c1"># and the rest two parents by random selection; Perform DE mutation,</span>
            <span class="c1"># binary crossover, and polynomial mutation</span>
            <span class="c1"># x1: lexicase; x2, x3: random</span>
            <span class="c1"># y = x1 + F * (x2 - x3)</span>
            <span class="c1"># y = bin(y, x1)</span>
            <span class="c1"># y = polym(y)</span>

            <span class="c1"># Automatic epsilon lexicase selection</span>
            <span class="n">parents</span> <span class="o">=</span> <span class="n">selAutomaticEpsilonLexicase</span><span class="p">(</span>
                <span class="n">study</span><span class="p">,</span>
                <span class="n">parent_population</span><span class="p">,</span>
                <span class="mi">1</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_rng</span>
            <span class="p">)</span> <span class="o">+</span> <span class="n">selRandom</span><span class="p">(</span>
                <span class="n">study</span><span class="p">,</span>
                <span class="n">parent_population</span><span class="p">,</span>
                <span class="mi">2</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_rng</span>
            <span class="p">)</span>

            <span class="c1"># Convert population to array</span>
            <span class="p">(</span><span class="n">parents_numerical_params_array</span><span class="p">,</span>
             <span class="n">numerical_transform</span><span class="p">,</span>
             <span class="n">numerical_distributions</span><span class="p">)</span> <span class="o">=</span> <span class="n">population_to_numerical_params_array</span><span class="p">(</span>
                <span class="n">parents</span><span class="p">,</span>
                <span class="n">search_space</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="c1"># DE mutation</span>
            <span class="n">child_params_array</span> <span class="o">=</span> <span class="n">mutDEBounded</span><span class="p">(</span>
                <span class="n">parents_numerical_params_array</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                <span class="n">parents_numerical_params_array</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                <span class="n">parents_numerical_params_array</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_rng</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_F</span><span class="p">,</span>
                <span class="n">numerical_distributions</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="c1"># DE binary crossover</span>
            <span class="n">child_params_array</span> <span class="o">=</span> <span class="n">cxDEBinary</span><span class="p">(</span>
                <span class="n">child_params_array</span><span class="p">,</span>
                <span class="n">parents_numerical_params_array</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_rng</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_CR</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="c1"># Polynomial mutation</span>
            <span class="n">child_params_array</span> <span class="o">=</span> <span class="n">mutPolynomialBounded</span><span class="p">(</span>
                <span class="n">child_params_array</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_rng</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_mutation_eta</span><span class="p">,</span>
                <span class="n">numerical_distributions</span><span class="p">,</span>
            <span class="p">)</span>


            <span class="c1"># convert array to params</span>
            <span class="n">child_params</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">child_numerical_params</span> <span class="o">=</span> <span class="n">numerical_transform</span><span class="o">.</span><span class="n">untransform</span><span class="p">(</span><span class="n">child_params_array</span><span class="p">)</span>
            <span class="n">child_params</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">child_numerical_params</span><span class="p">)</span>

            <span class="n">params</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">param_name</span> <span class="ow">in</span> <span class="n">child_params</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">params</span><span class="p">[</span><span class="n">param_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">child_params</span><span class="p">[</span><span class="n">param_name</span><span class="p">]</span>
            <span class="k">return</span> <span class="n">params</span>

        <span class="k">return</span> <span class="p">{}</span>

    <span class="k">def</span> <span class="nf">sample_independent</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">study</span><span class="p">:</span> <span class="n">Study</span><span class="p">,</span>
        <span class="n">trial</span><span class="p">:</span> <span class="n">FrozenTrial</span><span class="p">,</span>
        <span class="n">param_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">param_distribution</span><span class="p">:</span> <span class="n">BaseDistribution</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
        <span class="c1"># Following parameters are randomly sampled here.</span>
        <span class="c1"># 1. A parameter in the initial population/first generation.</span>
        <span class="c1"># 2. A parameter to mutate.</span>
        <span class="c1"># 3. A parameter excluded from the intersection search space.</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_random_sampler</span><span class="o">.</span><span class="n">sample_independent</span><span class="p">(</span>
            <span class="n">study</span><span class="p">,</span> <span class="n">trial</span><span class="p">,</span> <span class="n">param_name</span><span class="p">,</span> <span class="n">param_distribution</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_collect_parent_population</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">study</span><span class="p">:</span> <span class="n">Study</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">FrozenTrial</span><span class="p">]]:</span>

        <span class="c1"># TODO: this method requires a reimplementation</span>

        <span class="n">trials</span> <span class="o">=</span> <span class="n">study</span><span class="o">.</span><span class="n">get_trials</span><span class="p">(</span><span class="n">deepcopy</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="n">generation_to_runnings</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
        <span class="n">generation_to_population</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">trial</span> <span class="ow">in</span> <span class="n">trials</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">_GENERATION_KEY</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">trial</span><span class="o">.</span><span class="n">system_attrs</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="n">generation</span> <span class="o">=</span> <span class="n">trial</span><span class="o">.</span><span class="n">system_attrs</span><span class="p">[</span><span class="n">_GENERATION_KEY</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">trial</span><span class="o">.</span><span class="n">state</span> <span class="o">!=</span> <span class="n">optuna</span><span class="o">.</span><span class="n">trial</span><span class="o">.</span><span class="n">TrialState</span><span class="o">.</span><span class="n">COMPLETE</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">trial</span><span class="o">.</span><span class="n">state</span> <span class="o">==</span> <span class="n">optuna</span><span class="o">.</span><span class="n">trial</span><span class="o">.</span><span class="n">TrialState</span><span class="o">.</span><span class="n">RUNNING</span><span class="p">:</span>
                    <span class="n">generation_to_runnings</span><span class="p">[</span><span class="n">generation</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">trial</span><span class="p">)</span>
                <span class="k">continue</span>

            <span class="c1"># Do not use trials whose states are not COMPLETE, or `constraint` will be unavailable.</span>
            <span class="n">generation_to_population</span><span class="p">[</span><span class="n">generation</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">trial</span><span class="p">)</span>

        <span class="n">hasher</span> <span class="o">=</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">sha256</span><span class="p">()</span>
        <span class="n">parent_population</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">FrozenTrial</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">parent_generation</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">generation</span> <span class="o">=</span> <span class="n">parent_generation</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="n">population</span> <span class="o">=</span> <span class="n">generation_to_population</span><span class="p">[</span><span class="n">generation</span><span class="p">]</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">population</span><span class="p">)</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_population_size</span><span class="p">:</span>
                <span class="k">break</span>

            <span class="k">for</span> <span class="n">trial</span> <span class="ow">in</span> <span class="n">generation_to_runnings</span><span class="p">[</span><span class="n">generation</span><span class="p">]:</span>
                <span class="n">hasher</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="nb">bytes</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">trial</span><span class="o">.</span><span class="n">number</span><span class="p">),</span> <span class="s2">&quot;utf-8&quot;</span><span class="p">))</span>

            <span class="n">cache_key</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">:</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">_POPULATION_CACHE_KEY_PREFIX</span><span class="p">,</span> <span class="n">hasher</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">())</span>
            <span class="n">cached_generation</span><span class="p">,</span> <span class="n">cached_population_numbers</span> <span class="o">=</span> <span class="n">study</span><span class="o">.</span><span class="n">system_attrs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                <span class="n">cache_key</span><span class="p">,</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">[])</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">cached_generation</span> <span class="o">&gt;=</span> <span class="n">generation</span><span class="p">:</span>
                <span class="n">generation</span> <span class="o">=</span> <span class="n">cached_generation</span>
                <span class="n">population</span> <span class="o">=</span> <span class="p">[</span><span class="n">trials</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">cached_population_numbers</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">population</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">parent_population</span><span class="p">)</span>
                <span class="n">population</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_select_elite_population</span><span class="p">(</span><span class="n">study</span><span class="p">,</span> <span class="n">population</span><span class="p">)</span>

                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">generation_to_runnings</span><span class="p">[</span><span class="n">generation</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">population_numbers</span> <span class="o">=</span> <span class="p">[</span><span class="n">t</span><span class="o">.</span><span class="n">number</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">population</span><span class="p">]</span>
                    <span class="n">study</span><span class="o">.</span><span class="n">set_system_attr</span><span class="p">(</span><span class="n">cache_key</span><span class="p">,</span> <span class="p">(</span><span class="n">generation</span><span class="p">,</span> <span class="n">population_numbers</span><span class="p">))</span>

            <span class="n">parent_generation</span> <span class="o">=</span> <span class="n">generation</span>
            <span class="n">parent_population</span> <span class="o">=</span> <span class="n">population</span>

        <span class="k">return</span> <span class="n">parent_generation</span><span class="p">,</span> <span class="n">parent_population</span>

    <span class="k">def</span> <span class="nf">_select_elite_population</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">study</span><span class="p">:</span> <span class="n">Study</span><span class="p">,</span> <span class="n">population</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">FrozenTrial</span><span class="p">]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">FrozenTrial</span><span class="p">]:</span>
        <span class="n">elite_population</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">FrozenTrial</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">population_per_rank</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fast_non_dominated_sort</span><span class="p">(</span><span class="n">population</span><span class="p">,</span> <span class="n">study</span><span class="o">.</span><span class="n">directions</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">population</span> <span class="ow">in</span> <span class="n">population_per_rank</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">elite_population</span><span class="p">)</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">population</span><span class="p">)</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_population_size</span><span class="p">:</span>
                <span class="n">elite_population</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">population</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">n</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_population_size</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">elite_population</span><span class="p">)</span>
                <span class="n">_crowding_distance_sort</span><span class="p">(</span><span class="n">population</span><span class="p">)</span>
                <span class="n">elite_population</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">population</span><span class="p">[:</span><span class="n">n</span><span class="p">])</span>
                <span class="k">break</span>

        <span class="k">return</span> <span class="n">elite_population</span>

    <span class="k">def</span> <span class="nf">_fast_non_dominated_sort</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">population</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">FrozenTrial</span><span class="p">],</span>
        <span class="n">directions</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">optuna</span><span class="o">.</span><span class="n">study</span><span class="o">.</span><span class="n">StudyDirection</span><span class="p">],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">FrozenTrial</span><span class="p">]]:</span>
        <span class="n">dominated_count</span><span class="p">:</span> <span class="n">DefaultDict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
        <span class="n">dominates_list</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>

        <span class="n">dominates</span> <span class="o">=</span> <span class="n">_dominates</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_constraints_func</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">_constrained_dominates</span>

        <span class="k">for</span> <span class="n">p</span><span class="p">,</span> <span class="n">q</span> <span class="ow">in</span> <span class="n">itertools</span><span class="o">.</span><span class="n">combinations</span><span class="p">(</span><span class="n">population</span><span class="p">,</span> <span class="mi">2</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">dominates</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">directions</span><span class="p">):</span>
                <span class="n">dominates_list</span><span class="p">[</span><span class="n">p</span><span class="o">.</span><span class="n">number</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">q</span><span class="o">.</span><span class="n">number</span><span class="p">)</span>
                <span class="n">dominated_count</span><span class="p">[</span><span class="n">q</span><span class="o">.</span><span class="n">number</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">elif</span> <span class="n">dominates</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">directions</span><span class="p">):</span>
                <span class="n">dominates_list</span><span class="p">[</span><span class="n">q</span><span class="o">.</span><span class="n">number</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">number</span><span class="p">)</span>
                <span class="n">dominated_count</span><span class="p">[</span><span class="n">p</span><span class="o">.</span><span class="n">number</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="n">population_per_rank</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">while</span> <span class="n">population</span><span class="p">:</span>
            <span class="n">non_dominated_population</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">while</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">population</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">dominated_count</span><span class="p">[</span><span class="n">population</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">number</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">individual</span> <span class="o">=</span> <span class="n">population</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">population</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">population</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">population</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">population</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
                    <span class="n">non_dominated_population</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">individual</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">non_dominated_population</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">dominates_list</span><span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">number</span><span class="p">]:</span>
                    <span class="n">dominated_count</span><span class="p">[</span><span class="n">y</span><span class="p">]</span> <span class="o">-=</span> <span class="mi">1</span>

            <span class="k">assert</span> <span class="n">non_dominated_population</span>
            <span class="n">population_per_rank</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">non_dominated_population</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">population_per_rank</span>

    <span class="k">def</span> <span class="nf">after_trial</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">study</span><span class="p">:</span> <span class="n">Study</span><span class="p">,</span>
        <span class="n">trial</span><span class="p">:</span> <span class="n">FrozenTrial</span><span class="p">,</span>
        <span class="n">state</span><span class="p">:</span> <span class="n">TrialState</span><span class="p">,</span>
        <span class="n">values</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="nb">float</span><span class="p">]],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">assert</span> <span class="n">state</span> <span class="ow">in</span> <span class="p">[</span><span class="n">TrialState</span><span class="o">.</span><span class="n">COMPLETE</span><span class="p">,</span> <span class="n">TrialState</span><span class="o">.</span><span class="n">FAIL</span><span class="p">,</span> <span class="n">TrialState</span><span class="o">.</span><span class="n">PRUNED</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">state</span> <span class="o">==</span> <span class="n">TrialState</span><span class="o">.</span><span class="n">COMPLETE</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_constraints_func</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">constraints</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">con</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_constraints_func</span><span class="p">(</span><span class="n">trial</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">con</span><span class="p">,</span> <span class="p">(</span><span class="nb">tuple</span><span class="p">,</span> <span class="nb">list</span><span class="p">)):</span>
                    <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;Constraints should be a sequence of floats but got </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">con</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">.&quot;</span>
                    <span class="p">)</span>
                <span class="n">constraints</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">con</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="k">raise</span>
            <span class="k">finally</span><span class="p">:</span>
                <span class="k">assert</span> <span class="n">constraints</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">constraints</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)</span>

                <span class="n">study</span><span class="o">.</span><span class="n">_storage</span><span class="o">.</span><span class="n">set_trial_system_attr</span><span class="p">(</span>
                    <span class="n">trial</span><span class="o">.</span><span class="n">_trial_id</span><span class="p">,</span>
                    <span class="n">_CONSTRAINTS_KEY</span><span class="p">,</span>
                    <span class="n">constraints</span><span class="p">,</span>
                <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_random_sampler</span><span class="o">.</span><span class="n">after_trial</span><span class="p">(</span><span class="n">study</span><span class="p">,</span> <span class="n">trial</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">










  <div class="doc doc-object doc-method">



<h2 id="optuna_externm.opt._lexde.LEXDESampler.after_trial" class="doc doc-heading">
<code class="highlight language-python"><span class="n">after_trial</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">study</span><span class="p">,</span> <span class="n">trial</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span></code>


</h2>

    <div class="doc doc-contents ">

      <p>Trial post-processing.</p>
<p>This method is called after the objective function returns and right before the trials is
finished and its state is stored.</p>
<p>.. note::
    Added in v2.4.0 as an experimental feature. The interface may change in newer versions
    without prior notice. See https://github.com/optuna/optuna/releases/tag/v2.4.0.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>study</code></td>
        <td><code>Study</code></td>
        <td><p>Target study object.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>trial</code></td>
        <td><code>FrozenTrial</code></td>
        <td><p>Target trial object.
Take a copy before modifying this object.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>state</code></td>
        <td><code>TrialState</code></td>
        <td><p>Resulting trial state.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>values</code></td>
        <td><code>Optional[Sequence[float]]</code></td>
        <td><p>Resulting trial values. Guaranteed to not be :obj:<code>None</code> if trial succeeded.</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>optuna_externm/opt/_lexde.py</code></summary>
          <div class="highlight"><span class="filename">Python</span><pre><span></span><code><span class="k">def</span> <span class="nf">after_trial</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">study</span><span class="p">:</span> <span class="n">Study</span><span class="p">,</span>
    <span class="n">trial</span><span class="p">:</span> <span class="n">FrozenTrial</span><span class="p">,</span>
    <span class="n">state</span><span class="p">:</span> <span class="n">TrialState</span><span class="p">,</span>
    <span class="n">values</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="nb">float</span><span class="p">]],</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="k">assert</span> <span class="n">state</span> <span class="ow">in</span> <span class="p">[</span><span class="n">TrialState</span><span class="o">.</span><span class="n">COMPLETE</span><span class="p">,</span> <span class="n">TrialState</span><span class="o">.</span><span class="n">FAIL</span><span class="p">,</span> <span class="n">TrialState</span><span class="o">.</span><span class="n">PRUNED</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">state</span> <span class="o">==</span> <span class="n">TrialState</span><span class="o">.</span><span class="n">COMPLETE</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_constraints_func</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">constraints</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">con</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_constraints_func</span><span class="p">(</span><span class="n">trial</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">con</span><span class="p">,</span> <span class="p">(</span><span class="nb">tuple</span><span class="p">,</span> <span class="nb">list</span><span class="p">)):</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Constraints should be a sequence of floats but got </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">con</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">.&quot;</span>
                <span class="p">)</span>
            <span class="n">constraints</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">con</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">raise</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">constraints</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">constraints</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)</span>

            <span class="n">study</span><span class="o">.</span><span class="n">_storage</span><span class="o">.</span><span class="n">set_trial_system_attr</span><span class="p">(</span>
                <span class="n">trial</span><span class="o">.</span><span class="n">_trial_id</span><span class="p">,</span>
                <span class="n">_CONSTRAINTS_KEY</span><span class="p">,</span>
                <span class="n">constraints</span><span class="p">,</span>
            <span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_random_sampler</span><span class="o">.</span><span class="n">after_trial</span><span class="p">(</span><span class="n">study</span><span class="p">,</span> <span class="n">trial</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h2 id="optuna_externm.opt._lexde.LEXDESampler.infer_relative_search_space" class="doc doc-heading">
<code class="highlight language-python"><span class="n">infer_relative_search_space</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">study</span><span class="p">,</span> <span class="n">trial</span><span class="p">)</span></code>


</h2>

    <div class="doc doc-contents ">

      <p>Infer the search space that will be used by relative sampling in the target trial.</p>
<p>This method is called right before :func:<code>~optuna.samplers.BaseSampler.sample_relative</code>
method, and the search space returned by this method is passed to it. The parameters not
contained in the search space will be sampled by using
:func:<code>~optuna.samplers.BaseSampler.sample_independent</code> method.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>study</code></td>
        <td><code>Study</code></td>
        <td><p>Target study object.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>trial</code></td>
        <td><code>FrozenTrial</code></td>
        <td><p>Target trial object.
Take a copy before modifying this object.</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>Dict[str, optuna.distributions.BaseDistribution]</code></td>
      <td><p>A dictionary containing the parameter names and parameter's distributions.</p></td>
    </tr>
  </tbody>
</table>      <p>.. seealso::
    Please refer to :func:<code>~optuna.samplers.intersection_search_space</code> as an
    implementation of :func:<code>~optuna.samplers.BaseSampler.infer_relative_search_space</code>.</p>

        <details class="quote">
          <summary>Source code in <code>optuna_externm/opt/_lexde.py</code></summary>
          <div class="highlight"><span class="filename">Python</span><pre><span></span><code><span class="k">def</span> <span class="nf">infer_relative_search_space</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">study</span><span class="p">:</span> <span class="n">Study</span><span class="p">,</span> <span class="n">trial</span><span class="p">:</span> <span class="n">FrozenTrial</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">BaseDistribution</span><span class="p">]:</span>
    <span class="n">search_space</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">BaseDistribution</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">distribution</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_search_space</span><span class="o">.</span><span class="n">calculate</span><span class="p">(</span><span class="n">study</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">distribution</span><span class="o">.</span><span class="n">single</span><span class="p">():</span>
            <span class="c1"># The `untransform` method of `optuna._transform._SearchSpaceTransform`</span>
            <span class="c1"># does not assume a single value,</span>
            <span class="c1"># so single value objects are not sampled with the `sample_relative` method,</span>
            <span class="c1"># but with the `sample_independent` method.</span>
            <span class="k">continue</span>
        <span class="n">search_space</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">distribution</span>
    <span class="k">return</span> <span class="n">search_space</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h2 id="optuna_externm.opt._lexde.LEXDESampler.reseed_rng" class="doc doc-heading">
<code class="highlight language-python"><span class="n">reseed_rng</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>


</h2>

    <div class="doc doc-contents ">

      <p>Reseed sampler's random number generator.</p>
<p>This method is called by the :class:<code>~optuna.study.Study</code> instance if trials are executed
in parallel with the option <code>n_jobs&gt;1</code>. In that case, the sampler instance will be
replicated including the state of the random number generator, and they may suggest the
same values. To prevent this issue, this method assigns a different seed to each random
number generator.</p>

        <details class="quote">
          <summary>Source code in <code>optuna_externm/opt/_lexde.py</code></summary>
          <div class="highlight"><span class="filename">Python</span><pre><span></span><code><span class="k">def</span> <span class="nf">reseed_rng</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_random_sampler</span><span class="o">.</span><span class="n">reseed_rng</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_rng</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">RandomState</span><span class="p">()</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h2 id="optuna_externm.opt._lexde.LEXDESampler.sample_independent" class="doc doc-heading">
<code class="highlight language-python"><span class="n">sample_independent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">study</span><span class="p">,</span> <span class="n">trial</span><span class="p">,</span> <span class="n">param_name</span><span class="p">,</span> <span class="n">param_distribution</span><span class="p">)</span></code>


</h2>

    <div class="doc doc-contents ">

      <p>Sample a parameter for a given distribution.</p>
<p>This method is called only for the parameters not contained in the search space returned
by :func:<code>~optuna.samplers.BaseSampler.sample_relative</code> method. This method is suitable
for sampling algorithms that do not use relationship between parameters such as random
sampling and TPE.</p>
<p>.. note::
        The failed trials are ignored by any build-in samplers when they sample new
        parameters. Thus, failed trials are regarded as deleted in the samplers'
        perspective.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>study</code></td>
        <td><code>Study</code></td>
        <td><p>Target study object.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>trial</code></td>
        <td><code>FrozenTrial</code></td>
        <td><p>Target trial object.
Take a copy before modifying this object.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>param_name</code></td>
        <td><code>str</code></td>
        <td><p>Name of the sampled parameter.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>param_distribution</code></td>
        <td><code>BaseDistribution</code></td>
        <td><p>Distribution object that specifies a prior and/or scale of the sampling algorithm.</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>Any</code></td>
      <td><p>A parameter value.</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>optuna_externm/opt/_lexde.py</code></summary>
          <div class="highlight"><span class="filename">Python</span><pre><span></span><code><span class="k">def</span> <span class="nf">sample_independent</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">study</span><span class="p">:</span> <span class="n">Study</span><span class="p">,</span>
    <span class="n">trial</span><span class="p">:</span> <span class="n">FrozenTrial</span><span class="p">,</span>
    <span class="n">param_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">param_distribution</span><span class="p">:</span> <span class="n">BaseDistribution</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
    <span class="c1"># Following parameters are randomly sampled here.</span>
    <span class="c1"># 1. A parameter in the initial population/first generation.</span>
    <span class="c1"># 2. A parameter to mutate.</span>
    <span class="c1"># 3. A parameter excluded from the intersection search space.</span>

    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_random_sampler</span><span class="o">.</span><span class="n">sample_independent</span><span class="p">(</span>
        <span class="n">study</span><span class="p">,</span> <span class="n">trial</span><span class="p">,</span> <span class="n">param_name</span><span class="p">,</span> <span class="n">param_distribution</span>
    <span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h2 id="optuna_externm.opt._lexde.LEXDESampler.sample_relative" class="doc doc-heading">
<code class="highlight language-python"><span class="n">sample_relative</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">study</span><span class="p">,</span> <span class="n">trial</span><span class="p">,</span> <span class="n">search_space</span><span class="p">)</span></code>


</h2>

    <div class="doc doc-contents ">

      <p>Sample parameters in a given search space.</p>
<p>This method is called once at the beginning of each trial, i.e., right before the
evaluation of the objective function. This method is suitable for sampling algorithms
that use relationship between parameters such as Gaussian Process and CMA-ES.</p>
<p>.. note::
        The failed trials are ignored by any build-in samplers when they sample new
        parameters. Thus, failed trials are regarded as deleted in the samplers'
        perspective.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>study</code></td>
        <td><code>Study</code></td>
        <td><p>Target study object.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>trial</code></td>
        <td><code>FrozenTrial</code></td>
        <td><p>Target trial object.
Take a copy before modifying this object.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>search_space</code></td>
        <td><code>Dict[str, optuna.distributions.BaseDistribution]</code></td>
        <td><p>The search space returned by
:func:<code>~optuna.samplers.BaseSampler.infer_relative_search_space</code>.</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>Dict[str, Any]</code></td>
      <td><p>A dictionary containing the parameter names and the values.</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>optuna_externm/opt/_lexde.py</code></summary>
          <div class="highlight"><span class="filename">Python</span><pre><span></span><code><span class="k">def</span> <span class="nf">sample_relative</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">study</span><span class="p">:</span> <span class="n">Study</span><span class="p">,</span>
    <span class="n">trial</span><span class="p">:</span> <span class="n">FrozenTrial</span><span class="p">,</span>
    <span class="n">search_space</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">BaseDistribution</span><span class="p">],</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
    <span class="n">parent_generation</span><span class="p">,</span> <span class="n">parent_population</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_collect_parent_population</span><span class="p">(</span><span class="n">study</span><span class="p">)</span>
    <span class="n">trial_id</span> <span class="o">=</span> <span class="n">trial</span><span class="o">.</span><span class="n">_trial_id</span>

    <span class="n">generation</span> <span class="o">=</span> <span class="n">parent_generation</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="n">study</span><span class="o">.</span><span class="n">_storage</span><span class="o">.</span><span class="n">set_trial_system_attr</span><span class="p">(</span><span class="n">trial_id</span><span class="p">,</span> <span class="n">_GENERATION_KEY</span><span class="p">,</span> <span class="n">generation</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">parent_generation</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>

        <span class="c1"># Select the first parent by automatic epsilon lexicase selection</span>
        <span class="c1"># and the rest two parents by random selection; Perform DE mutation,</span>
        <span class="c1"># binary crossover, and polynomial mutation</span>
        <span class="c1"># x1: lexicase; x2, x3: random</span>
        <span class="c1"># y = x1 + F * (x2 - x3)</span>
        <span class="c1"># y = bin(y, x1)</span>
        <span class="c1"># y = polym(y)</span>

        <span class="c1"># Automatic epsilon lexicase selection</span>
        <span class="n">parents</span> <span class="o">=</span> <span class="n">selAutomaticEpsilonLexicase</span><span class="p">(</span>
            <span class="n">study</span><span class="p">,</span>
            <span class="n">parent_population</span><span class="p">,</span>
            <span class="mi">1</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_rng</span>
        <span class="p">)</span> <span class="o">+</span> <span class="n">selRandom</span><span class="p">(</span>
            <span class="n">study</span><span class="p">,</span>
            <span class="n">parent_population</span><span class="p">,</span>
            <span class="mi">2</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_rng</span>
        <span class="p">)</span>

        <span class="c1"># Convert population to array</span>
        <span class="p">(</span><span class="n">parents_numerical_params_array</span><span class="p">,</span>
         <span class="n">numerical_transform</span><span class="p">,</span>
         <span class="n">numerical_distributions</span><span class="p">)</span> <span class="o">=</span> <span class="n">population_to_numerical_params_array</span><span class="p">(</span>
            <span class="n">parents</span><span class="p">,</span>
            <span class="n">search_space</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># DE mutation</span>
        <span class="n">child_params_array</span> <span class="o">=</span> <span class="n">mutDEBounded</span><span class="p">(</span>
            <span class="n">parents_numerical_params_array</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
            <span class="n">parents_numerical_params_array</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
            <span class="n">parents_numerical_params_array</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_rng</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_F</span><span class="p">,</span>
            <span class="n">numerical_distributions</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># DE binary crossover</span>
        <span class="n">child_params_array</span> <span class="o">=</span> <span class="n">cxDEBinary</span><span class="p">(</span>
            <span class="n">child_params_array</span><span class="p">,</span>
            <span class="n">parents_numerical_params_array</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_rng</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_CR</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># Polynomial mutation</span>
        <span class="n">child_params_array</span> <span class="o">=</span> <span class="n">mutPolynomialBounded</span><span class="p">(</span>
            <span class="n">child_params_array</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_rng</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_mutation_eta</span><span class="p">,</span>
            <span class="n">numerical_distributions</span><span class="p">,</span>
        <span class="p">)</span>


        <span class="c1"># convert array to params</span>
        <span class="n">child_params</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">child_numerical_params</span> <span class="o">=</span> <span class="n">numerical_transform</span><span class="o">.</span><span class="n">untransform</span><span class="p">(</span><span class="n">child_params_array</span><span class="p">)</span>
        <span class="n">child_params</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">child_numerical_params</span><span class="p">)</span>

        <span class="n">params</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">param_name</span> <span class="ow">in</span> <span class="n">child_params</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">params</span><span class="p">[</span><span class="n">param_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">child_params</span><span class="p">[</span><span class="n">param_name</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">params</span>

    <span class="k">return</span> <span class="p">{}</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>

              

            </article>
          </div>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        
        <a href="sa.html" class="md-footer__link md-footer__link--prev" aria-label="Previous: Sensitivity Samplers" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Sensitivity Samplers
            </div>
          </div>
        </a>
      
      
        
        <a href="../ophm/about.html" class="md-footer__link md-footer__link--next" aria-label="Next: About" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              About
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Tony Hallam
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "..", "features": ["navigations.instant", "navigation.tracking", "navigation.tabs", "navigation.sections", "navigation.expand"], "search": "../assets/javascripts/workers/search.5e67fbfe.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.c44cc438.min.js"></script>
      
        <script src="../javascripts/mathjax.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>