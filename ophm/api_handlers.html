
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
        <meta name="author" content="Tony Hallam">
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.3.0, mkdocs-material-8.2.8">
    
    
      
        <title>Handlers - Optuna-ExternM Documentation</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.644de097.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.e6a45f82.min.css">
        
          
          
          <meta name="theme-color" content="#4cae4f">
        
      
    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="green" data-md-color-accent="">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#handlers" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Optuna-ExternM Documentation" class="md-header__button md-logo" aria-label="Optuna-ExternM Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Optuna-ExternM Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Handlers
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/trhallam/optuna-externm" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    trhallam/optuna-externm
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../index.html" class="md-tabs__link">
        Home
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../sa/intro.html" class="md-tabs__link">
        Sensitivity Analysis
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../opt/intro.html" class="md-tabs__link">
        Optimisation
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../ug/framework.html" class="md-tabs__link">
        User Guide
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../api/core.html" class="md-tabs__link">
        API
      </a>
    </li>
  

      
        
  
  
    
  


  
  
  
    <li class="md-tabs__item">
      <a href="about.html" class="md-tabs__link md-tabs__link--active">
        Optuna-HM
      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Optuna-ExternM Documentation" class="md-nav__button md-logo" aria-label="Optuna-ExternM Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    Optuna-ExternM Documentation
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/trhallam/optuna-externm" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    trhallam/optuna-externm
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_1" data-md-state="indeterminate" type="checkbox" id="__nav_1" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_1">
          Home
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Home" data-md-level="1">
        <label class="md-nav__title" for="__nav_1">
          <span class="md-nav__icon md-icon"></span>
          Home
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../index.html" class="md-nav__link">
        About
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../contrib.html" class="md-nav__link">
        Contributing
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../contact.html" class="md-nav__link">
        Contact
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="https://github.com/trhallam/optuna-externm/issues" class="md-nav__link">
        Issue Tracker
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" data-md-state="indeterminate" type="checkbox" id="__nav_2" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_2">
          Sensitivity Analysis
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Sensitivity Analysis" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Sensitivity Analysis
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../sa/intro.html" class="md-nav__link">
        Introduction
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../sa/ovat.html" class="md-nav__link">
        OVAT
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../sa/sobol.html" class="md-nav__link">
        Sobol
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" data-md-state="indeterminate" type="checkbox" id="__nav_3" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_3">
          Optimisation
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Optimisation" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Optimisation
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../opt/intro.html" class="md-nav__link">
        Introduction
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../opt/cmaes.html" class="md-nav__link">
        Cma-Es
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../opt/lexde.html" class="md-nav__link">
        Lex-De
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" data-md-state="indeterminate" type="checkbox" id="__nav_4" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_4">
          User Guide
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="User Guide" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          User Guide
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../ug/framework.html" class="md-nav__link">
        Optuna-ExternM Framework
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../cli/cli.html" class="md-nav__link">
        CLI
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5" data-md-state="indeterminate" type="checkbox" id="__nav_5" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_5">
          API
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="API" data-md-level="1">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          API
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../api/core.html" class="md-nav__link">
        Core
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../api/sa.html" class="md-nav__link">
        Sensitivity Samplers
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../api/opt.html" class="md-nav__link">
        Optimisation Samplers
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6" type="checkbox" id="__nav_6" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_6">
          Optuna-HM
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Optuna-HM" data-md-level="1">
        <label class="md-nav__title" for="__nav_6">
          <span class="md-nav__icon md-icon"></span>
          Optuna-HM
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="about.html" class="md-nav__link">
        About
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="tutorial.html" class="md-nav__link">
        Tutorial
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    
      
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6_3" type="checkbox" id="__nav_6_3" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_6_3">
          API
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="API" data-md-level="2">
        <label class="md-nav__title" for="__nav_6_3">
          <span class="md-nav__icon md-icon"></span>
          API
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Handlers
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="api_handlers.html" class="md-nav__link md-nav__link--active">
        Handlers
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#optuna_hmhandlersecl" class="md-nav__link">
    optuna_hm.handlers.ecl
  </a>
  
    <nav class="md-nav" aria-label="optuna_hm.handlers.ecl">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#optuna_hm.handlers._ecl_simh.ECL100Handler" class="md-nav__link">
    ECL100Handler
  </a>
  
    <nav class="md-nav" aria-label="ECL100Handler">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#optuna_hm.handlers._ecl_simh.ECL100Handler.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#optuna_hm.handlers._ecl_simh.ECL100Handler.launch" class="md-nav__link">
    launch()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#optuna_hm.handlers._ecl_simh.ECLBaseHandler" class="md-nav__link">
    ECLBaseHandler
  </a>
  
    <nav class="md-nav" aria-label="ECLBaseHandler">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#optuna_hm.handlers._ecl_simh.ECLBaseHandler.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#optuna_hm.handlers._ecl_simh.ECLBaseHandler.cleanup" class="md-nav__link">
    cleanup()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#optuna_hm.handlers._ecl_simh.ECLBaseHandler.create_working_model" class="md-nav__link">
    create_working_model()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#optuna_hm.handlers._ecl_simh.ECLBaseHandler.launch" class="md-nav__link">
    launch()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#optuna_hm.handlers._ecl_simh.ECLBaseHandler.retrieve_ecl_prop" class="md-nav__link">
    retrieve_ecl_prop()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#optuna_hm.handlers._ecl_simh.ECLBaseHandler.save_model" class="md-nav__link">
    save_model()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#optuna_hm.handlers._ecl_simh.ECLBaseHandler.save_model_outputs" class="md-nav__link">
    save_model_outputs()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#optuna_hm.handlers._ecl_simh.ECLBaseHandler.set_ecl" class="md-nav__link">
    set_ecl()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#optuna_hm.handlers._ecl_simh.ECLBaseHandler.set_model_path" class="md-nav__link">
    set_model_path()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#optuna_hm.handlers._ecl_simh.ECLBaseHandler.set_save_model_outputs" class="md-nav__link">
    set_save_model_outputs()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#optuna_hm.handlers._ecl_simh.ECLBaseHandler.set_save_sim_logs" class="md-nav__link">
    set_save_sim_logs()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#optuna_hm.handlers._ecl_simh.ECLBaseHandler.update_ecl_prop" class="md-nav__link">
    update_ecl_prop()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#optuna_hm.handlers._ecl_simh.ECLDatHandler" class="md-nav__link">
    ECLDatHandler
  </a>
  
    <nav class="md-nav" aria-label="ECLDatHandler">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#optuna_hm.handlers._ecl_simh.ECLDatHandler.update" class="md-nav__link">
    update()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#optuna_hm.handlers._ecl_simh.ECLFakeHandler" class="md-nav__link">
    ECLFakeHandler
  </a>
  
    <nav class="md-nav" aria-label="ECLFakeHandler">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#optuna_hm.handlers._ecl_simh.ECLFakeHandler.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#optuna_hm.handlers._ecl_simh.ECLFakeHandler.clean_results" class="md-nav__link">
    clean_results()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#optuna_hm.handlers._ecl_simh.ECLFakeHandler.launch" class="md-nav__link">
    launch()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#optuna_hm.handlers._ecl_simh.ECLFakeHandler.write_rsm" class="md-nav__link">
    write_rsm()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#optuna_hm.handlers._ecl_eval.Error" class="md-nav__link">
    Error
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#optuna_hm.handlers._ecl_eval.SimulationRunError" class="md-nav__link">
    SimulationRunError
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#optuna_hm.handlers._ecl_eval.evaluate_eclipse_model" class="md-nav__link">
    evaluate_eclipse_model()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#optuna_hm.handlers._ecl_eval.evaluate_well_prod" class="md-nav__link">
    evaluate_well_prod()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#optuna_hmhandlersflow" class="md-nav__link">
    optuna_hm.handlers.flow
  </a>
  
    <nav class="md-nav" aria-label="optuna_hm.handlers.flow">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#optuna_hm.handlers.flow.FlowHandler" class="md-nav__link">
    FlowHandler
  </a>
  
    <nav class="md-nav" aria-label="FlowHandler">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#optuna_hm.handlers.flow.FlowHandler.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#optuna_hm.handlers.flow.FlowHandler.launch" class="md-nav__link">
    launch()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="api_metrics.html" class="md-nav__link">
        Metrics
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#optuna_hmhandlersecl" class="md-nav__link">
    optuna_hm.handlers.ecl
  </a>
  
    <nav class="md-nav" aria-label="optuna_hm.handlers.ecl">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#optuna_hm.handlers._ecl_simh.ECL100Handler" class="md-nav__link">
    ECL100Handler
  </a>
  
    <nav class="md-nav" aria-label="ECL100Handler">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#optuna_hm.handlers._ecl_simh.ECL100Handler.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#optuna_hm.handlers._ecl_simh.ECL100Handler.launch" class="md-nav__link">
    launch()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#optuna_hm.handlers._ecl_simh.ECLBaseHandler" class="md-nav__link">
    ECLBaseHandler
  </a>
  
    <nav class="md-nav" aria-label="ECLBaseHandler">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#optuna_hm.handlers._ecl_simh.ECLBaseHandler.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#optuna_hm.handlers._ecl_simh.ECLBaseHandler.cleanup" class="md-nav__link">
    cleanup()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#optuna_hm.handlers._ecl_simh.ECLBaseHandler.create_working_model" class="md-nav__link">
    create_working_model()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#optuna_hm.handlers._ecl_simh.ECLBaseHandler.launch" class="md-nav__link">
    launch()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#optuna_hm.handlers._ecl_simh.ECLBaseHandler.retrieve_ecl_prop" class="md-nav__link">
    retrieve_ecl_prop()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#optuna_hm.handlers._ecl_simh.ECLBaseHandler.save_model" class="md-nav__link">
    save_model()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#optuna_hm.handlers._ecl_simh.ECLBaseHandler.save_model_outputs" class="md-nav__link">
    save_model_outputs()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#optuna_hm.handlers._ecl_simh.ECLBaseHandler.set_ecl" class="md-nav__link">
    set_ecl()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#optuna_hm.handlers._ecl_simh.ECLBaseHandler.set_model_path" class="md-nav__link">
    set_model_path()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#optuna_hm.handlers._ecl_simh.ECLBaseHandler.set_save_model_outputs" class="md-nav__link">
    set_save_model_outputs()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#optuna_hm.handlers._ecl_simh.ECLBaseHandler.set_save_sim_logs" class="md-nav__link">
    set_save_sim_logs()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#optuna_hm.handlers._ecl_simh.ECLBaseHandler.update_ecl_prop" class="md-nav__link">
    update_ecl_prop()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#optuna_hm.handlers._ecl_simh.ECLDatHandler" class="md-nav__link">
    ECLDatHandler
  </a>
  
    <nav class="md-nav" aria-label="ECLDatHandler">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#optuna_hm.handlers._ecl_simh.ECLDatHandler.update" class="md-nav__link">
    update()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#optuna_hm.handlers._ecl_simh.ECLFakeHandler" class="md-nav__link">
    ECLFakeHandler
  </a>
  
    <nav class="md-nav" aria-label="ECLFakeHandler">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#optuna_hm.handlers._ecl_simh.ECLFakeHandler.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#optuna_hm.handlers._ecl_simh.ECLFakeHandler.clean_results" class="md-nav__link">
    clean_results()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#optuna_hm.handlers._ecl_simh.ECLFakeHandler.launch" class="md-nav__link">
    launch()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#optuna_hm.handlers._ecl_simh.ECLFakeHandler.write_rsm" class="md-nav__link">
    write_rsm()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#optuna_hm.handlers._ecl_eval.Error" class="md-nav__link">
    Error
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#optuna_hm.handlers._ecl_eval.SimulationRunError" class="md-nav__link">
    SimulationRunError
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#optuna_hm.handlers._ecl_eval.evaluate_eclipse_model" class="md-nav__link">
    evaluate_eclipse_model()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#optuna_hm.handlers._ecl_eval.evaluate_well_prod" class="md-nav__link">
    evaluate_well_prod()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#optuna_hmhandlersflow" class="md-nav__link">
    optuna_hm.handlers.flow
  </a>
  
    <nav class="md-nav" aria-label="optuna_hm.handlers.flow">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#optuna_hm.handlers.flow.FlowHandler" class="md-nav__link">
    FlowHandler
  </a>
  
    <nav class="md-nav" aria-label="FlowHandler">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#optuna_hm.handlers.flow.FlowHandler.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#optuna_hm.handlers.flow.FlowHandler.launch" class="md-nav__link">
    launch()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              



                
<a href="https://github.com/trhallam/optuna-externm/edit/main/docs/ophm/api_handlers.md" title="Edit this page" class="md-content__button md-icon">
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
</a>



<h1 id="handlers">Handlers</h1>
<div class="highlight"><span class="filename">Python</span><pre><span></span><code><span class="kn">from</span> <span class="nn">optuna_hm</span> <span class="kn">import</span> <span class="n">handlers</span>
</code></pre></div>
<h2 id="optuna_hmhandlersecl"><code>optuna_hm.handlers.ecl</code></h2>
<p>Handlers for interfacing with and evaluating Eclipse (Schlumberger) Reservoir Simulation models. Eclipse is a proprietary simulation software which has a command
line interface.</p>


  <div class="doc doc-object doc-module">


    <div class="doc doc-contents first">

      <p>Handler module for external file and process handling
of ECLIPSE flow simulator - Schlumberger</p>
<p>hand_ecl100 -  Claus Aranha (caranha@cs.tsukuba.ac.jp)
hand_ecldat -  Tony Hallam</p>



  <div class="doc doc-children">










  <div class="doc doc-object doc-class">



<h3 id="optuna_hm.handlers._ecl_simh.ECL100Handler" class="doc doc-heading">
        <code>
ECL100Handler            (<a class="autorefs autorefs-internal" title="optuna_hm.handlers._ecl_simh.ECLBaseHandler" href="#optuna_hm.handlers._ecl_simh.ECLBaseHandler">ECLBaseHandler</a>)
        </code>



</h3>

    <div class="doc doc-contents ">

      <p>This modules runs the ECLIPSE100 simulator in a "sandbox" directory,
modifying the (prepared) parameter files with a set of test parameters.
The results of the run are packaged for analysis by an optimizer.</p>

        <details class="quote">
          <summary>Source code in <code>optuna_hm/handlers/_ecl_simh.py</code></summary>
          <div class="highlight"><span class="filename">Python</span><pre><span></span><code><span class="k">class</span> <span class="nc">ECL100Handler</span><span class="p">(</span><span class="n">ECLBaseHandler</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This modules runs the ECLIPSE100 simulator in a &quot;sandbox&quot; directory,</span>
<span class="sd">    modifying the (prepared) parameter files with a set of test parameters.</span>
<span class="sd">    The results of the run are packaged for analysis by an optimizer.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;See ECLBaseHandler</span>
<span class="sd">        Notes:</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s2">&quot;ECL100Handler&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__deepcopy__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">memo</span><span class="p">):</span>
        <span class="c1"># need to create a special copy function because the logger cannot be coppied</span>
        <span class="c1"># this means reinitialisation is necessary for each new simulator class</span>
        <span class="n">args</span> <span class="o">=</span> <span class="p">[</span>
            <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="n">var</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="p">[</span>
                <span class="s2">&quot;model_name&quot;</span><span class="p">,</span>
                <span class="s2">&quot;model_path&quot;</span><span class="p">,</span>
                <span class="s2">&quot;popt&quot;</span><span class="p">,</span>
                <span class="s2">&quot;simexe&quot;</span><span class="p">,</span>
                <span class="s2">&quot;time_out&quot;</span><span class="p">,</span>
                <span class="s2">&quot;silent&quot;</span><span class="p">,</span>
            <span class="p">]</span>
        <span class="p">]</span>
        <span class="k">return</span> <span class="n">ECL100Handler</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">launch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">cmdargs</span><span class="p">,</span> <span class="o">**</span><span class="n">cmdkwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Launch the ecl simulator.</span>

<span class="sd">        Args:</span>
<span class="sd">            None</span>

<span class="sd">        Returns:</span>
<span class="sd">            bool: True if run did not timeout.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">modelfile</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model_name</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;.DATA&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;running model </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model_path</span><span class="p">,</span> <span class="n">modelfile</span><span class="p">))</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">launch</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model_name</span><span class="p">)</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">










  <div class="doc doc-object doc-method">



<h4 id="optuna_hm.handlers._ecl_simh.ECL100Handler.__init__" class="doc doc-heading">
<code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

</h4>

    <div class="doc doc-contents ">

      <p>See ECLBaseHandler
Notes:</p>

        <details class="quote">
          <summary>Source code in <code>optuna_hm/handlers/_ecl_simh.py</code></summary>
          <div class="highlight"><span class="filename">Python</span><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;See ECLBaseHandler</span>
<span class="sd">    Notes:</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s2">&quot;ECL100Handler&quot;</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h4 id="optuna_hm.handlers._ecl_simh.ECL100Handler.launch" class="doc doc-heading">
<code class="highlight language-python"><span class="n">launch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">cmdargs</span><span class="p">,</span> <span class="o">**</span><span class="n">cmdkwargs</span><span class="p">)</span></code>


</h4>

    <div class="doc doc-contents ">

      <p>Launch the ecl simulator.</p>

<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>bool</code></td>
      <td><p>True if run did not timeout.</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>optuna_hm/handlers/_ecl_simh.py</code></summary>
          <div class="highlight"><span class="filename">Python</span><pre><span></span><code><span class="k">def</span> <span class="nf">launch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">cmdargs</span><span class="p">,</span> <span class="o">**</span><span class="n">cmdkwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Launch the ecl simulator.</span>

<span class="sd">    Args:</span>
<span class="sd">        None</span>

<span class="sd">    Returns:</span>
<span class="sd">        bool: True if run did not timeout.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">modelfile</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model_name</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;.DATA&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;running model </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model_path</span><span class="p">,</span> <span class="n">modelfile</span><span class="p">))</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">launch</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model_name</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>



  <div class="doc doc-object doc-class">



<h3 id="optuna_hm.handlers._ecl_simh.ECLBaseHandler" class="doc doc-heading">
        <code>
ECLBaseHandler        </code>



</h3>

    <div class="doc doc-contents ">

      <p>Basic Class for interacting with ECLIPSE Simulation Program</p>

        <details class="quote">
          <summary>Source code in <code>optuna_hm/handlers/_ecl_simh.py</code></summary>
          <div class="highlight"><span class="filename">Python</span><pre><span></span><code><span class="k">class</span> <span class="nc">ECLBaseHandler</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Basic Class for interacting with ECLIPSE Simulation Program&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">model_name</span><span class="p">,</span>
        <span class="n">model_path</span><span class="p">,</span>
        <span class="n">model_param</span><span class="p">,</span>
        <span class="n">application_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">rerun_license_errors</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">license_error_sleep</span><span class="o">=</span><span class="mi">600</span><span class="p">,</span>
        <span class="n">time_out</span><span class="o">=</span><span class="mi">900</span><span class="p">,</span>
        <span class="n">silent</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">original</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Args:</span>
<span class="sd">            application_path (str): Path to simulation executable</span>
<span class="sd">            model_name (str): The name of the ECLIPSE Model</span>
<span class="sd">            model_path (str): The path to the ECLIPSE Model</span>
<span class="sd">            model_param (pandas.DataFrame): The model parameters to update</span>
<span class="sd">                the parameter key should be in the index of the DF.</span>
<span class="sd">            time_out (int): Defaults to 900 seconds. Time before cancelling subprocess simulation</span>
<span class="sd">                run.</span>
<span class="sd">            silent (bool): Defaults to True, set to False to print STDOUT from subprocess call.</span>
<span class="sd">            original (bool): Is this the original model. If true changes to the model will not be</span>
<span class="sd">                permitted.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model_name</span> <span class="o">=</span> <span class="n">model_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model_path</span> <span class="o">=</span> <span class="n">model_path</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">popt</span> <span class="o">=</span> <span class="n">model_param</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s2">&quot;ECLBaseHandler&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">temp_dir</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">original</span> <span class="o">=</span> <span class="n">original</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log_path</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="s2">&quot;00000000&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rerun_le</span> <span class="o">=</span> <span class="n">rerun_license_errors</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sleep_le</span> <span class="o">=</span> <span class="n">license_error_sleep</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">silent</span> <span class="o">=</span> <span class="n">silent</span>
        <span class="k">if</span> <span class="n">application_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_ecl</span><span class="p">(</span><span class="n">application_path</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">simexe</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">time_out</span> <span class="o">=</span> <span class="n">time_out</span>

    <span class="k">def</span> <span class="nf">set_ecl</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">application_path</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set the simulator application path&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">simexe</span> <span class="o">=</span> <span class="n">application_path</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">simexe</span><span class="p">)</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Cannot find simulator executable </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">simexe</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__deepcopy__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">memo</span><span class="p">):</span>
        <span class="c1"># create a copy but not logger</span>
        <span class="n">copy_list</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;model_name&quot;</span><span class="p">,</span> <span class="s2">&quot;model_path&quot;</span><span class="p">,</span> <span class="s2">&quot;popt&quot;</span><span class="p">,</span> <span class="s2">&quot;simexe&quot;</span><span class="p">,</span> <span class="s2">&quot;time_out&quot;</span><span class="p">,</span> <span class="s2">&quot;silent&quot;</span><span class="p">]</span>
        <span class="n">obj_copy</span> <span class="o">=</span> <span class="nb">object</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">copy_list</span><span class="p">:</span>
            <span class="n">obj_copy</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="n">item</span><span class="p">]</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="n">item</span><span class="p">],</span> <span class="n">memo</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">obj_copy</span>

    <span class="k">def</span> <span class="nf">update_ecl_prop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prop</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Creates appropriate property values from random floats in range 0-1</span>

<span class="sd">        Args:</span>
<span class="sd">            prop (dict): list or random floats in range (0-1) supplied by population update</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># normalise prop random floats (0-1) to property ranges</span>
        <span class="c1"># this replaces unnormalise</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">original</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">PermissionError</span><span class="p">(</span>
                <span class="s2">&quot;You must create a working copy of the model using&quot;</span>
                <span class="o">+</span> <span class="s2">&quot; create_working_model, changes to the original model are not permitted.&quot;</span>
            <span class="p">)</span>


        <span class="bp">self</span><span class="o">.</span><span class="n">popt</span><span class="p">[</span><span class="s2">&quot;new_values&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">popt</span><span class="p">[</span><span class="s2">&quot;NAME&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">prop</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">file_name</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">popt</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;FILE&quot;</span><span class="p">):</span>
            <span class="n">filepath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model_path</span><span class="p">,</span> <span class="n">file_name</span><span class="p">)</span>
            <span class="n">updatefile</span> <span class="o">=</span> <span class="n">ECLDatHandler</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span>
            <span class="c1"># change this to write actual update values</span>
            <span class="n">updatefile</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">val</span><span class="p">[[</span><span class="s2">&quot;NAME&quot;</span><span class="p">,</span> <span class="s2">&quot;new_values&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;NAME&quot;</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">popt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">popt</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="s2">&quot;new_values&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">retrieve_ecl_prop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Retrieve objective parameter values</span>

<span class="sd">        Returns:</span>
<span class="sd">            (list): list of parameters corresponding to flags</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">values</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="n">flags</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">popt</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span>
        <span class="n">flags</span> <span class="o">=</span> <span class="p">[</span><span class="n">flg</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="k">for</span> <span class="n">flg</span> <span class="ow">in</span> <span class="n">flags</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">file_name</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">popt</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;FILE&quot;</span><span class="p">):</span>
            <span class="n">filepath</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_path</span> <span class="o">/</span> <span class="n">file_name</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fdat</span><span class="p">:</span>
                <span class="n">lines</span> <span class="o">=</span> <span class="n">fdat</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">flag</span> <span class="ow">in</span> <span class="n">flags</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">flag</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                        <span class="n">split</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                        <span class="n">find</span> <span class="o">=</span> <span class="n">split</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">flag</span><span class="p">)</span>
                        <span class="n">ind</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">split</span><span class="p">[</span><span class="n">find</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span>
                        <span class="n">values</span><span class="p">[</span><span class="n">flag</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">split</span><span class="p">[</span><span class="n">ind</span><span class="p">])</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">values</span><span class="p">[</span><span class="n">file_name</span><span class="p">]</span> <span class="k">for</span> <span class="n">file_name</span> <span class="ow">in</span> <span class="n">flags</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">set_model_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">newpath</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set the path to the model&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model_path</span> <span class="o">=</span> <span class="n">newpath</span>

    <span class="k">def</span> <span class="nf">set_save_sim_logs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set location to save model logs. For Eclipse these are the DBG files created by the run.</span>
<span class="sd">        Args:</span>
<span class="sd">            path (str): The path to save the logs to. If directory doesn&#39;t exist it will be created.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
            <span class="n">path</span><span class="o">.</span><span class="n">mkdir</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log_path</span> <span class="o">=</span> <span class="n">path</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Simulation logs will be saved to: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">path</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">save_model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Save the whole model folder to a new path.</span>

<span class="sd">        Args:</span>
<span class="sd">            path (pathlike)</span>
<span class="sd">            prefix (str, optional)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">new_folder_name</span> <span class="o">=</span> <span class="s2">&quot;_&quot;</span><span class="o">.</span><span class="n">join</span>

        <span class="k">if</span> <span class="n">prefix</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">new_folder_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">prefix</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">model_name</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">new_folder_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_name</span>

        <span class="n">save_path</span> <span class="o">=</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="o">/</span> <span class="n">new_folder_name</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">save_path</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
            <span class="n">save_path</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_path</span><span class="o">.</span><span class="n">iterdir</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">is_file</span><span class="p">():</span>
                <span class="n">shutil</span><span class="o">.</span><span class="n">copy2</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">save_path</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">item</span><span class="o">.</span><span class="n">is_dir</span><span class="p">():</span>
                <span class="kn">from</span> <span class="nn">distutils.dir_util</span> <span class="kn">import</span> <span class="n">copy_tree</span>

                <span class="n">copy_tree</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">item</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="n">save_path</span> <span class="o">/</span> <span class="n">item</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Saved model successfully to </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">save_path</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">save_model_outputs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">files</span><span class="p">,</span> <span class="n">outputs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Specify model outputs to save for debugging or further review.</span>

<span class="sd">        Args:</span>
<span class="sd">            files (list): List of files to save.</span>
<span class="sd">            outputs (list): List of files to save.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">prefix</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">prefix</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

        <span class="n">path</span> <span class="o">=</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
            <span class="n">path</span><span class="o">.</span><span class="n">mkdir</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
            <span class="n">file</span> <span class="o">=</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
            <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">id</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="n">file</span><span class="o">.</span><span class="n">name</span>
            <span class="n">shutil</span><span class="o">.</span><span class="n">copy2</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model_path</span> <span class="o">/</span> <span class="n">file</span><span class="p">,</span> <span class="n">path</span> <span class="o">/</span> <span class="n">name</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">set_save_model_outputs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">outputs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Specify model outputs to save for debugging or further review.</span>

<span class="sd">        Args:</span>
<span class="sd">            outputs (list): List of files to save.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">prefix</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">prefix</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

        <span class="k">if</span> <span class="n">outputs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">shutil</span><span class="o">.</span><span class="n">copytree</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model_path</span><span class="p">,</span> <span class="n">prefix</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">create_working_model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">working_dir</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">working_cwd</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Create a working copy of this simulator so it can be modified without destroying the original.</span>

<span class="sd">        Args:</span>
<span class="sd">            working_dir (str): If None, a temporary directory in the working_cwd will be created.</span>
<span class="sd">                Otherwise, specify a path to a preferred working directory. Defaults to None.</span>
<span class="sd">            working_cwd (str): If None, use the current working director. Otherwise will create temporary</span>
<span class="sd">                space in working_cwd. Defaults to None. This can be useful when using distributed processing and</span>
<span class="sd">                you want models to be evaluated on remote storage.</span>

<span class="sd">        Returns:</span>
<span class="sd">            (EclBaseHandler): A copy of simulator with a new working directory.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># create working directory and simulator class</span>
        <span class="n">working_simulator</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">working_cwd</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">working_cwd</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">working_dir</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">temp_dir</span> <span class="o">=</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">TemporaryDirectory</span><span class="p">(</span>
                <span class="n">prefix</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;tempECL_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">model_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nb">dir</span><span class="o">=</span><span class="n">working_cwd</span>
            <span class="p">)</span>
            <span class="c1"># store temp dir with model so we don&#39;t lose it when exiting this namespace</span>
            <span class="n">working_simulator</span><span class="o">.</span><span class="n">temp_dir</span> <span class="o">=</span> <span class="n">temp_dir</span>
            <span class="n">working_dir</span> <span class="o">=</span> <span class="n">temp_dir</span><span class="o">.</span><span class="n">name</span>
            <span class="n">working_simulator</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">temp_dir</span><span class="o">.</span><span class="n">name</span><span class="p">[</span><span class="o">-</span><span class="mi">8</span><span class="p">:]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">temp_dir</span> <span class="o">=</span> <span class="n">working_dir</span>
            <span class="n">working_simulator</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">working_dir</span>
        <span class="n">working_path</span> <span class="o">=</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">working_dir</span><span class="p">)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;working directory is </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">working_path</span><span class="p">)</span>
        <span class="n">working_simulator</span><span class="o">.</span><span class="n">set_model_path</span><span class="p">(</span><span class="n">working_path</span><span class="p">)</span>

        <span class="c1"># get the original model path</span>
        <span class="n">model_path</span> <span class="o">=</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model_path</span><span class="p">)</span>
        <span class="n">model_path_size</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span>
            <span class="n">f</span><span class="o">.</span><span class="n">stat</span><span class="p">()</span><span class="o">.</span><span class="n">st_size</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">model_path</span><span class="o">.</span><span class="n">iterdir</span><span class="p">()</span> <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">is_file</span><span class="p">()</span>
        <span class="p">)</span>

        <span class="c1"># copy files into working directory - THIS could be updated to give more info</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Copying model directory to </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">working_path</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">model_path</span><span class="o">.</span><span class="n">iterdir</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">is_file</span><span class="p">():</span>
                <span class="n">shutil</span><span class="o">.</span><span class="n">copy2</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">working_path</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">item</span><span class="o">.</span><span class="n">is_dir</span><span class="p">():</span>
                <span class="kn">from</span> <span class="nn">distutils.dir_util</span> <span class="kn">import</span> <span class="n">copy_tree</span>

                <span class="n">copy_tree</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">item</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="n">working_path</span> <span class="o">/</span> <span class="n">item</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Coppied model successfully&quot;</span><span class="p">)</span>
        <span class="n">working_simulator</span><span class="o">.</span><span class="n">original</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="c1"># working_simulator.id = temp_dir.name[-8:]</span>
        <span class="n">working_simulator</span><span class="o">.</span><span class="n">log_path</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">log_path</span><span class="p">)</span>

        <span class="n">copied</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">while</span> <span class="ow">not</span> <span class="n">copied</span><span class="p">:</span>
            <span class="n">working_path_size</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span>
                <span class="n">f</span><span class="o">.</span><span class="n">stat</span><span class="p">()</span><span class="o">.</span><span class="n">st_size</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">working_path</span><span class="o">.</span><span class="n">iterdir</span><span class="p">()</span> <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">is_file</span><span class="p">()</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">working_path_size</span> <span class="o">==</span> <span class="n">model_path_size</span><span class="p">:</span>
                <span class="n">copied</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
            <span class="c1"># print(working_path.name, working_path_size, model_path_size, copied)</span>

        <span class="k">return</span> <span class="n">working_simulator</span>

    <span class="k">def</span> <span class="nf">_launch_internal_loop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cmd</span><span class="p">):</span>

        <span class="n">process</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">(</span>
            <span class="n">cmd</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">model_path</span><span class="p">,</span> <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span> <span class="n">stderr</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span>
        <span class="p">)</span>

        <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">stdout</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="n">stderr</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">proc_status</span> <span class="o">=</span> <span class="n">process</span><span class="o">.</span><span class="n">poll</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">count</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_out</span><span class="p">:</span>
                <span class="n">process</span><span class="o">.</span><span class="n">terminate</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Simulation Run stopped due to timeout&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="n">stdout</span><span class="p">,</span> <span class="n">proc_status</span>
            <span class="n">output</span> <span class="o">=</span> <span class="n">process</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>
            <span class="n">error</span> <span class="o">=</span> <span class="n">process</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">log_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">log_path</span> <span class="o">/</span> <span class="s2">&quot;optuna-hm-stdout.txt&quot;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;a&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">log_path</span> <span class="o">/</span> <span class="s2">&quot;optuna-hm-stderr.txt&quot;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;a&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
            <span class="k">elif</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">silent</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">output</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span> <span class="ow">and</span> <span class="n">proc_status</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Model run finished with exit </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">proc_status</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">True</span><span class="p">,</span> <span class="n">stdout</span><span class="p">,</span> <span class="n">proc_status</span>

            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">count</span> <span class="o">=</span> <span class="n">count</span> <span class="o">+</span> <span class="mi">1</span>

    <span class="k">def</span> <span class="nf">launch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">cmdargs</span><span class="p">,</span> <span class="o">**</span><span class="n">cmdkwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Launches an eclipse instance, run a simulation.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">original</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">PermissionError</span><span class="p">(</span>
                <span class="s2">&quot;You must create a working copy of the model using&quot;</span>
                <span class="o">+</span> <span class="s2">&quot; create_working_model, changes to the original model are not permitted.&quot;</span>
            <span class="p">)</span>
        <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

        <span class="n">cmd</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">simexe</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">cmdargs</span><span class="p">:</span>
            <span class="n">cmd</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">cmdkw</span> <span class="ow">in</span> <span class="n">cmdkwargs</span><span class="p">:</span>
            <span class="n">cmd</span> <span class="o">=</span> <span class="n">cmd</span> <span class="o">+</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;-</span><span class="si">{</span><span class="n">cmdkw</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">cmdkwargs</span><span class="p">[</span><span class="n">cmdkw</span><span class="p">])]</span>

        <span class="nb">print</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>

        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">good_run</span><span class="p">,</span> <span class="n">stdout</span><span class="p">,</span> <span class="n">proc_status</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_launch_internal_loop</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rerun_le</span><span class="p">:</span>
                <span class="c1"># there was a problem with the license server</span>
                <span class="k">if</span> <span class="s2">&quot;LICENSE FAILURE&quot;</span> <span class="ow">in</span> <span class="n">stdout</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;License acquisition failure for eclipse.&quot;</span><span class="p">)</span>
                    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sleep_le</span><span class="p">)</span>
                    <span class="c1"># if is int, count down number of valid times to retry</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rerun_le</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">rerun_le</span> <span class="o">-=</span> <span class="mi">1</span>
                <span class="c1"># everything was ok</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">break</span>
            <span class="k">else</span><span class="p">:</span>  <span class="c1"># don&#39;t check for license errors</span>
                <span class="k">break</span>

        <span class="c1"># copy simulation terminal log and debug to save path if requested</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">log_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># copying debug file</span>
            <span class="n">log</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_path</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_name</span>
            <span class="n">log</span> <span class="o">=</span> <span class="n">log</span><span class="o">.</span><span class="n">with_suffix</span><span class="p">(</span><span class="s2">&quot;.DBG&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">log</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
                <span class="n">cp_to</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">log_path</span> <span class="o">/</span> <span class="s2">&quot;_&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">log</span><span class="o">.</span><span class="n">stem</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">])</span>
                <span class="n">cp_to</span> <span class="o">=</span> <span class="n">cp_to</span><span class="o">.</span><span class="n">with_suffix</span><span class="p">(</span><span class="s2">&quot;.DBG&quot;</span><span class="p">)</span>
                <span class="n">shutil</span><span class="o">.</span><span class="n">copyfile</span><span class="p">(</span><span class="n">log</span><span class="p">,</span> <span class="n">cp_to</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Coppied simulation log file.&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Could not find log file.&quot;</span><span class="p">)</span>

            <span class="c1"># writing out STDOUT</span>
            <span class="n">write_to</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">log_path</span> <span class="o">/</span> <span class="s2">&quot;_&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">log</span><span class="o">.</span><span class="n">stem</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">])</span>
            <span class="n">write_to</span> <span class="o">=</span> <span class="n">write_to</span><span class="o">.</span><span class="n">with_suffix</span><span class="p">(</span><span class="s2">&quot;.STDOUT&quot;</span><span class="p">)</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">write_to</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">stdout_log</span><span class="p">:</span>
                <span class="n">stdout_log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">stdout</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Wrote simulation STDOUT&quot;</span><span class="p">)</span>

        <span class="c1"># TODO - Save model ouputs if requested.</span>

        <span class="n">end_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span>
        <span class="k">if</span> <span class="n">proc_status</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;simulation completed in </span><span class="si">%s</span><span class="s2"> seconds&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">end_time</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">good_run</span>

    <span class="k">def</span> <span class="nf">cleanup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">retries</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">sleep</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Cleanup the working directory correctly.</span>

<span class="sd">        Args:</span>
<span class="sd">            retries (int, optional): [description]. Defaults to 4.</span>
<span class="sd">            sleep (int, optional): [description]. Defaults to 10.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">original</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;You cannot cleanup the original model.&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">can_delete</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">tries</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">while</span> <span class="ow">not</span> <span class="n">can_delete</span><span class="p">:</span>
                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">sleep</span><span class="p">)</span>
                <span class="n">tries</span> <span class="o">=</span> <span class="n">tries</span> <span class="o">+</span> <span class="mi">1</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">temp_dir</span><span class="o">.</span><span class="n">cleanup</span><span class="p">()</span>
                    <span class="n">can_delete</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">except</span> <span class="ne">OSError</span><span class="p">:</span>
                    <span class="c1"># can&#39;t delete just now</span>
                    <span class="k">if</span> <span class="n">tries</span> <span class="o">&gt;</span> <span class="n">retries</span><span class="p">:</span>
                        <span class="k">pass</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">










  <div class="doc doc-object doc-method">



<h4 id="optuna_hm.handlers._ecl_simh.ECLBaseHandler.__init__" class="doc doc-heading">
<code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_name</span><span class="p">,</span> <span class="n">model_path</span><span class="p">,</span> <span class="n">model_param</span><span class="p">,</span> <span class="n">application_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">rerun_license_errors</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">license_error_sleep</span><span class="o">=</span><span class="mi">600</span><span class="p">,</span> <span class="n">time_out</span><span class="o">=</span><span class="mi">900</span><span class="p">,</span> <span class="n">silent</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">original</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

</h4>

    <div class="doc doc-contents ">


<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>application_path</code></td>
        <td><code>str</code></td>
        <td><p>Path to simulation executable</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>model_name</code></td>
        <td><code>str</code></td>
        <td><p>The name of the ECLIPSE Model</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>model_path</code></td>
        <td><code>str</code></td>
        <td><p>The path to the ECLIPSE Model</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>model_param</code></td>
        <td><code>pandas.DataFrame</code></td>
        <td><p>The model parameters to update
the parameter key should be in the index of the DF.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>time_out</code></td>
        <td><code>int</code></td>
        <td><p>Defaults to 900 seconds. Time before cancelling subprocess simulation
run.</p></td>
        <td><code>900</code></td>
      </tr>
      <tr>
        <td><code>silent</code></td>
        <td><code>bool</code></td>
        <td><p>Defaults to True, set to False to print STDOUT from subprocess call.</p></td>
        <td><code>True</code></td>
      </tr>
      <tr>
        <td><code>original</code></td>
        <td><code>bool</code></td>
        <td><p>Is this the original model. If true changes to the model will not be
permitted.</p></td>
        <td><code>True</code></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>optuna_hm/handlers/_ecl_simh.py</code></summary>
          <div class="highlight"><span class="filename">Python</span><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">model_name</span><span class="p">,</span>
    <span class="n">model_path</span><span class="p">,</span>
    <span class="n">model_param</span><span class="p">,</span>
    <span class="n">application_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">rerun_license_errors</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">license_error_sleep</span><span class="o">=</span><span class="mi">600</span><span class="p">,</span>
    <span class="n">time_out</span><span class="o">=</span><span class="mi">900</span><span class="p">,</span>
    <span class="n">silent</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">original</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    Args:</span>
<span class="sd">        application_path (str): Path to simulation executable</span>
<span class="sd">        model_name (str): The name of the ECLIPSE Model</span>
<span class="sd">        model_path (str): The path to the ECLIPSE Model</span>
<span class="sd">        model_param (pandas.DataFrame): The model parameters to update</span>
<span class="sd">            the parameter key should be in the index of the DF.</span>
<span class="sd">        time_out (int): Defaults to 900 seconds. Time before cancelling subprocess simulation</span>
<span class="sd">            run.</span>
<span class="sd">        silent (bool): Defaults to True, set to False to print STDOUT from subprocess call.</span>
<span class="sd">        original (bool): Is this the original model. If true changes to the model will not be</span>
<span class="sd">            permitted.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">model_name</span> <span class="o">=</span> <span class="n">model_name</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">model_path</span> <span class="o">=</span> <span class="n">model_path</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">popt</span> <span class="o">=</span> <span class="n">model_param</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s2">&quot;ECLBaseHandler&quot;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">temp_dir</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">original</span> <span class="o">=</span> <span class="n">original</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">log_path</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="s2">&quot;00000000&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">rerun_le</span> <span class="o">=</span> <span class="n">rerun_license_errors</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">sleep_le</span> <span class="o">=</span> <span class="n">license_error_sleep</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">silent</span> <span class="o">=</span> <span class="n">silent</span>
    <span class="k">if</span> <span class="n">application_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_ecl</span><span class="p">(</span><span class="n">application_path</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">simexe</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">time_out</span> <span class="o">=</span> <span class="n">time_out</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h4 id="optuna_hm.handlers._ecl_simh.ECLBaseHandler.cleanup" class="doc doc-heading">
<code class="highlight language-python"><span class="n">cleanup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">retries</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">sleep</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span></code>


</h4>

    <div class="doc doc-contents ">

      <p>Cleanup the working directory correctly.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>retries</code></td>
        <td><code>int</code></td>
        <td><p>[description]. Defaults to 4.</p></td>
        <td><code>4</code></td>
      </tr>
      <tr>
        <td><code>sleep</code></td>
        <td><code>int</code></td>
        <td><p>[description]. Defaults to 10.</p></td>
        <td><code>10</code></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>optuna_hm/handlers/_ecl_simh.py</code></summary>
          <div class="highlight"><span class="filename">Python</span><pre><span></span><code><span class="k">def</span> <span class="nf">cleanup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">retries</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">sleep</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Cleanup the working directory correctly.</span>

<span class="sd">    Args:</span>
<span class="sd">        retries (int, optional): [description]. Defaults to 4.</span>
<span class="sd">        sleep (int, optional): [description]. Defaults to 10.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">original</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;You cannot cleanup the original model.&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">can_delete</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">tries</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">while</span> <span class="ow">not</span> <span class="n">can_delete</span><span class="p">:</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">sleep</span><span class="p">)</span>
            <span class="n">tries</span> <span class="o">=</span> <span class="n">tries</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">temp_dir</span><span class="o">.</span><span class="n">cleanup</span><span class="p">()</span>
                <span class="n">can_delete</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">except</span> <span class="ne">OSError</span><span class="p">:</span>
                <span class="c1"># can&#39;t delete just now</span>
                <span class="k">if</span> <span class="n">tries</span> <span class="o">&gt;</span> <span class="n">retries</span><span class="p">:</span>
                    <span class="k">pass</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h4 id="optuna_hm.handlers._ecl_simh.ECLBaseHandler.create_working_model" class="doc doc-heading">
<code class="highlight language-python"><span class="n">create_working_model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">working_dir</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">working_cwd</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>


</h4>

    <div class="doc doc-contents ">

      <p>Create a working copy of this simulator so it can be modified without destroying the original.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>working_dir</code></td>
        <td><code>str</code></td>
        <td><p>If None, a temporary directory in the working_cwd will be created.
Otherwise, specify a path to a preferred working directory. Defaults to None.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>working_cwd</code></td>
        <td><code>str</code></td>
        <td><p>If None, use the current working director. Otherwise will create temporary
space in working_cwd. Defaults to None. This can be useful when using distributed processing and
you want models to be evaluated on remote storage.</p></td>
        <td><code>None</code></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>(EclBaseHandler)</code></td>
      <td><p>A copy of simulator with a new working directory.</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>optuna_hm/handlers/_ecl_simh.py</code></summary>
          <div class="highlight"><span class="filename">Python</span><pre><span></span><code><span class="k">def</span> <span class="nf">create_working_model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">working_dir</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">working_cwd</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Create a working copy of this simulator so it can be modified without destroying the original.</span>

<span class="sd">    Args:</span>
<span class="sd">        working_dir (str): If None, a temporary directory in the working_cwd will be created.</span>
<span class="sd">            Otherwise, specify a path to a preferred working directory. Defaults to None.</span>
<span class="sd">        working_cwd (str): If None, use the current working director. Otherwise will create temporary</span>
<span class="sd">            space in working_cwd. Defaults to None. This can be useful when using distributed processing and</span>
<span class="sd">            you want models to be evaluated on remote storage.</span>

<span class="sd">    Returns:</span>
<span class="sd">        (EclBaseHandler): A copy of simulator with a new working directory.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># create working directory and simulator class</span>
    <span class="n">working_simulator</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">working_cwd</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">working_cwd</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">working_dir</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">temp_dir</span> <span class="o">=</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">TemporaryDirectory</span><span class="p">(</span>
            <span class="n">prefix</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;tempECL_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">model_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nb">dir</span><span class="o">=</span><span class="n">working_cwd</span>
        <span class="p">)</span>
        <span class="c1"># store temp dir with model so we don&#39;t lose it when exiting this namespace</span>
        <span class="n">working_simulator</span><span class="o">.</span><span class="n">temp_dir</span> <span class="o">=</span> <span class="n">temp_dir</span>
        <span class="n">working_dir</span> <span class="o">=</span> <span class="n">temp_dir</span><span class="o">.</span><span class="n">name</span>
        <span class="n">working_simulator</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">temp_dir</span><span class="o">.</span><span class="n">name</span><span class="p">[</span><span class="o">-</span><span class="mi">8</span><span class="p">:]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">temp_dir</span> <span class="o">=</span> <span class="n">working_dir</span>
        <span class="n">working_simulator</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">working_dir</span>
    <span class="n">working_path</span> <span class="o">=</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">working_dir</span><span class="p">)</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;working directory is </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">working_path</span><span class="p">)</span>
    <span class="n">working_simulator</span><span class="o">.</span><span class="n">set_model_path</span><span class="p">(</span><span class="n">working_path</span><span class="p">)</span>

    <span class="c1"># get the original model path</span>
    <span class="n">model_path</span> <span class="o">=</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model_path</span><span class="p">)</span>
    <span class="n">model_path_size</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span>
        <span class="n">f</span><span class="o">.</span><span class="n">stat</span><span class="p">()</span><span class="o">.</span><span class="n">st_size</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">model_path</span><span class="o">.</span><span class="n">iterdir</span><span class="p">()</span> <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">is_file</span><span class="p">()</span>
    <span class="p">)</span>

    <span class="c1"># copy files into working directory - THIS could be updated to give more info</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Copying model directory to </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">working_path</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">model_path</span><span class="o">.</span><span class="n">iterdir</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">is_file</span><span class="p">():</span>
            <span class="n">shutil</span><span class="o">.</span><span class="n">copy2</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">working_path</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">item</span><span class="o">.</span><span class="n">is_dir</span><span class="p">():</span>
            <span class="kn">from</span> <span class="nn">distutils.dir_util</span> <span class="kn">import</span> <span class="n">copy_tree</span>

            <span class="n">copy_tree</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">item</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="n">working_path</span> <span class="o">/</span> <span class="n">item</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Coppied model successfully&quot;</span><span class="p">)</span>
    <span class="n">working_simulator</span><span class="o">.</span><span class="n">original</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="c1"># working_simulator.id = temp_dir.name[-8:]</span>
    <span class="n">working_simulator</span><span class="o">.</span><span class="n">log_path</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">log_path</span><span class="p">)</span>

    <span class="n">copied</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">while</span> <span class="ow">not</span> <span class="n">copied</span><span class="p">:</span>
        <span class="n">working_path_size</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span>
            <span class="n">f</span><span class="o">.</span><span class="n">stat</span><span class="p">()</span><span class="o">.</span><span class="n">st_size</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">working_path</span><span class="o">.</span><span class="n">iterdir</span><span class="p">()</span> <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">is_file</span><span class="p">()</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">working_path_size</span> <span class="o">==</span> <span class="n">model_path_size</span><span class="p">:</span>
            <span class="n">copied</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
        <span class="c1"># print(working_path.name, working_path_size, model_path_size, copied)</span>

    <span class="k">return</span> <span class="n">working_simulator</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h4 id="optuna_hm.handlers._ecl_simh.ECLBaseHandler.launch" class="doc doc-heading">
<code class="highlight language-python"><span class="n">launch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">cmdargs</span><span class="p">,</span> <span class="o">**</span><span class="n">cmdkwargs</span><span class="p">)</span></code>


</h4>

    <div class="doc doc-contents ">

      <p>Launches an eclipse instance, run a simulation.</p>

        <details class="quote">
          <summary>Source code in <code>optuna_hm/handlers/_ecl_simh.py</code></summary>
          <div class="highlight"><span class="filename">Python</span><pre><span></span><code><span class="k">def</span> <span class="nf">launch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">cmdargs</span><span class="p">,</span> <span class="o">**</span><span class="n">cmdkwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Launches an eclipse instance, run a simulation.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">original</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">PermissionError</span><span class="p">(</span>
            <span class="s2">&quot;You must create a working copy of the model using&quot;</span>
            <span class="o">+</span> <span class="s2">&quot; create_working_model, changes to the original model are not permitted.&quot;</span>
        <span class="p">)</span>
    <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

    <span class="n">cmd</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">simexe</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">cmdargs</span><span class="p">:</span>
        <span class="n">cmd</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">cmdkw</span> <span class="ow">in</span> <span class="n">cmdkwargs</span><span class="p">:</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="n">cmd</span> <span class="o">+</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;-</span><span class="si">{</span><span class="n">cmdkw</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">cmdkwargs</span><span class="p">[</span><span class="n">cmdkw</span><span class="p">])]</span>

    <span class="nb">print</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>

    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">good_run</span><span class="p">,</span> <span class="n">stdout</span><span class="p">,</span> <span class="n">proc_status</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_launch_internal_loop</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rerun_le</span><span class="p">:</span>
            <span class="c1"># there was a problem with the license server</span>
            <span class="k">if</span> <span class="s2">&quot;LICENSE FAILURE&quot;</span> <span class="ow">in</span> <span class="n">stdout</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;License acquisition failure for eclipse.&quot;</span><span class="p">)</span>
                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sleep_le</span><span class="p">)</span>
                <span class="c1"># if is int, count down number of valid times to retry</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rerun_le</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">rerun_le</span> <span class="o">-=</span> <span class="mi">1</span>
            <span class="c1"># everything was ok</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">break</span>
        <span class="k">else</span><span class="p">:</span>  <span class="c1"># don&#39;t check for license errors</span>
            <span class="k">break</span>

    <span class="c1"># copy simulation terminal log and debug to save path if requested</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">log_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># copying debug file</span>
        <span class="n">log</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_path</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_name</span>
        <span class="n">log</span> <span class="o">=</span> <span class="n">log</span><span class="o">.</span><span class="n">with_suffix</span><span class="p">(</span><span class="s2">&quot;.DBG&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">log</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
            <span class="n">cp_to</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">log_path</span> <span class="o">/</span> <span class="s2">&quot;_&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">log</span><span class="o">.</span><span class="n">stem</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">])</span>
            <span class="n">cp_to</span> <span class="o">=</span> <span class="n">cp_to</span><span class="o">.</span><span class="n">with_suffix</span><span class="p">(</span><span class="s2">&quot;.DBG&quot;</span><span class="p">)</span>
            <span class="n">shutil</span><span class="o">.</span><span class="n">copyfile</span><span class="p">(</span><span class="n">log</span><span class="p">,</span> <span class="n">cp_to</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Coppied simulation log file.&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Could not find log file.&quot;</span><span class="p">)</span>

        <span class="c1"># writing out STDOUT</span>
        <span class="n">write_to</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">log_path</span> <span class="o">/</span> <span class="s2">&quot;_&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">log</span><span class="o">.</span><span class="n">stem</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">])</span>
        <span class="n">write_to</span> <span class="o">=</span> <span class="n">write_to</span><span class="o">.</span><span class="n">with_suffix</span><span class="p">(</span><span class="s2">&quot;.STDOUT&quot;</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">write_to</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">stdout_log</span><span class="p">:</span>
            <span class="n">stdout_log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">stdout</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Wrote simulation STDOUT&quot;</span><span class="p">)</span>

    <span class="c1"># TODO - Save model ouputs if requested.</span>

    <span class="n">end_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span>
    <span class="k">if</span> <span class="n">proc_status</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;simulation completed in </span><span class="si">%s</span><span class="s2"> seconds&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">end_time</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">good_run</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h4 id="optuna_hm.handlers._ecl_simh.ECLBaseHandler.retrieve_ecl_prop" class="doc doc-heading">
<code class="highlight language-python"><span class="n">retrieve_ecl_prop</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>


</h4>

    <div class="doc doc-contents ">

      <p>Retrieve objective parameter values</p>

<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>(list)</code></td>
      <td><p>list of parameters corresponding to flags</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>optuna_hm/handlers/_ecl_simh.py</code></summary>
          <div class="highlight"><span class="filename">Python</span><pre><span></span><code><span class="k">def</span> <span class="nf">retrieve_ecl_prop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Retrieve objective parameter values</span>

<span class="sd">    Returns:</span>
<span class="sd">        (list): list of parameters corresponding to flags</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">values</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">flags</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">popt</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span>
    <span class="n">flags</span> <span class="o">=</span> <span class="p">[</span><span class="n">flg</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="k">for</span> <span class="n">flg</span> <span class="ow">in</span> <span class="n">flags</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">file_name</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">popt</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;FILE&quot;</span><span class="p">):</span>
        <span class="n">filepath</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_path</span> <span class="o">/</span> <span class="n">file_name</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fdat</span><span class="p">:</span>
            <span class="n">lines</span> <span class="o">=</span> <span class="n">fdat</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">flag</span> <span class="ow">in</span> <span class="n">flags</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">flag</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                    <span class="n">split</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                    <span class="n">find</span> <span class="o">=</span> <span class="n">split</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">flag</span><span class="p">)</span>
                    <span class="n">ind</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">split</span><span class="p">[</span><span class="n">find</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span>
                    <span class="n">values</span><span class="p">[</span><span class="n">flag</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">split</span><span class="p">[</span><span class="n">ind</span><span class="p">])</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">values</span><span class="p">[</span><span class="n">file_name</span><span class="p">]</span> <span class="k">for</span> <span class="n">file_name</span> <span class="ow">in</span> <span class="n">flags</span><span class="p">]</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h4 id="optuna_hm.handlers._ecl_simh.ECLBaseHandler.save_model" class="doc doc-heading">
<code class="highlight language-python"><span class="n">save_model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>


</h4>

    <div class="doc doc-contents ">

      <p>Save the whole model folder to a new path.</p>

        <details class="quote">
          <summary>Source code in <code>optuna_hm/handlers/_ecl_simh.py</code></summary>
          <div class="highlight"><span class="filename">Python</span><pre><span></span><code><span class="k">def</span> <span class="nf">save_model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Save the whole model folder to a new path.</span>

<span class="sd">    Args:</span>
<span class="sd">        path (pathlike)</span>
<span class="sd">        prefix (str, optional)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">new_folder_name</span> <span class="o">=</span> <span class="s2">&quot;_&quot;</span><span class="o">.</span><span class="n">join</span>

    <span class="k">if</span> <span class="n">prefix</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">new_folder_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">prefix</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">model_name</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">new_folder_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_name</span>

    <span class="n">save_path</span> <span class="o">=</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="o">/</span> <span class="n">new_folder_name</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">save_path</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
        <span class="n">save_path</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_path</span><span class="o">.</span><span class="n">iterdir</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">is_file</span><span class="p">():</span>
            <span class="n">shutil</span><span class="o">.</span><span class="n">copy2</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">save_path</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">item</span><span class="o">.</span><span class="n">is_dir</span><span class="p">():</span>
            <span class="kn">from</span> <span class="nn">distutils.dir_util</span> <span class="kn">import</span> <span class="n">copy_tree</span>

            <span class="n">copy_tree</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">item</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="n">save_path</span> <span class="o">/</span> <span class="n">item</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Saved model successfully to </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">save_path</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h4 id="optuna_hm.handlers._ecl_simh.ECLBaseHandler.save_model_outputs" class="doc doc-heading">
<code class="highlight language-python"><span class="n">save_model_outputs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">files</span><span class="p">,</span> <span class="n">outputs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>


</h4>

    <div class="doc doc-contents ">

      <p>Specify model outputs to save for debugging or further review.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>files</code></td>
        <td><code>list</code></td>
        <td><p>List of files to save.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>outputs</code></td>
        <td><code>list</code></td>
        <td><p>List of files to save.</p></td>
        <td><code>None</code></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>optuna_hm/handlers/_ecl_simh.py</code></summary>
          <div class="highlight"><span class="filename">Python</span><pre><span></span><code><span class="k">def</span> <span class="nf">save_model_outputs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">files</span><span class="p">,</span> <span class="n">outputs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Specify model outputs to save for debugging or further review.</span>

<span class="sd">    Args:</span>
<span class="sd">        files (list): List of files to save.</span>
<span class="sd">        outputs (list): List of files to save.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">prefix</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">prefix</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

    <span class="n">path</span> <span class="o">=</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
        <span class="n">path</span><span class="o">.</span><span class="n">mkdir</span><span class="p">()</span>

    <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
        <span class="n">file</span> <span class="o">=</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
        <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">id</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="n">file</span><span class="o">.</span><span class="n">name</span>
        <span class="n">shutil</span><span class="o">.</span><span class="n">copy2</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model_path</span> <span class="o">/</span> <span class="n">file</span><span class="p">,</span> <span class="n">path</span> <span class="o">/</span> <span class="n">name</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h4 id="optuna_hm.handlers._ecl_simh.ECLBaseHandler.set_ecl" class="doc doc-heading">
<code class="highlight language-python"><span class="n">set_ecl</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">application_path</span><span class="p">)</span></code>


</h4>

    <div class="doc doc-contents ">

      <p>Set the simulator application path</p>

        <details class="quote">
          <summary>Source code in <code>optuna_hm/handlers/_ecl_simh.py</code></summary>
          <div class="highlight"><span class="filename">Python</span><pre><span></span><code><span class="k">def</span> <span class="nf">set_ecl</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">application_path</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Set the simulator application path&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">simexe</span> <span class="o">=</span> <span class="n">application_path</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">simexe</span><span class="p">)</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Cannot find simulator executable </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">simexe</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h4 id="optuna_hm.handlers._ecl_simh.ECLBaseHandler.set_model_path" class="doc doc-heading">
<code class="highlight language-python"><span class="n">set_model_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">newpath</span><span class="p">)</span></code>


</h4>

    <div class="doc doc-contents ">

      <p>Set the path to the model</p>

        <details class="quote">
          <summary>Source code in <code>optuna_hm/handlers/_ecl_simh.py</code></summary>
          <div class="highlight"><span class="filename">Python</span><pre><span></span><code><span class="k">def</span> <span class="nf">set_model_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">newpath</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Set the path to the model&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">model_path</span> <span class="o">=</span> <span class="n">newpath</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h4 id="optuna_hm.handlers._ecl_simh.ECLBaseHandler.set_save_model_outputs" class="doc doc-heading">
<code class="highlight language-python"><span class="n">set_save_model_outputs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">outputs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>


</h4>

    <div class="doc doc-contents ">

      <p>Specify model outputs to save for debugging or further review.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>outputs</code></td>
        <td><code>list</code></td>
        <td><p>List of files to save.</p></td>
        <td><code>None</code></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>optuna_hm/handlers/_ecl_simh.py</code></summary>
          <div class="highlight"><span class="filename">Python</span><pre><span></span><code><span class="k">def</span> <span class="nf">set_save_model_outputs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">outputs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Specify model outputs to save for debugging or further review.</span>

<span class="sd">    Args:</span>
<span class="sd">        outputs (list): List of files to save.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">prefix</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">prefix</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

    <span class="k">if</span> <span class="n">outputs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">shutil</span><span class="o">.</span><span class="n">copytree</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model_path</span><span class="p">,</span> <span class="n">prefix</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h4 id="optuna_hm.handlers._ecl_simh.ECLBaseHandler.set_save_sim_logs" class="doc doc-heading">
<code class="highlight language-python"><span class="n">set_save_sim_logs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span></code>


</h4>

    <div class="doc doc-contents ">

      <p>Set location to save model logs. For Eclipse these are the DBG files created by the run.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>path</code></td>
        <td><code>str</code></td>
        <td><p>The path to save the logs to. If directory doesn't exist it will be created.</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>optuna_hm/handlers/_ecl_simh.py</code></summary>
          <div class="highlight"><span class="filename">Python</span><pre><span></span><code><span class="k">def</span> <span class="nf">set_save_sim_logs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Set location to save model logs. For Eclipse these are the DBG files created by the run.</span>
<span class="sd">    Args:</span>
<span class="sd">        path (str): The path to save the logs to. If directory doesn&#39;t exist it will be created.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">path</span> <span class="o">=</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
        <span class="n">path</span><span class="o">.</span><span class="n">mkdir</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">log_path</span> <span class="o">=</span> <span class="n">path</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Simulation logs will be saved to: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">path</span><span class="p">))</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h4 id="optuna_hm.handlers._ecl_simh.ECLBaseHandler.update_ecl_prop" class="doc doc-heading">
<code class="highlight language-python"><span class="n">update_ecl_prop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prop</span><span class="p">)</span></code>


</h4>

    <div class="doc doc-contents ">

      <p>Creates appropriate property values from random floats in range 0-1</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>prop</code></td>
        <td><code>dict</code></td>
        <td><p>list or random floats in range (0-1) supplied by population update</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>optuna_hm/handlers/_ecl_simh.py</code></summary>
          <div class="highlight"><span class="filename">Python</span><pre><span></span><code><span class="k">def</span> <span class="nf">update_ecl_prop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prop</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Creates appropriate property values from random floats in range 0-1</span>

<span class="sd">    Args:</span>
<span class="sd">        prop (dict): list or random floats in range (0-1) supplied by population update</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># normalise prop random floats (0-1) to property ranges</span>
    <span class="c1"># this replaces unnormalise</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">original</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">PermissionError</span><span class="p">(</span>
            <span class="s2">&quot;You must create a working copy of the model using&quot;</span>
            <span class="o">+</span> <span class="s2">&quot; create_working_model, changes to the original model are not permitted.&quot;</span>
        <span class="p">)</span>


    <span class="bp">self</span><span class="o">.</span><span class="n">popt</span><span class="p">[</span><span class="s2">&quot;new_values&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">popt</span><span class="p">[</span><span class="s2">&quot;NAME&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">prop</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">file_name</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">popt</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;FILE&quot;</span><span class="p">):</span>
        <span class="n">filepath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model_path</span><span class="p">,</span> <span class="n">file_name</span><span class="p">)</span>
        <span class="n">updatefile</span> <span class="o">=</span> <span class="n">ECLDatHandler</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span>
        <span class="c1"># change this to write actual update values</span>
        <span class="n">updatefile</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">val</span><span class="p">[[</span><span class="s2">&quot;NAME&quot;</span><span class="p">,</span> <span class="s2">&quot;new_values&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;NAME&quot;</span><span class="p">))</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">popt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">popt</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="s2">&quot;new_values&quot;</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>



  <div class="doc doc-object doc-class">



<h3 id="optuna_hm.handlers._ecl_simh.ECLDatHandler" class="doc doc-heading">
        <code>
ECLDatHandler        </code>



</h3>

    <div class="doc doc-contents ">

      <p>Class to update simulation properties based on a comment flag</p>

        <details class="quote">
          <summary>Source code in <code>optuna_hm/handlers/_ecl_simh.py</code></summary>
          <div class="highlight"><span class="filename">Python</span><pre><span></span><code><span class="k">class</span> <span class="nc">ECLDatHandler</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Class to update simulation properties based on a comment flag</span>


<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;&quot;&quot;&quot;</span>
        <span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">fdat</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span>
            <span class="n">fdat</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="n">filename</span>
        <span class="k">except</span> <span class="ne">FileNotFoundError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;No such ECL DAT file: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
            <span class="k">raise</span> <span class="nb">type</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_values</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Replace objective parameter values with *new_values*</span>
<span class="sd">        in a ECL .DAT file using pre-defined *flags*</span>

<span class="sd">        Args:</span>
<span class="sd">            flags (list): List of parameter flags for new_values</span>
<span class="sd">            new_values (list): List of values to replace where flags</span>

<span class="sd">        Example:</span>

<span class="sd">            ECL Data File contains EQUALS record like this:</span>

<span class="sd">            EQUALS</span>
<span class="sd">                PERMX</span>
<span class="sd">            -999 1 11 1 11 1  1 / PERMXL1 0 PERMXL2 2</span>

<span class="sd">            The flag PERMXL1 follows the &#39;/&#39; terminator and fills an ECL control file</span>
<span class="sd">            comment. The integer imediately following the flag tells update which parameter</span>
<span class="sd">            on the line will replaced starting from 0. Here -999 will be replaced.</span>

<span class="sd">            Multiple flags can be used per line such as with PERMXL2 where the first 11 at</span>
<span class="sd">            position 2 will be replaced.</span>

<span class="sd">            If the last value before the &#39;/&#39; terminator is the targeted ensure that there is</span>
<span class="sd">            at least one space &#39; &#39; between it the &#39;/&#39; terminator.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># check length of flgas and new values - should be the same</span>

        <span class="c1"># load entire file - it is difficult to edit in-place</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fdat</span><span class="p">:</span>
            <span class="n">lines</span> <span class="o">=</span> <span class="n">fdat</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
        <span class="c1"># perform edits</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">lines</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">line</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;--&quot;</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">flag</span> <span class="ow">in</span> <span class="n">new_values</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;\s</span><span class="si">{</span><span class="n">flag</span><span class="si">}</span><span class="s2">\s&quot;</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                            <span class="n">split</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                            <span class="n">find</span> <span class="o">=</span> <span class="n">split</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">flag</span><span class="p">)</span>
                            <span class="n">ind</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">split</span><span class="p">[</span><span class="n">find</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span>
                            <span class="n">split</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{:.4E}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">new_values</span><span class="p">[</span><span class="s2">&quot;new_values&quot;</span><span class="p">][</span><span class="n">flag</span><span class="p">])</span>
                            <span class="n">line</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">split</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
                        <span class="n">lines</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">line</span>
                <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error updating simulation file.&quot;</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Problem file: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="si">}</span><span class="s2">, Problem flag: </span><span class="si">{</span><span class="n">flag</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Problem line: </span><span class="si">{</span><span class="n">line</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="k">raise</span> <span class="ne">SystemExit</span>
        <span class="c1"># write back file</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fdat</span><span class="p">:</span>
            <span class="n">fdat</span><span class="o">.</span><span class="n">writelines</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">










  <div class="doc doc-object doc-method">



<h4 id="optuna_hm.handlers._ecl_simh.ECLDatHandler.update" class="doc doc-heading">
<code class="highlight language-python"><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_values</span><span class="p">)</span></code>


</h4>

    <div class="doc doc-contents ">

      <p>Replace objective parameter values with <em>new_values</em>
in a ECL .DAT file using pre-defined <em>flags</em></p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>flags</code></td>
        <td><code>list</code></td>
        <td><p>List of parameter flags for new_values</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>new_values</code></td>
        <td><code>list</code></td>
        <td><p>List of values to replace where flags</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
<p><strong>Examples:</strong></p>
    <p>ECL Data File contains EQUALS record like this:</p>
<p>EQUALS
    PERMX
-999 1 11 1 11 1  1 / PERMXL1 0 PERMXL2 2</p>
<p>The flag PERMXL1 follows the '/' terminator and fills an ECL control file
comment. The integer imediately following the flag tells update which parameter
on the line will replaced starting from 0. Here -999 will be replaced.</p>
<p>Multiple flags can be used per line such as with PERMXL2 where the first 11 at
position 2 will be replaced.</p>
<p>If the last value before the '/' terminator is the targeted ensure that there is
at least one space ' ' between it the '/' terminator.</p>

        <details class="quote">
          <summary>Source code in <code>optuna_hm/handlers/_ecl_simh.py</code></summary>
          <div class="highlight"><span class="filename">Python</span><pre><span></span><code><span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_values</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Replace objective parameter values with *new_values*</span>
<span class="sd">    in a ECL .DAT file using pre-defined *flags*</span>

<span class="sd">    Args:</span>
<span class="sd">        flags (list): List of parameter flags for new_values</span>
<span class="sd">        new_values (list): List of values to replace where flags</span>

<span class="sd">    Example:</span>

<span class="sd">        ECL Data File contains EQUALS record like this:</span>

<span class="sd">        EQUALS</span>
<span class="sd">            PERMX</span>
<span class="sd">        -999 1 11 1 11 1  1 / PERMXL1 0 PERMXL2 2</span>

<span class="sd">        The flag PERMXL1 follows the &#39;/&#39; terminator and fills an ECL control file</span>
<span class="sd">        comment. The integer imediately following the flag tells update which parameter</span>
<span class="sd">        on the line will replaced starting from 0. Here -999 will be replaced.</span>

<span class="sd">        Multiple flags can be used per line such as with PERMXL2 where the first 11 at</span>
<span class="sd">        position 2 will be replaced.</span>

<span class="sd">        If the last value before the &#39;/&#39; terminator is the targeted ensure that there is</span>
<span class="sd">        at least one space &#39; &#39; between it the &#39;/&#39; terminator.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># check length of flgas and new values - should be the same</span>

    <span class="c1"># load entire file - it is difficult to edit in-place</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fdat</span><span class="p">:</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="n">fdat</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
    <span class="c1"># perform edits</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">lines</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">line</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;--&quot;</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">flag</span> <span class="ow">in</span> <span class="n">new_values</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;\s</span><span class="si">{</span><span class="n">flag</span><span class="si">}</span><span class="s2">\s&quot;</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">split</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                        <span class="n">find</span> <span class="o">=</span> <span class="n">split</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">flag</span><span class="p">)</span>
                        <span class="n">ind</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">split</span><span class="p">[</span><span class="n">find</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span>
                        <span class="n">split</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{:.4E}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">new_values</span><span class="p">[</span><span class="s2">&quot;new_values&quot;</span><span class="p">][</span><span class="n">flag</span><span class="p">])</span>
                        <span class="n">line</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">split</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="n">lines</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">line</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error updating simulation file.&quot;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Problem file: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="si">}</span><span class="s2">, Problem flag: </span><span class="si">{</span><span class="n">flag</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Problem line: </span><span class="si">{</span><span class="n">line</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">raise</span> <span class="ne">SystemExit</span>
    <span class="c1"># write back file</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fdat</span><span class="p">:</span>
        <span class="n">fdat</span><span class="o">.</span><span class="n">writelines</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>



  <div class="doc doc-object doc-class">



<h3 id="optuna_hm.handlers._ecl_simh.ECLFakeHandler" class="doc doc-heading">
        <code>
ECLFakeHandler            (<a class="autorefs autorefs-internal" title="optuna_hm.handlers._ecl_simh.ECLBaseHandler" href="#optuna_hm.handlers._ecl_simh.ECLBaseHandler">ECLBaseHandler</a>)
        </code>



</h3>

    <div class="doc doc-contents ">

      <p>Create Fake RSM files to run tests without ECLIPSE</p>

        <details class="quote">
          <summary>Source code in <code>optuna_hm/handlers/_ecl_simh.py</code></summary>
          <div class="highlight"><span class="filename">Python</span><pre><span></span><code><span class="k">class</span> <span class="nc">ECLFakeHandler</span><span class="p">(</span><span class="n">ECLBaseHandler</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Create Fake RSM files to run tests without ECLIPSE&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">reference</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Constructor</span>

<span class="sd">        Args:</span>
<span class="sd">            target (str): column name from handler.popt to</span>
<span class="sd">            reference (pandas.DataFrame): Dataframe containing RSM results of true solution.</span>
<span class="sd">            *args: Arguments for ECLBaseHandler</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s2">&quot;ECLFakeHandler&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">target</span> <span class="o">=</span> <span class="n">target</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reference</span> <span class="o">=</span> <span class="n">reference</span>

    <span class="k">def</span> <span class="nf">__deepcopy__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">memo</span><span class="p">):</span>
        <span class="c1"># create a copy but not logger</span>
        <span class="k">return</span> <span class="n">ECLFakeHandler</span><span class="p">(</span>
            <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="p">,</span> <span class="n">memo</span><span class="p">),</span>
            <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reference</span><span class="p">,</span> <span class="n">memo</span><span class="p">),</span>
            <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model_name</span><span class="p">,</span> <span class="n">memo</span><span class="p">),</span>
            <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model_path</span><span class="p">,</span> <span class="n">memo</span><span class="p">),</span>
            <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">popt</span><span class="p">,</span> <span class="n">memo</span><span class="p">),</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">clean_results</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">modelpath</span><span class="p">,</span> <span class="n">model</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Remove previous results&quot;&quot;&quot;</span>
        <span class="n">result_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">modelpath</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="s2">&quot;.RSM&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">result_file</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">result_file</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;cleaning previous results&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">write_rsm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filepath</span><span class="p">,</span> <span class="n">rsm_well</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Write out a fake RSM file</span>

<span class="sd">        Args:</span>
<span class="sd">            filepath (str): The filepath for the RSM File</span>
<span class="sd">            rsm_well (pandas.DataFrame):</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">rsmf</span><span class="p">:</span>
            <span class="n">rsmf</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">rsmf</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">SUMMARY OF RUN GENERATED BY ECLFakeHandler</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">header</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">rsm_well</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                <span class="n">header</span> <span class="o">+=</span> <span class="p">[</span><span class="n">col</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\t\t\t</span><span class="s2">&quot;</span><span class="p">]</span>
            <span class="n">header</span> <span class="o">+=</span> <span class="p">[</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">4</span>
            <span class="n">rsmf</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">header</span><span class="p">))</span>
            <span class="n">ncol</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">rsm_well</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
            <span class="n">data_template</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="si">{:&gt;8g}</span><span class="se">\t\t</span><span class="s2">&quot;</span> <span class="o">*</span> <span class="n">ncol</span>
            <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">rsm_well</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
                <span class="n">rsmf</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">data_template</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">val</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">launch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">cmdargs</span><span class="p">,</span> <span class="o">**</span><span class="n">cmdkwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Launch the simulator&quot;&quot;&quot;</span>
        <span class="n">param</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">r_</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">retrieve_ecl_prop</span><span class="p">()]</span>
        <span class="n">misfit</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">numpy</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span>
                <span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">param</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">popt</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="p">]</span><span class="o">.</span><span class="n">values</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>
            <span class="p">)</span>
            <span class="o">/</span> <span class="n">param</span><span class="o">.</span><span class="n">size</span>
        <span class="p">)</span>
        <span class="n">scalar</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">misfit</span>
        <span class="n">rsm_well</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
        <span class="n">rsm_well</span><span class="p">[</span><span class="s2">&quot;TIME&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reference</span><span class="p">[</span><span class="s2">&quot;TIME&quot;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">reference</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="s2">&quot;TIME&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="n">rsm_well</span><span class="p">[</span><span class="n">col</span> <span class="o">+</span> <span class="s2">&quot;H&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reference</span><span class="p">[</span><span class="n">col</span><span class="p">]</span>
            <span class="n">rsm_well</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reference</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">/</span> <span class="n">scalar</span>

        <span class="n">filepath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model_path</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_name</span> <span class="o">+</span> <span class="s2">&quot;.RSM&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">write_rsm</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="n">rsm_well</span><span class="p">)</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">










  <div class="doc doc-object doc-method">



<h4 id="optuna_hm.handlers._ecl_simh.ECLFakeHandler.__init__" class="doc doc-heading">
<code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">reference</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

</h4>

    <div class="doc doc-contents ">

      <p>Constructor</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>target</code></td>
        <td><code>str</code></td>
        <td><p>column name from handler.popt to</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>reference</code></td>
        <td><code>pandas.DataFrame</code></td>
        <td><p>Dataframe containing RSM results of true solution.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>*args</code></td>
        <td></td>
        <td><p>Arguments for ECLBaseHandler</p></td>
        <td><code>()</code></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>optuna_hm/handlers/_ecl_simh.py</code></summary>
          <div class="highlight"><span class="filename">Python</span><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">reference</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Constructor</span>

<span class="sd">    Args:</span>
<span class="sd">        target (str): column name from handler.popt to</span>
<span class="sd">        reference (pandas.DataFrame): Dataframe containing RSM results of true solution.</span>
<span class="sd">        *args: Arguments for ECLBaseHandler</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s2">&quot;ECLFakeHandler&quot;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">target</span> <span class="o">=</span> <span class="n">target</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">reference</span> <span class="o">=</span> <span class="n">reference</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h4 id="optuna_hm.handlers._ecl_simh.ECLFakeHandler.clean_results" class="doc doc-heading">
<code class="highlight language-python"><span class="n">clean_results</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">modelpath</span><span class="p">,</span> <span class="n">model</span><span class="p">)</span></code>


</h4>

    <div class="doc doc-contents ">

      <p>Remove previous results</p>

        <details class="quote">
          <summary>Source code in <code>optuna_hm/handlers/_ecl_simh.py</code></summary>
          <div class="highlight"><span class="filename">Python</span><pre><span></span><code><span class="k">def</span> <span class="nf">clean_results</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">modelpath</span><span class="p">,</span> <span class="n">model</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Remove previous results&quot;&quot;&quot;</span>
    <span class="n">result_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">modelpath</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="s2">&quot;.RSM&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">result_file</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">result_file</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;cleaning previous results&quot;</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h4 id="optuna_hm.handlers._ecl_simh.ECLFakeHandler.launch" class="doc doc-heading">
<code class="highlight language-python"><span class="n">launch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">cmdargs</span><span class="p">,</span> <span class="o">**</span><span class="n">cmdkwargs</span><span class="p">)</span></code>


</h4>

    <div class="doc doc-contents ">

      <p>Launch the simulator</p>

        <details class="quote">
          <summary>Source code in <code>optuna_hm/handlers/_ecl_simh.py</code></summary>
          <div class="highlight"><span class="filename">Python</span><pre><span></span><code><span class="k">def</span> <span class="nf">launch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">cmdargs</span><span class="p">,</span> <span class="o">**</span><span class="n">cmdkwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Launch the simulator&quot;&quot;&quot;</span>
    <span class="n">param</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">r_</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">retrieve_ecl_prop</span><span class="p">()]</span>
    <span class="n">misfit</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">numpy</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span>
            <span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">param</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">popt</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="p">]</span><span class="o">.</span><span class="n">values</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>
        <span class="p">)</span>
        <span class="o">/</span> <span class="n">param</span><span class="o">.</span><span class="n">size</span>
    <span class="p">)</span>
    <span class="n">scalar</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">misfit</span>
    <span class="n">rsm_well</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
    <span class="n">rsm_well</span><span class="p">[</span><span class="s2">&quot;TIME&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reference</span><span class="p">[</span><span class="s2">&quot;TIME&quot;</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">reference</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="s2">&quot;TIME&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="n">rsm_well</span><span class="p">[</span><span class="n">col</span> <span class="o">+</span> <span class="s2">&quot;H&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reference</span><span class="p">[</span><span class="n">col</span><span class="p">]</span>
        <span class="n">rsm_well</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reference</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">/</span> <span class="n">scalar</span>

    <span class="n">filepath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model_path</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_name</span> <span class="o">+</span> <span class="s2">&quot;.RSM&quot;</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">write_rsm</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="n">rsm_well</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h4 id="optuna_hm.handlers._ecl_simh.ECLFakeHandler.write_rsm" class="doc doc-heading">
<code class="highlight language-python"><span class="n">write_rsm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filepath</span><span class="p">,</span> <span class="n">rsm_well</span><span class="p">)</span></code>


</h4>

    <div class="doc doc-contents ">

      <p>Write out a fake RSM file</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>filepath</code></td>
        <td><code>str</code></td>
        <td><p>The filepath for the RSM File</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>rsm_well</code></td>
        <td><code>pandas.DataFrame</code></td>
        <td></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>optuna_hm/handlers/_ecl_simh.py</code></summary>
          <div class="highlight"><span class="filename">Python</span><pre><span></span><code><span class="k">def</span> <span class="nf">write_rsm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filepath</span><span class="p">,</span> <span class="n">rsm_well</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Write out a fake RSM file</span>

<span class="sd">    Args:</span>
<span class="sd">        filepath (str): The filepath for the RSM File</span>
<span class="sd">        rsm_well (pandas.DataFrame):</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">rsmf</span><span class="p">:</span>
        <span class="n">rsmf</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">rsmf</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">SUMMARY OF RUN GENERATED BY ECLFakeHandler</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">header</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">rsm_well</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="n">header</span> <span class="o">+=</span> <span class="p">[</span><span class="n">col</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\t\t\t</span><span class="s2">&quot;</span><span class="p">]</span>
        <span class="n">header</span> <span class="o">+=</span> <span class="p">[</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">4</span>
        <span class="n">rsmf</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">header</span><span class="p">))</span>
        <span class="n">ncol</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">rsm_well</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
        <span class="n">data_template</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="si">{:&gt;8g}</span><span class="se">\t\t</span><span class="s2">&quot;</span> <span class="o">*</span> <span class="n">ncol</span>
        <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">rsm_well</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
            <span class="n">rsmf</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">data_template</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">val</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>







  </div>

    </div>

  </div>



  <div class="doc doc-object doc-module">


    <div class="doc doc-contents first">

      <p>A compilation of common evaluation functions used for eclipse optimisation
projects.</p>
<div class="admonition author">
<p class="admonition-title">Author</p>
<p>Tony Hallam 2020</p>
</div>



  <div class="doc doc-children">







  <div class="doc doc-object doc-class">



<h3 id="optuna_hm.handlers._ecl_eval.Error" class="doc doc-heading">
        <code>
Error            (<span title="Exception">Exception</span>)
        </code>



</h3>

    <div class="doc doc-contents ">

      <p>Base class for other exceptions</p>

        <details class="quote">
          <summary>Source code in <code>optuna_hm/handlers/_ecl_eval.py</code></summary>
          <div class="highlight"><span class="filename">Python</span><pre><span></span><code><span class="k">class</span> <span class="nc">Error</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Base class for other exceptions&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">message</span> <span class="o">=</span> <span class="n">message</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">












  </div>

    </div>

  </div>




  <div class="doc doc-object doc-class">



<h3 id="optuna_hm.handlers._ecl_eval.SimulationRunError" class="doc doc-heading">
        <code>
SimulationRunError            (<a class="autorefs autorefs-internal" title="optuna_hm.handlers._ecl_eval.Error" href="#optuna_hm.handlers._ecl_eval.Error">Error</a>)
        </code>



</h3>

    <div class="doc doc-contents ">

      <p>Raised when the input value is too small</p>

        <details class="quote">
          <summary>Source code in <code>optuna_hm/handlers/_ecl_eval.py</code></summary>
          <div class="highlight"><span class="filename">Python</span><pre><span></span><code><span class="k">class</span> <span class="nc">SimulationRunError</span><span class="p">(</span><span class="n">Error</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Raised when the input value is too small&quot;&quot;&quot;</span>

    <span class="k">pass</span>
</code></pre></div>
        </details>


    </div>

  </div>




  <div class="doc doc-object doc-function">



<h3 id="optuna_hm.handlers._ecl_eval.evaluate_eclipse_model" class="doc doc-heading">
<code class="highlight language-python"><span class="n">evaluate_eclipse_model</span><span class="p">(</span><span class="n">simulator</span><span class="p">,</span> <span class="n">results_dir</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">save_model_run</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">save_summary_results</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">save_properties_results</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">save_model_files</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">sleep</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">working_cwd</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">run_sim</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">update_prop</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">summary_results_kwargs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">properties_results_kwargs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>


</h3>

    <div class="doc doc-contents ">

      <p>Evaluate an eclipse model.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>simulator</code></td>
        <td><code>mophim.eclipse.EclBaseHandler</code></td>
        <td><p>The initialised simulator class object
which can be derived from EclBaseHandler</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>results_dir</code></td>
        <td><code>str, pathlib.Path</code></td>
        <td><p>A directory, the directory must exist.</p></td>
        <td><code>None</code></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>optuna_hm/handlers/_ecl_eval.py</code></summary>
          <div class="highlight"><span class="filename">Python</span><pre><span></span><code><span class="k">def</span> <span class="nf">evaluate_eclipse_model</span><span class="p">(</span>
    <span class="n">simulator</span><span class="p">,</span>
    <span class="n">results_dir</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">save_model_run</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">save_summary_results</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">save_properties_results</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">save_model_files</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">sleep</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
    <span class="n">working_cwd</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">run_sim</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">update_prop</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">summary_results_kwargs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">properties_results_kwargs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
<span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Evaluate an eclipse model.</span>

<span class="sd">    Args:</span>
<span class="sd">        simulator (mophim.eclipse.EclBaseHandler): The initialised simulator class object</span>
<span class="sd">            which can be derived from EclBaseHandler</span>
<span class="sd">        results_dir (str, pathlib.Path): A directory, the directory must exist.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">simulator</span><span class="p">,</span> <span class="n">ECLBaseHandler</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;simulator argument must be of class </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">ECLBaseHandler</span><span class="p">)</span><span class="si">}</span><span class="s2">, got </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">simulator</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>

    <span class="k">if</span> <span class="n">results_dir</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">results_dir</span> <span class="o">=</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">absolute</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">results_dir</span> <span class="o">=</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">results_dir</span><span class="p">)</span><span class="o">.</span><span class="n">absolute</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">results_dir</span><span class="o">.</span><span class="n">is_dir</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;results_dir must be directory and exist </span><span class="si">{</span><span class="n">results_dir</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">results</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;results&quot;</span><span class="p">]</span>
    <span class="n">optimiser</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="s2">&quot;sampler&quot;</span><span class="p">]</span>
    <span class="n">evaluation</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="s2">&quot;trial_number&quot;</span><span class="p">]</span>

    <span class="c1"># create working sim</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Starting </span><span class="si">{</span><span class="n">optimiser</span><span class="si">}</span><span class="s2"> trial number </span><span class="si">{</span><span class="n">evaluation</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">working_simulator</span> <span class="o">=</span> <span class="n">simulator</span><span class="o">.</span><span class="n">create_working_model</span><span class="p">(</span><span class="n">working_cwd</span><span class="o">=</span><span class="n">working_cwd</span><span class="p">)</span>

    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">sleep</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">update_prop</span><span class="p">:</span>
        <span class="n">working_simulator</span><span class="o">.</span><span class="n">update_ecl_prop</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="s2">&quot;p&quot;</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">run_sim</span><span class="p">:</span>
        <span class="n">working_simulator</span><span class="o">.</span><span class="n">launch</span><span class="p">()</span>

    <span class="c1"># Wait for simulation finalisation and cleanup</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">sleep</span><span class="p">)</span>

    <span class="c1"># Save model files if requested</span>
    <span class="k">if</span> <span class="n">save_model_files</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">model_files_save_path</span> <span class="o">=</span> <span class="n">results_dir</span> <span class="o">/</span> <span class="s2">&quot;model_files&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">model_files_save_path</span><span class="o">.</span><span class="n">mkdir</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">FileExistsError</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="n">working_simulator</span><span class="o">.</span><span class="n">save_model_outputs</span><span class="p">(</span><span class="n">model_files_save_path</span><span class="p">,</span> <span class="n">save_model_files</span><span class="p">)</span>

    <span class="n">model_path_name</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">working_simulator</span><span class="o">.</span><span class="n">temp_dir</span><span class="o">.</span><span class="n">name</span><span class="p">)</span> <span class="o">/</span> <span class="n">working_simulator</span><span class="o">.</span><span class="n">model_name</span>
    <span class="p">)</span>

    <span class="c1"># Save whole model run</span>
    <span class="k">if</span> <span class="n">save_model_run</span><span class="p">:</span>
        <span class="n">working_simulator</span><span class="o">.</span><span class="n">save_model</span><span class="p">(</span>
            <span class="n">results_dir</span> <span class="o">/</span> <span class="s2">&quot;ecl_models&quot;</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">evaluation</span><span class="p">)</span><span class="si">:</span><span class="s2">05d</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>

    <span class="c1"># read in simulation summary data</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">summary_results</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;well&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;failed&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">}</span>
        <span class="k">if</span> <span class="n">summary_results_kwargs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">summary_results</span> <span class="o">=</span> <span class="n">_get_ecl_sumspec_results</span><span class="p">(</span>
                <span class="n">model_path_name</span><span class="p">,</span> <span class="o">**</span><span class="n">summary_results_kwargs</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">summary_results</span> <span class="o">=</span> <span class="n">_get_ecl_sumspec_results</span><span class="p">(</span><span class="n">model_path_name</span><span class="p">)</span>

    <span class="k">except</span> <span class="n">SimulationOutputError</span><span class="p">:</span>  <span class="c1"># simulation failed.</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Results file not found </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">model_path_name</span><span class="p">))</span>
        <span class="n">summary_results</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;failed&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;well&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;end_date&quot;</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="mi">0</span><span class="p">)}</span>
    <span class="k">except</span> <span class="ne">KeyError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>  <span class="c1"># simulation failed.</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Results keys missing from summary </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">err</span><span class="p">)</span>
        <span class="n">summary_results</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;failed&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;well&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;end_date&quot;</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="mi">0</span><span class="p">)}</span>
    <span class="k">except</span> <span class="n">SimulationRunError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>  <span class="c1"># simulation raised errors - probably failed</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Simulation run failed. </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">err</span><span class="p">)</span>
        <span class="n">summary_results</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;failed&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;well&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;end_date&quot;</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="mi">0</span><span class="p">)}</span>

    <span class="k">if</span> <span class="n">summary_results</span><span class="p">[</span><span class="s2">&quot;well&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">save_summary_results</span><span class="p">:</span>
        <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">_</span><span class="si">{:04d}</span><span class="s2">_summary.hdf5&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">optimiser</span><span class="p">,</span> <span class="n">evaluation</span><span class="p">)</span>
        <span class="n">summary_results_path</span> <span class="o">=</span> <span class="n">results_dir</span> <span class="o">/</span> <span class="s2">&quot;summary&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">summary_results_path</span><span class="o">.</span><span class="n">mkdir</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">FileExistsError</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="n">summary_results_path_name</span> <span class="o">=</span> <span class="n">summary_results_path</span> <span class="o">/</span> <span class="n">name</span>
        <span class="n">summary_results</span><span class="p">[</span><span class="s2">&quot;well&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">to_hdf</span><span class="p">(</span>
            <span class="n">summary_results_path_name</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;table&quot;</span>
        <span class="p">)</span>
        <span class="k">del</span> <span class="n">summary_results</span><span class="p">[</span><span class="s2">&quot;well&quot;</span><span class="p">]</span>
        <span class="n">summary_results</span><span class="p">[</span><span class="s2">&quot;well&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">summary_results_path_name</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Summary results hdf5 output </span><span class="si">{</span><span class="n">summary_results_path</span><span class="o">/</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># read in simulation property data</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">eclsim</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">properties_results_kwargs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">eclsim</span> <span class="o">=</span> <span class="n">_get_ecl_properties_sub</span><span class="p">(</span>
                <span class="n">model_path_name</span><span class="p">,</span> <span class="o">**</span><span class="n">properties_results_kwargs</span>
            <span class="p">)</span>
            <span class="c1"># print(&quot;eclsim_ret&quot;, eclsim)</span>
    <span class="c1"># except IOError as err:</span>
    <span class="c1">#     logger.info(f&quot;Problems reading property results evaluation {evaluation}&quot;)</span>
    <span class="c1">#     print(err)</span>
    <span class="c1">#     property_results = {&quot;eclsim&quot;: eclsim, &quot;failed&quot;: True}</span>
    <span class="k">except</span> <span class="p">(</span><span class="ne">IOError</span><span class="p">,</span> <span class="ne">OSError</span><span class="p">,</span> <span class="n">SimulationOutputError</span><span class="p">)</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Problems reading property results evaluation </span><span class="si">{</span><span class="n">evaluation</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">property_results</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;eclsim&quot;</span><span class="p">:</span> <span class="n">eclsim</span><span class="p">,</span> <span class="s2">&quot;failed&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}</span>
    <span class="k">except</span> <span class="ne">KeyError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Keys not found in results file evaluation </span><span class="si">{</span><span class="n">evaluation</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">property_results</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;eclsim&quot;</span><span class="p">:</span> <span class="n">eclsim</span><span class="p">,</span> <span class="s2">&quot;failed&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">property_results</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;eclsim&quot;</span><span class="p">:</span> <span class="n">eclsim</span><span class="p">,</span> <span class="s2">&quot;failed&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">}</span>

    <span class="k">if</span> <span class="n">property_results</span><span class="p">[</span><span class="s2">&quot;eclsim&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">save_properties_results</span><span class="p">:</span>
        <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">_</span><span class="si">{:04d}</span><span class="s2">_eclsim&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">optimiser</span><span class="p">,</span> <span class="n">evaluation</span><span class="p">)</span>
        <span class="n">property_results_path</span> <span class="o">=</span> <span class="n">results_dir</span> <span class="o">/</span> <span class="s2">&quot;eclsim&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">property_results_path</span><span class="o">.</span><span class="n">mkdir</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">FileExistsError</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="n">eclsim_save_path_name</span> <span class="o">=</span> <span class="n">property_results_path</span> <span class="o">/</span> <span class="n">name</span>
        <span class="n">property_results</span><span class="p">[</span><span class="s2">&quot;eclsim&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">eclsim_save_path_name</span><span class="p">)</span>
        <span class="k">del</span> <span class="n">property_results</span><span class="p">[</span><span class="s2">&quot;eclsim&quot;</span><span class="p">]</span>
        <span class="n">property_results</span><span class="p">[</span><span class="s2">&quot;eclsim&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">eclsim_save_path_name</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Summary results eclsim output </span><span class="si">{</span><span class="n">property_results_path</span><span class="o">/</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">summary_results</span><span class="p">[</span><span class="s2">&quot;failed&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">True</span> <span class="ow">or</span> <span class="n">property_results</span><span class="p">[</span><span class="s2">&quot;failed&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">failed</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">failed</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="n">results</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">summary_results</span><span class="p">)</span>
    <span class="n">results</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">property_results</span><span class="p">)</span>
    <span class="n">results</span><span class="p">[</span><span class="s2">&quot;failed&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">failed</span>
    <span class="n">results</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s2">&quot;model_id&quot;</span><span class="p">:</span> <span class="n">working_simulator</span><span class="o">.</span><span class="n">id</span><span class="p">})</span>
    <span class="n">working_simulator</span><span class="o">.</span><span class="n">cleanup</span><span class="p">(</span><span class="n">sleep</span><span class="o">=</span><span class="n">sleep</span><span class="p">)</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Eclipse run finished and data loaded, trial number </span><span class="si">{</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;trial_number&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">results</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h3 id="optuna_hm.handlers._ecl_eval.evaluate_well_prod" class="doc doc-heading">
<code class="highlight language-python"><span class="n">evaluate_well_prod</span><span class="p">(</span><span class="n">log_pairs</span><span class="p">,</span> <span class="n">date_range</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;kge&#39;</span><span class="p">,</span> <span class="n">data_key</span><span class="o">=</span><span class="s1">&#39;well&#39;</span><span class="p">,</span> <span class="n">null_fitness</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>


</h3>

    <div class="doc doc-contents ">

      <p>Calculated the misfit between all log pairs using method and returns a
results dictionary labelled by the first log in the pair.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>log_pairs</code></td>
        <td><code>list[(, ), ]</code></td>
        <td><p>A list of length 2 tuples which match labels in the
input dataframe passed by the mopphim_kwargs['results'][data_key]</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>date_range</code></td>
        <td><code>tuple(str, str</code></td>
        <td><p>Filter the dataframe based upon a date range.
The index of the input dataframe will need to be of type datetime.
If the str is empty e.g. "" then the filter will be open in that direction.
E.g. ('2020-2-02', '') or ('2020-2-02'. '2020-4-04')</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>columns</code></td>
        <td><code>list</code></td>
        <td><p>List of DataFrame values to perform metric on.</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>optuna_hm/handlers/_ecl_eval.py</code></summary>
          <div class="highlight"><span class="filename">Python</span><pre><span></span><code><span class="k">def</span> <span class="nf">evaluate_well_prod</span><span class="p">(</span>
    <span class="n">log_pairs</span><span class="p">,</span>
    <span class="n">date_range</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">method</span><span class="o">=</span><span class="s2">&quot;kge&quot;</span><span class="p">,</span>
    <span class="n">data_key</span><span class="o">=</span><span class="s2">&quot;well&quot;</span><span class="p">,</span>
    <span class="n">null_fitness</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
<span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Calculated the misfit between all log pairs using method and returns a</span>
<span class="sd">    results dictionary labelled by the first log in the pair.</span>

<span class="sd">    Args:</span>
<span class="sd">        log_pairs (list[(, ), ]): A list of length 2 tuples which match labels in the</span>
<span class="sd">            input dataframe passed by the mopphim_kwargs[&#39;results&#39;][data_key]</span>
<span class="sd">        date_range (tuple(str, str)): Filter the dataframe based upon a date range.</span>
<span class="sd">            The index of the input dataframe will need to be of type datetime.</span>
<span class="sd">            If the str is empty e.g. &quot;&quot; then the filter will be open in that direction.</span>
<span class="sd">            E.g. (&#39;2020-2-02&#39;, &#39;&#39;) or (&#39;2020-2-02&#39;. &#39;2020-4-04&#39;)</span>
<span class="sd">        columns (list): List of DataFrame values to perform metric on.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># set output metrics to null_fitness</span>
    <span class="n">metrics</span> <span class="o">=</span> <span class="p">{</span><span class="n">p1</span><span class="p">:</span> <span class="n">null_fitness</span> <span class="k">for</span> <span class="n">p1</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">log_pairs</span><span class="p">}</span>
    <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;results&quot;</span><span class="p">][</span><span class="s2">&quot;failed&quot;</span><span class="p">]</span> <span class="ow">and</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;results&quot;</span><span class="p">][</span><span class="s2">&quot;well&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">metrics</span>

    <span class="n">results</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;results&quot;</span><span class="p">]</span>

    <span class="n">data_path_name</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;results&quot;</span><span class="p">][</span><span class="n">data_key</span><span class="p">]</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_hdf</span><span class="p">(</span><span class="n">data_path_name</span><span class="p">)</span>
    <span class="n">available_logs</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">columns</span>
    <span class="n">output_metrics</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Missing well results from ECL run. Skipping well evaluation.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">metrics</span>

    <span class="c1"># check log_pairs</span>
    <span class="k">for</span> <span class="n">log</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">log_pairs</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">():</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">log</span> <span class="ow">in</span> <span class="n">available_logs</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;log </span><span class="si">{</span><span class="n">log</span><span class="si">}</span><span class="s2"> was not in results&quot;</span><span class="p">)</span>

    <span class="n">clean_data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">date_range</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">clean_data</span> <span class="o">=</span> <span class="n">clean_data</span><span class="p">[</span><span class="n">date_range</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">:</span> <span class="n">date_range</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
    <span class="k">if</span> <span class="n">clean_data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;data is empty, check date_range/simulation&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">metrics</span>

    <span class="c1"># NOT SURE IF THIS IS STILL NEEDED</span>
    <span class="c1"># no_data = [c for c in plogs if clean_data[c[0]].sum() == 0]</span>
    <span class="c1"># plogs = [c for c in plogs if clean_data[c[0]].sum() &gt; 0]</span>
    <span class="c1"># for c in no_data:</span>
    <span class="c1">#     metrics[c[0]] = np.nan</span>

    <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;kge&quot;</span><span class="p">:</span>
        <span class="c1"># kling-gupta efficieny</span>
        <span class="k">for</span> <span class="n">p1</span><span class="p">,</span> <span class="n">p2</span> <span class="ow">in</span> <span class="n">log_pairs</span><span class="p">:</span>
            <span class="n">output_metrics</span><span class="p">[</span><span class="n">p1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">kge</span><span class="p">(</span>
                <span class="n">clean_data</span><span class="p">[</span><span class="n">p1</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
                <span class="n">clean_data</span><span class="p">[</span><span class="n">p2</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
                <span class="n">maxfitness</span><span class="o">=</span><span class="n">null_fitness</span><span class="p">,</span>  <span class="c1"># incase method fails</span>
            <span class="p">)</span>
    <span class="c1"># elif method == &quot;mse&quot;:</span>
    <span class="c1">#     scaler = StandardScaler()</span>
    <span class="c1">#     data_norm = clean_data.copy()</span>
    <span class="c1">#     data_norm.loc[:, :] = scaler.fit_transform(clean_data.values)</span>
    <span class="c1">#     for col in plogs:</span>
    <span class="c1">#         metrics[col[0]] = mean_squared_error(</span>
    <span class="c1">#             data_norm[col[0]].values, data_norm[col[1]].values</span>
    <span class="c1">#         )</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unknown method </span><span class="si">{</span><span class="n">method</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">logger</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Completed well evaluation, trial_number </span><span class="si">{</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;trial_number&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">output_metrics</span>
</code></pre></div>
        </details>
    </div>

  </div>







  </div>

    </div>

  </div>

<h2 id="optuna_hmhandlersflow"><code>optuna_hm.handlers.flow</code></h2>
<p>Flow is an alternative open-source simulator to Eclipse. It uses similar files as input
and output but has a slightly different call signature. This module modifies the Eclipse methods to suit flow where needed. Evaluation and metrics functions from Eclipse can be used with Flow.</p>


  <div class="doc doc-object doc-module">


    <div class="doc doc-contents first">

      <p>Handler module for external file and process handling
of ECLIPSE flow simulator - Schlumberger</p>
<p>hand_ecl100 -  Claus Aranha (caranha@cs.tsukuba.ac.jp)
hand_ecldat -  Tony Hallam</p>



  <div class="doc doc-children">







  <div class="doc doc-object doc-class">



<h3 id="optuna_hm.handlers.flow.FlowHandler" class="doc doc-heading">
        <code>
FlowHandler            (<a class="autorefs autorefs-internal" title="optuna_hm.handlers._ecl_simh.ECLBaseHandler" href="#optuna_hm.handlers._ecl_simh.ECLBaseHandler">ECLBaseHandler</a>)
        </code>



</h3>

    <div class="doc doc-contents ">

      <p>modifies ECLBaseHandler to deal with flow.</p>

        <details class="quote">
          <summary>Source code in <code>optuna_hm/handlers/flow.py</code></summary>
          <div class="highlight"><span class="filename">Python</span><pre><span></span><code><span class="k">class</span> <span class="nc">FlowHandler</span><span class="p">(</span><span class="n">ECLBaseHandler</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    modifies ECLBaseHandler to deal with flow.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;See ECLBaseHandler</span>
<span class="sd">        Notes:</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s2">&quot;FlowHandler&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__deepcopy__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">memo</span><span class="p">):</span>
        <span class="c1"># need to create a special copy function because the logger cannot be coppied</span>
        <span class="c1"># this means reinitialisation is necessary for each new simulator class</span>
        <span class="n">args</span> <span class="o">=</span> <span class="p">[</span>
            <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="n">var</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="p">[</span>
                <span class="s2">&quot;model_name&quot;</span><span class="p">,</span>
                <span class="s2">&quot;model_path&quot;</span><span class="p">,</span>
                <span class="s2">&quot;popt&quot;</span><span class="p">,</span>
                <span class="s2">&quot;simexe&quot;</span><span class="p">,</span>
                <span class="s2">&quot;time_out&quot;</span><span class="p">,</span>
                <span class="s2">&quot;silent&quot;</span><span class="p">,</span>
            <span class="p">]</span>
        <span class="p">]</span>
        <span class="k">return</span> <span class="n">FlowHandler</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">clean_results</span><span class="p">():</span>
        <span class="c1"># FIXME: delete results file from self.model_path</span>
        <span class="c1">#        beginning with self.model_name</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">launch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">cmdargs</span><span class="p">,</span> <span class="o">**</span><span class="n">cmdkwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Launch the flow simulator.</span>

<span class="sd">        Args:</span>
<span class="sd">            None</span>

<span class="sd">        Returns:</span>
<span class="sd">            bool: True if run did not timeout.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">model_arg</span> <span class="o">=</span> <span class="s2">&quot;--parameter-file=&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model_name</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;.PARAM&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;running model at </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_path</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">launch</span><span class="p">(</span><span class="n">model_arg</span><span class="p">)</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">










  <div class="doc doc-object doc-method">



<h4 id="optuna_hm.handlers.flow.FlowHandler.__init__" class="doc doc-heading">
<code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

</h4>

    <div class="doc doc-contents ">

      <p>See ECLBaseHandler
Notes:</p>

        <details class="quote">
          <summary>Source code in <code>optuna_hm/handlers/flow.py</code></summary>
          <div class="highlight"><span class="filename">Python</span><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;See ECLBaseHandler</span>
<span class="sd">    Notes:</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s2">&quot;FlowHandler&quot;</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>




  <div class="doc doc-object doc-method">



<h4 id="optuna_hm.handlers.flow.FlowHandler.launch" class="doc doc-heading">
<code class="highlight language-python"><span class="n">launch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">cmdargs</span><span class="p">,</span> <span class="o">**</span><span class="n">cmdkwargs</span><span class="p">)</span></code>


</h4>

    <div class="doc doc-contents ">

      <p>Launch the flow simulator.</p>

<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>bool</code></td>
      <td><p>True if run did not timeout.</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>optuna_hm/handlers/flow.py</code></summary>
          <div class="highlight"><span class="filename">Python</span><pre><span></span><code><span class="k">def</span> <span class="nf">launch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">cmdargs</span><span class="p">,</span> <span class="o">**</span><span class="n">cmdkwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Launch the flow simulator.</span>

<span class="sd">    Args:</span>
<span class="sd">        None</span>

<span class="sd">    Returns:</span>
<span class="sd">        bool: True if run did not timeout.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">model_arg</span> <span class="o">=</span> <span class="s2">&quot;--parameter-file=&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model_name</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;.PARAM&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;running model at </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_path</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">launch</span><span class="p">(</span><span class="n">model_arg</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>







  </div>

    </div>

  </div>

              

            </article>
          </div>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        
        <a href="tutorial.html" class="md-footer__link md-footer__link--prev" aria-label="Previous: Tutorial" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Tutorial
            </div>
          </div>
        </a>
      
      
        
        <a href="api_metrics.html" class="md-footer__link md-footer__link--next" aria-label="Next: Metrics" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Metrics
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Tony Hallam
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "..", "features": ["navigations.instant", "navigation.tracking", "navigation.tabs", "navigation.sections", "navigation.expand"], "search": "../assets/javascripts/workers/search.5e67fbfe.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.c44cc438.min.js"></script>
      
        <script src="../javascripts/mathjax.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>